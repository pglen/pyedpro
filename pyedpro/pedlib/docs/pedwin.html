<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.10.0" />
<title>pedwin API documentation</title>
<meta name="description" content="This module is responsible for creating the main window." />
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/sanitize.min.css" integrity="sha256-PK9q560IAAa6WVRRh76LtCaI8pjTJ2z11v0miyNNjrs=" crossorigin>
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/typography.min.css" integrity="sha256-7l/o7C8jubJiy74VsKTidCy1yBkRtiUGbVkYBylBqUg=" crossorigin>
<link rel="stylesheet preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/github.min.css" crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em .5em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js" integrity="sha256-Uv3H6lx7dJmRfRvH8TH6kJD1TSK1aFcwgx+mdg3epi8=" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => hljs.initHighlighting())</script>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>pedwin</code></h1>
</header>
<section id="section-intro">
<p>This module is responsible for creating the main window.</p>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">#!/usr/bin/env python

from __future__ import absolute_import, print_function

import os
import time
import sys
import ctypes
import warnings
import stat
import collections
import platform
import datetime
import threading

import gi; gi.require_version(&#34;Gtk&#34;, &#34;3.0&#34;)
from gi.repository import Gtk
from gi.repository import Gdk
from gi.repository import GLib
from gi.repository import Gio
from gi.repository import GObject

from pedlib import pedconfig
from pedlib import peddoc
from pedlib import pedync
from pedlib import pedlog
from pedlib import pedcal
from pedlib import pednotes
from pedlib import pedoline
from pedlib import pedfont
from pedlib import pedcolor
from pedlib import pedfind
from pedlib import pedweb
from pedlib import peddlg
from pedlib import pedthread
from pedlib import pedspell
from pedlib import pedofd
#from pedlib import pedplug
from pedlib import pedutil
from pedlib import pedai

#sys.path.append(&#39;..&#39; + os.sep + &#34;pyvguicom&#34;)

from pyvguicom.pggui import *
from pyvguicom.pgsimp import *
from pyvguicom.pgbutt import *

# Into our name space
from    pedlib.pedmenu import *
from    pedlib.pedui import *
from    pedlib.pedutil import *

__doc__ = &#39;&#39;&#39;
    This module is responsible for creating the main window.

&#39;&#39;&#39;

STATUSCOUNT = 5             # Length of the status bar timeout (in sec)

treestore = None;  treestore2 = None
treeview = None;   treeview2 = None
notebook = None;   notebook2 = None
notebook3 = None;  notebook4 = None

hidden = 0
savearr = []

#GObject.threads_init()

# -----------------------------------------------------------------------

def add_page(page):
    global notebook
    notebook.append_page(page)
    notebook.set_tab_detachable(page, True)

# ------------------------------------------------------------------------

class itemhistory():

    &#39;&#39;&#39; FIFO for freq strings &#39;&#39;&#39;

    def __init__(self, fname):

        self.fname = fname
        self.histarr = []

        try:
            fh = open(self.fname, &#34;rb&#34;)
            try:
                self.histarr = pickle.load(fh)
            except:
                #print(&#34;Cannot open history file.&#34;, sys.exc_info())
                pass
            fh.close()
        except:
            #print(&#34;Cannot load history data&#34;, sys.exc_info())
            pass

        self.histarr.sort(reverse=True)
        #self.dump()

    def add(self, fname):
        #global openhist
        got = False
        for aa in self.histarr:
            if aa[2] == fname:
                aa[1] += 1
                aa[0] = time.time()
                got = True

        if not got:
          self.histarr.append([time.time(), 1, fname]);

        self.histarr.sort(reverse=True)
        if len(self.histarr) &gt; 12:
            self.histarr = self.histarr[:-2]

    def gettops(self):
        pass

    def dump(self):
        for aa in self.histarr:
            print(aa)

    def save(self):
        try:
            fh = open(self.fname, &#34;wb&#34;)
            pickle.dump(self.histarr, fh)
            fh.close()
        except:
            #print(&#34;Cannot save history file&#34;, sys.exc_info())
            #pedutil.put_exception(&#34;history&#34;)
            pass

        #print(&#34;Saved&#34;, openhist)

# -----------------------------------------------------------------------

class edPane(Gtk.VPaned):

    &#39;&#39;&#39;  Create document &#39;&#39;&#39;

    def __init__(self, buff = [], focus = False):

        pos = pedconfig.conf.sql.get_int(&#34;vpaned&#34;)
        if pos == 0: pos = 50

        Gtk.VPaned.__init__(self)
        self.set_border_width(3)
        self.set_position(pos)
        self.vbox = edwin(buff)
        self.add2(self.vbox)
        self.vbox2 = edwin(buff, True)
        self.add1(self.vbox2)

        self.set_size_request(100, 100)

        # Shortcuts to access the editor windows
        self.area  = self.vbox.area
        self.area2 = self.vbox2.area
        self.area2.second = True

# -----------------------------------------------------------------------

class edwin(Gtk.VBox):

    &#39;&#39;&#39; Create main document widget with scroll bars &#39;&#39;&#39;

    def __init__(self, buff, readonly = False, second = False):

        global notebook, notebook3, mained

        Gtk.VBox.__init__(self)

        # Make it acessable:
        self.area  = peddoc.pedDoc(buff, mained, readonly)
        #print( &#34;created&#34;, self.area, mained)

        # Give access to notebook and main editor window
        self.area.notebook = notebook
        self.area.notebook3 = notebook3

        #self.area.mained = mained
        self.area.fname = &#34;&#34;

        frame = Gtk.Frame(); frame.add(self.area)
        hbox = Gtk.HBox()
        hbox.pack_start(frame, True, True, 0)
        hbox.pack_end(self.area.vscroll, False, False, 0)

        self.pack_start(hbox, True, True, 0)
        self.pack_end(self.area.hscroll, False, False, 0)

# ------------------------------------------------------------------------

class EdMainWindow():

    &#39;&#39;&#39;  Define Application Main Window claass &#39;&#39;&#39;

    def __init__(self, fname, parent, names, orgdir):

        #Gdk.threads_init()
        self.togstrip = True

        pedconfig.conf.pedwin = self

        if &#34;Darwin&#34; in platform.system():
            self.mac = True
        else:
            self.mac  = False

        self.orgdir = orgdir
        self.colorbar = 0
        self.headcolor = 0
        self.rescnt = 0
        self.full = False
        self.fcount = 0
        self.statuscount = 0
        self.alt = False
        self.altkey = False
        self.names = names
        self.show_menu = True
        self.show_tbar = True
        #self.alttime = 0
        self.old_x = 0
        self.old_y = 0
        self.lastfile = &#34;&#34;
        self.oh = itemhistory(pedconfig.conf.history)
        self.os = itemhistory(pedconfig.conf.sessions)
        self.sess = &#34;initial.sess&#34;

        if pedconfig.conf.keylog_on:
            self.klfp = open(pedconfig.conf.keylog_file, &#34;at&#34;)
        else:
            self.klfp = None

        register_stock_icons()

        #Gdk.threads_init()

        global mained
        mained = self

        disp2 = Gdk.Display()
        disp = disp2.get_default()
        #print( disp)
        scr = disp.get_default_screen()
        ptr = disp.get_pointer()
        mon = scr.get_monitor_at_point(ptr[1], ptr[2])
        geo = scr.get_monitor_geometry(mon)
        www = geo.width; hhh = geo.height
        xxx = geo.x;     yyy = geo.y

        # Resort to old means of getting screen w / h
        if www == 0 or hhh == 0:
            www = Gdk.screen_width(); hhh = Gdk.screen_height()

        if pedconfig.conf.pgdebug &gt; 3:
            print(&#34;www&#34;, www, &#34;hhh&#34;, hhh)

        # Create the toplevel window
        #window = Gtk.Window(Gtk.WINDOW_TOPLEVEL)
        self.mywin = Gtk.Window()
        #www = Gdk.screen_width(); hhh = Gdk.screen_height();

        if pedconfig.conf.full_screen:
            if pedconfig.conf.verbose:
                print(&#34;Setting full screen&#34;)

            self.mywin.set_default_size(www, hhh)
        else:
            xx = pedconfig.conf.sql.get_int(&#34;xx&#34;)
            yy = pedconfig.conf.sql.get_int(&#34;yy&#34;)
            ww = pedconfig.conf.sql.get_int(&#34;ww&#34;)
            hh = pedconfig.conf.sql.get_int(&#34;hh&#34;)

            if pedconfig.conf.pgdebug &gt; 2:
                print(&#34;load coords&#34;, xx, yy, ww, hh)

            if ww == 0 or hh == 0:
                self.mywin.set_position(Gtk.WindowPosition.CENTER)
                if www / hhh &gt; 2:
                    www = hhh
                self.mywin.set_default_size(7*www/8, 5*hhh/8)
                #self.mywin.move(www / 32, hhh / 10)
            else:
                self.mywin.set_default_size(ww, hh)
                self.mywin.move(xx, yy)

            #self.mywin.set_default_size(7*www/8, 7*hhh/8)
            #self.mywin.set_position(Gtk.WindowPosition.CENTER)
            #self.mywin.move(xxx + www / 16, yyy / hhh / 16)

        try:
            self.mywin.set_icon_from_file(get_img_path(&#34;pyedpro.png&#34;))
        except:
            try:
                self.mywin.set_icon_from_file(&#34;images/pyedpro.png&#34;)
            except:
                print(&#34;Canot load main icon.&#34;)

        self.merge = Gtk.UIManager()
        #self.merge.connect(&#34;pre-activate&#34;, self.menu_open)
        #self.merge.connect(&#34;add_widget&#34;, self.menu_open)
        #self.mywin.set_data(&#34;ui-manager&#34;, self.merge)

        self.acg = create_action_group(self)
        self.merge.insert_action_group(self.acg, 0)
        self.accel = self.merge.get_accel_group()

        ##accel.disconnect_key(Gdk.KEY_o, Gdk.ModifierType.CONTROL_MASK)
        #accel.disconnect_key(Gdk.KEY_a, Gdk.ModifierType.META_MASK)
        #accel.disconnect_key(Gdk.KEY_o, Gdk.ModifierType.CONTROL_MASK |
        #                                        Gdk.ModifierType.SHIFT_MASK)

        self.mywin.add_accel_group(self.accel)

        try:
            mergeid = self.merge.add_ui_from_string(ui_info)
        except GLib.GError as msg:
            print(&#34;Building menus failed: %s&#34; % msg)

        merge_id = self.merge.new_merge_id()
        self.add_mru(self.merge, merge_id, self.acg)

        # Keybinder
        #actions = self.acg.list_actions()
        #for aa in actions:
        #    print(aa.get_name(), )

        self.mbar = self.merge.get_widget(&#34;/MenuBar&#34;)
        self.mbar.show()

        self.mywin.set_events(Gdk.EventMask.ALL_EVENTS_MASK )

        global notebook, notebook2, notebook3

        # Create note for the main window, give access to it for all
        notebook = Gtk.Notebook.new(); self.notebook = notebook
        #notebook.size_allocate(Gdk.Rectangle(0, 0, 10,10))

        #notebook.popup_enable()
        notebook.set_scrollable(True)
        # test
        #notebook.append_page(edPane([]))
        #notebook.drag_dest_set(0, [], 0)
        #notebook.drag_dest_set(Gtk.DestDefaults.HIGHLIGHT | Gtk.DestDefaults.DROP
        #                 | Gtk.DestDefaults.MOTION,
        #                 [Gtk.TargetEntry.new(&#39;GTK_NOTEBOOK_TAB&#39;,
        #                                      Gtk.TargetFlags.SAME_APP, 0)],
        #                                         Gdk.DragAction.MOVE)

        notebook.set_group_name(&#39;0&#39;)

        #notebook.drag_source_set(Gdk.ModifierType.BUTTON1_MASK, [], Gdk.DragAction.MOVE)

        #notebook.connect_after(&#39;drag-begin&#39;, self.on_drag_begin)
        #notebook.connect_after(&#39;drag-motion&#39;, self.on_drag_motion)
        #notebook.connect_after(&#39;drag-drop&#39;, self.on_drag_drop)
        #notebook.connect_after(&#34;drag-data-received&#34;, self.on_drag_data_received)

        # This is the right notebook
        notebook3 = Gtk.Notebook.new(); self.notebook3 = notebook3
        #notebook3.size_allocate(Gdk.Rectangle(0, 0, 10,10))

        notebook3.set_scrollable(True)
        self.diffpane = edPane()
        self.diffpane.area.readonly = True
        self.diffpane.area.diffpane = True
        self.diffpane.area.nomenu = True

        notebook3.append_page(self.diffpane)
        ppp = self.notebook3.get_nth_page(self.notebook.get_n_pages()-1)
        self.notebook3.set_tab_label(ppp, self.make_label(&#34; Diff &#34;))

        # This is the left notebook
        notebook2 = Gtk.Notebook.new(); self.notebook2 = notebook2
        #notebook2.size_allocate(Gdk.Rectangle(0, 0, 100,100))

        #notebook2.popup_enable()
        notebook2.set_scrollable(True)
        notebook2.connect(&#34;switch-page&#34;, self.note_swpage_cb2)
        notebook2.connect(&#34;move_focus_out&#34;, self.focus_out2)
        #notebook2.override_background_color(
        #            Gtk.StateFlags.NORMAL, Gdk.RGBA(.85, .8, .8) )

        #notebook.add_events(Gdk.FOCUS_CHANGE_MASK)
        #notebook.add_events(Gdk.ALL_EVENTS_MASK)

        notebook.connect(&#34;switch-page&#34;, self.note_swpage_cb)
        notebook.connect(&#34;focus-in-event&#34;, self.note_focus_in)
        notebook.connect(&#34;drag-data-received&#34;, self.on_drag_data_received)

        # Futile attempts
        #notebook.connect(&#34;change-current-page&#34;, self.note_page_cb)
        #notebook.connect(&#34;grab-focus&#34;, self.note_grab_focus_cb)
        #notebook.connect(&#34;focus&#34;, self.note_focus_cb)
        #notebook.connect(&#34;create-window&#34;, self.note_create_cb)
        #notebook.connect(&#34;enter-notify-event&#34;, self.note_enter_notify)

        notebook.connect(&#34;button-press-event&#34;, self.note_button)
        self.mywin.connect(&#34;window_state_event&#34;, self.update_resize_grip)
        self.mywin.connect(&#34;delete-event&#34;, OnExit)
        #self.mywin.connect(&#34;unmap&#34;, OnExit, self)

        self.mywin.connect(&#34;key-press-event&#34;, self.area_key)
        self.mywin.connect(&#34;key-release-event&#34;, self.area_key)

        #self.mywin.connect(&#34;set-focus&#34;, self.area_focus)
        self.mywin.connect(&#34;focus-in-event&#34;, self.area_focus_in)
        self.mywin.connect(&#34;focus-out-event&#34;, self.area_focus_out)
        self.mywin.connect(&#34;window-state-event&#34;, self.area_winstate)
        self.mywin.connect(&#34;size_allocate&#34;, self.area_size)
        self.mywin.connect(&#34;configure-event&#34;, self.config_event)

        #self.mywin.connect(&#34;area-focus-event&#34;, self.area_focus_in)
        #self.mywin.connect(&#34;event&#34;, self.area_event)
        #self.mywin.connect(&#34;enter-notify-event&#34;, self.area_enter)
        #self.mywin.connect(&#34;leave-notify-event&#34;, self.area_leave)
        #self.mywin.connect(&#34;event&#34;, self.unmap)

        self.tbar = self.merge.get_widget(&#34;/ToolBar&#34;)
        #self.tbar.set_tooltips(True)
        self.tbar.set_icon_size(Gtk.IconSize.LARGE_TOOLBAR)
        self.tbar.show()

        self.hpaned = Gtk.HPaned(); self.hpaned.set_border_width(2)

        #warnings.simplefilter(&#34;ignore&#34;)
        scroll = Gtk.ScrolledWindow()
        #warnings.simplefilter(&#34;default&#34;)

        global treeview
        treeview = self.create_tree()
        treeview.set_activate_on_single_click (True)
        treeview.connect(&#34;row-activated&#34;,  self.tree_sel)
        #treeview.connect(&#34;cursor-changed&#34;,  self.tree_sel_row)
        self.treeview = treeview
        #treeview.modify_bg(Gtk.StateType.NORMAL, Gdk.color_parse(&#34;#888888&#34;))

        global treeview2
        treeview2 = self.create_vartree()
        treeview2.set_activate_on_single_click (True)
        treeview2.connect(&#34;row-activated&#34;,  self.tree_sel2)
        #treeview2.connect(&#34;cursor-changed&#34;,  self.tree_sel_row2)
        self.treeview2 = treeview2

        vpaned = Gtk.VPaned() #vpaned.set_border_width(2)

        scroll.add(treeview)
        frame2 = Gtk.Frame(); frame2.add(scroll)
        vpaned.add(frame2)

        scroll2 = Gtk.ScrolledWindow()
        scroll2.add(treeview2)
        frame3 = Gtk.Frame(); frame3.add(scroll2)
        vpaned.set_focus_chain((frame2,))
        vpaned.add(frame3)

        vpaned.set_position(self.get_height() - 340)
        #vpaned.set_position(10)
        #self.hpaned.add(vpaned)

        try:
            notebook2.append_page(vpaned)
            ppp = self.notebook2.get_nth_page(self.notebook2.get_n_pages()-1)
            self.notebook2.set_tab_label(ppp, self.make_label(&#34;Funcs&#34;))
        except:
            print(&#34;Cannot load auxiliary func tab.&#34;)
            if pedconfig.conf.verbose:
                print(sys.exc_info())
                pedutil.put_exception(&#34;func tab&#34;)

        try:
            #pw = Gtk.Label(&#34;hello&#34;)
            pw = pedai.pgAI()
            notebook2.append_page(pw)
            ppp = self.notebook2.get_nth_page(self.notebook2.get_n_pages()-1)
            self.notebook2.set_tab_label(ppp, self.make_label(&#34;_AI&#34;))
            pass
        except:
            print(&#34;Cannot load auxiliary AI tab.&#34;)
            if pedconfig.conf.verbose:
                print(sys.exc_info())
                if pedconfig.conf.verbose:
                    put_exception(&#34;load AI tab&#34;)

        try:
            notebook2.append_page(pedcal.pgcal())
            ppp = self.notebook2.get_nth_page(self.notebook2.get_n_pages()-1)
            self.notebook2.set_tab_label(ppp, self.make_label(&#34;Cal&#34;))
            pass
        except:
            print(&#34;Cannot load auxiliary cal tab.&#34;)
            if pedconfig.conf.verbose:
                print(sys.exc_info())
                pedutil.put_exception(&#34;cal tab&#34;)

        try:
            notebook2.append_page(pednotes.pgnotes())
            ppp = self.notebook2.get_nth_page(self.notebook2.get_n_pages()-1)
            self.notebook2.set_tab_label(ppp, self.make_label(&#34;Notes&#34;))
            pass
        except:
            print(&#34;Cannot load auxiliary notes tab&#34;)
            print(sys.exc_info())
            if pedconfig.conf.verbose:
                put_exception(&#34;Notes&#34;)

            if pedconfig.conf.pgdebug &gt; 2:
                put_exception(&#34;Notes&#34;)

        try:
            notebook2.append_page(pedoline.pgoline())
            ppp = self.notebook2.get_nth_page(self.notebook2.get_n_pages()-1)
            self.notebook2.set_tab_label(ppp, self.make_label(&#34;Draw&#34;))
            pass
        except:
            print(&#34;Cannot load outline tab.&#34;)
            if pedconfig.conf.verbose:
                print(sys.exc_info())
                pedutil.put_exception(&#34;outline&#34;)

        try:
            pw = pedweb.pgweb()
            notebook2.append_page(pw)
            ppp = self.notebook2.get_nth_page(self.notebook2.get_n_pages()-1)
            self.notebook2.set_tab_label(ppp, self.make_label(&#34;Web&#34;))
            pass
        except:
            print(&#34;Cannot load auxiliary web tab.&#34;)
            if pedconfig.conf.verbose:
                print(sys.exc_info())
                if pedconfig.conf.verbose:
                    put_exception(&#34;load web tab&#34;)

        self.hpanepos = pedconfig.conf.sql.get_int(&#34;hpaned&#34;)
        if self.hpanepos == 0: self.hpanepos = 200
        self.hpaned.set_position(self.hpanepos)

        self.hpaned.add(notebook2)
        #self.hpaned.pack2(Gtk.Label(&#34;hello &#34;))
        self.hpaned.pack2(notebook)
        #notebook.modify_bg(Gtk.StateType.NORMAL, Gdk.color_parse(&#34;#888888&#34;))

        self.hpaned3 = Gtk.HPaned(); self.hpaned3.set_border_width(2)
        self.hpaned3.set_position(20)

        self.hpaned3.add(self.hpaned)
        self.hpaned3.pack2(notebook3)
        self.hpaned3.set_position(self.get_width() - 10)

        # Create statusbars (obsolete)
        #self.statusbar = Gtk.Statusbar()
        #self.statusbar2 = Gtk.Statusbar()
        #self.statusbar2.set_spacing(0)

        # Replaced it with simple labels
        slabs = Gtk.Label(&#34;   &#34;)
        self.slab = Gtk.Label(&#34; status  &#34;)
        self.slab.set_xalign(Gtk.Align.START)
        self.slab.set_yalign(Gtk.Align.START)

        #self.slab.override_background_color(
        #            Gtk.StateFlags.NORMAL, Gdk.RGBA(1, .5, .5) )

        shbox = Gtk.HBox()
        shbox.pack_start(slabs, 0, 0, 0)
        shbox.pack_start(self.slab, 0, 0, 0)

        shbox.pack_end(Gtk.Label(&#34; | &#34;), 0, 0, 0)
        eb = smallbutt(&#34; Hist &#34;, self.status_hist, &#34;Look at event history&#34;)
        shbox.pack_end(eb, 0, 0, 0)
        shbox.pack_end(Gtk.Label(&#34; | &#34;), 0, 0, 0)

        shbox.pack_end(Gtk.Label(&#34; | &#34;), 0, 0, 0)
        eb2 = smallbutt(&#34; Lang &#34;, self.status_lang, &#34;Change language&#34;)
        shbox.pack_end(eb2, 0, 0, 0)
        shbox.pack_end(Gtk.Label(&#34; | &#34;), 0, 0, 0)

        #shbox.override_background_color(
        #            Gtk.StateFlags.NORMAL, Gdk.RGBA(1, .5, 1) )

        self.slab2 = Gtk.Label(&#34; status2  &#34;)

        #self.hpaned2 = Gtk.HPaned(); self.hpaned2.set_border_width(5)
        #self.hpaned2.set_position(20)
        #self.hpaned2.pack1(shbox, 0, 0)
        #self.hpaned2.pack2(self.slab2, 0, 0)

        self.hbox3 = Gtk.HBox()
        self.hbox3.pack_start(shbox, 1, 1, 2)
        self.hbox3.pack_start(self.slab2, 0, 0, 2)

        bbox = Gtk.VBox()
        nbox = Gtk.HBox()
        obox = Gtk.VBox()

        obox.pack_start(self.mbar, 0, 0, 0)
        obox.pack_start(self.tbar, 0, 0, 0)
        nbox.pack_start(obox, 0, 0, 0)

        obox3 = Gtk.HBox()
        obox2 = Gtk.VBox()
        self.newbox = Gtk.HBox()
        self.newbox2 = Gtk.HBox()

        # This many buttons on screen
        self.num_butts =  www // (1280 // 6)
        self.buttarr = []               # So later we can change labels
        self.newbox.pack_start(Gtk.Label(&#34; &#34;), 0, 0, 0)
        for aa in range(self.num_butts):
            #butt = Gtk.Button(&#34;FuncA %d &#34; % (aa + 1))
            head = pedconfig.conf.sql.get(&#34;mac%d%d&#34; % (1, aa))
            if not head:
                head =  &#34;B_A%d&#34; % (aa + 1)
            butt = RCLButt(head, self.rcl, self.rcl2, space=0, ttip = &#34;Action Button %d&#34; % (aa+1))
            butt.ord = 1; butt.id = aa ;
            self.buttarr.append(butt)
            #butt.connect(&#34;pressed&#34;, self.buttA, aa + 1)
            self.newbox.pack_start(butt, 1, 1, 0)
        self.newbox.pack_start(Gtk.Label(&#34; &#34;), 0, 0, 0)
        combox = Gtk.VBox()
        combox.pack_start(self.newbox, 1, 1, 1)
        newscroll = Gtk.ScrolledWindow()
        newscroll.set_overlay_scrolling(False)
        newscroll.set_policy(Gtk.PolicyType.NEVER, Gtk.PolicyType.NEVER)
        newscroll.add_with_viewport(combox)
        obox2.pack_start(newscroll, 1, 1, 0)

        self.newbox2.pack_start(Gtk.Label(&#34; &#34;), 0, 0, 0)
        for aa in range(self.num_butts):
            #butt = Gtk.Button(&#34;FuncB %d &#34; % (aa + 1))
            head = pedconfig.conf.sql.get(&#34;mac%d%d&#34; % (2, aa))
            if not head:
                head =  &#34;B_B%d&#34; % (aa + 1)
            butt = RCLButt(head, self.rcl, self.rcl2, space=0, ttip = &#34;Lower Action Button %d&#34; % (aa+1))
            butt.ord = 2; butt.id = aa;
            self.buttarr.append(butt)
            #butt.connect(&#34;pressed&#34;, self.buttB, aa + 1)
            self.newbox2.pack_start(butt, 1, 1, 0)
        self.newbox2.pack_start(Gtk.Label(&#34; &#34;), 0, 0, 0)
        combox.pack_start(self.newbox2, 1, 1, 1)

        leftb = Gtk.Button(&#34;&lt;&#34;)
        rightb = Gtk.Button(&#34;&gt;&#34;)
        #obox3.pack_start(leftb, 0,0,0)

        oscroll = Gtk.ScrolledWindow()
        adj =  Gtk.Adjustment()
        oscroll.set_hadjustment(adj)
        oscroll.get_hscrollbar().hide()
        oscroll.add(obox2)
        obox3.pack_start(oscroll, 1, 1, 0)
        #obox3.pack_start(obox2, 1,1,0)

        #obox3.pack_start(rightb, 0,0,0)
        nbox.pack_start(obox3, 1, 1, 0)
        bbox.pack_start(nbox, 0, 0, 0)
        bbox.pack_start(self.hpaned3, 1, 1, 0)

        # Buttom statubar
        #bbox.pack_start(self.hpaned2, 0, 0, 0)
        bbox.pack_start(self.hbox3, 0, 0, 0)

        #self.hpaned2.modify_bg(Gtk.StateType.NORMAL, Gdk.color_parse(&#34;#888888&#34;))

        self.headbar = Gtk.HeaderBar()
        self.headbar.set_decoration_layout(&#34;icon,menu:minimize,maximize,close&#34;)
        self.headbar.set_show_close_button(True)

        #print(&#34;self.headcolor&#34;, self.headcolor)

        button = Gtk.Button()
        button.connect(&#34;pressed&#34;, self.doall)
        button.set_tooltip_text(&#34;Will execute ./cycle.sh in current directory&#34;)

        icon = Gio.ThemedIcon(name=&#34;mail-send-receive-symbolic&#34;)
        image = Gtk.Image.new_from_gicon(icon, Gtk.IconSize.BUTTON)
        button.add(image)

        self.headbar.pack_end(button)

        self.menu = MenuButt((&#34;Open&#34;, &#34;Close&#34;, &#34;Exit&#34;), self.menu_click)
        self.headbar.pack_start(Gtk.Label())
        self.headbar.pack_start(self.menu)
        self.headbar.pack_start(Gtk.Label())

        box = Gtk.Box(orientation=Gtk.Orientation.HORIZONTAL)
        Gtk.StyleContext.add_class(box.get_style_context(), &#34;linked&#34;)

        button = Gtk.Button()
        button.add(Gtk.Arrow(Gtk.ArrowType.DOWN, Gtk.ShadowType.NONE))
        button.set_tooltip_text(&#34;Show / Hide Toolbar&#34;)
        box.add(button)
        box.add(Gtk.Label(&#34; &#34;))
        button.connect(&#34;pressed&#34;, self.ttt)

        button = Gtk.Button()
        button.add(Gtk.Arrow(Gtk.ArrowType.DOWN, Gtk.ShadowType.NONE))
        button.connect(&#34;pressed&#34;, self.mmm)
        button.set_tooltip_text(&#34;Show / Hide menu&#34;)
        box.add(button)
        box.add(Gtk.Label(&#34;   &#34;))

        button = Gtk.Button()
        button.add(Gtk.Arrow(Gtk.ArrowType.LEFT, Gtk.ShadowType.NONE))
        button.connect(&#34;pressed&#34;, self.bleft)
        box.add(button)
        box.add(Gtk.Label(&#34; &#34;))

        button = Gtk.Button()
        button.add(Gtk.Arrow(Gtk.ArrowType.RIGHT, Gtk.ShadowType.NONE))
        button.connect(&#34;pressed&#34;, self.bright)
        box.add(button)

        # See if session is remembred
        oldsess = pedconfig.conf.sql.get(&#34;sess&#34;)
        if oldsess:
            self.sess = oldsess

        self.headbar.pack_start(box)
        self.sess_label =  Gtk.Label(self.sess)
        self.headbar.pack_start(self.sess_label)

        self.mywin.set_titlebar(self.headbar)

        # Set the signal handler for 1s tick
        #signal.signal(signal.SIGALRM, handler_tick)
        #signal.alarm(1)
        # Show newly created buffers:
        #self.mywin.show_all()

        pedfind.load_find_history(False)
        self.update_statusbar(&#34;Initial&#34;, True)

        # Add to accounting:
        self.start_time = time.time()
        timesheet(&#34;Started pyedpro&#34;, self.start_time, 0)

        self.mywin.add(bbox)
        self.mywin.show_all()

        if 1: #not self.mac:
            GLib.timeout_add(1000, handler_tick, self, 0)
            pass

        if not self.mac:
            GLib.timeout_add(100, initial_load, self, 0)
            #initial_load(self, 0)
            pass
        else:
            initial_load(self, 0)

        #print(&#34;initial key state&#34;, Gtk.get_current_event_state())

        # Tried it ... NO
        #GObject.signal_new(&#34;my-custom-signal&#34;, self.mywin, GObject.SIGNAL_RUN_LAST, GObject.TYPE_PYOBJECT,
        #               (GObject.TYPE_PYOBJECT,))
        #self.mywin.connect(&#34;my-custom-signal&#34;, self.threadevent)
        #threading.Thread(target=self.ThredMine, daemon=True).start()
        #GLib.timeout_add(1000, self.ThredCallback)

    #Gtk.Action

    def activate_webtab(self):
        ppp = self.notebook2.get_nth_page(self.notebook2.get_n_pages()-1)
        if ppp:
            # This assumes the webtab is the last one
            self.notebook2.set_current_page(self.notebook2.get_n_pages()-1)
            pp = self.notebook2.get_current_page()
            self.notebook2.get_nth_page(pp).treeview2.grab_focus()

    def activate_notetab(self):
        ppp = self.notebook2.get_nth_page(self.notebook2.get_n_pages()-3)
        if ppp:
            # This assumes the notetab is the one before the last one
            self.notebook2.set_current_page(self.notebook2.get_n_pages()-3)
            pp = self.notebook2.get_current_page()
            self.notebook2.get_nth_page(pp).treeview2.grab_focus()

    def activate_caltab(self):
        ppp = self.notebook2.get_nth_page(self.notebook2.get_n_pages()-4)
        if ppp:
            # This assumes the notetab is the one before the last one
            self.notebook2.set_current_page(self.notebook2.get_n_pages()-4)


    def openmenu(self, strx):

        # Thu 27.Oct.2022 Deactivated TODO
        return

        #for bb in self.accel:
        #for aa in self.acg.list_actions():
        #    #print(&#34;action&#34;, aa.get_name())
        #    sss = aa.get_name().split(&#34; &#34;)
        #    #print(&#34;action&#34;, sss)
        #    if strx in sss[0]:
        #        ttt = &#34;/ui/&#34; + sss[0]
        #        # Gtk.Action
        #        print(&#34;file action:&#34;, aa, aa.get_name(), aa.get_accel_path(), ttt)
        #        #print(aa, dir(aa))
        #        #print(self.acg, dir(self.acg))
        #        #aa.set_sensitive(True)
        #        aa.set_sensitive(True)
        #        aa.set_visible(True)
        #        aa.activate()
        #        break

        # MenuItem
        mb = self.mbar.get_children()
        for aa in mb:
            #print(&#34;menu&#34;, aa, aa.get_label())
            if strx in aa.get_label():
                # Gtk.ImageMenuItem
                print(&#34;opening menu&#34;, aa, aa.get_label(), aa.get_accel_path())
                #print(self.acg, dir(self.acg))
                aa.select()
                #aa.activate()
                #aa.grab_focus()
                #aa.show_all()
                #print(&#34;has&#34;, self.acg.has_action(aa.get_accel_path()))
                #self.acg.activate_action(aa.get_accel_path())
                break
        pass

    def note_button(self, arg1, arg2):
        #print(&#34;note_button&#34;, arg1, arg2)
        pass

    def ThredMine(self):
        cnt = 0
        while(1):
            event = threading.Event()
            result = []
            Gdk.threads_enter()
            #GLib.idle_add(self.ThredCallback, event, cnt)
            event.wait()
            Gdk.threads_leave()
            cnt += 1
            #usleep(1000)
            time.sleep(1)

    def ThredCallback(self): #, event, cnt):

        #Gdk.threads_enter()
        #if pedconfig.conf.verbose:
        #    print(&#34;Callback from thread&#34;, self.rescnt)
        self.rescnt += 1

        #self.mywin.emit(&#34;my-custom-signal&#34;, event)
        #event.set()
        #event = threading.Event()
        #result = []
        #Gdk.threads_leave()
        return True

    def threadevent(self, win, event):
        pass
        #if pedconfig.conf.verbose:
        #    print(&#34;Thread Event&#34;, win, event)

    def rcl(self, butt, arg1, arg2):
        #print(&#34;rcl label&#34;, but.get_label(), butt.ord, butt.id)
        head = pedconfig.conf.sql.get(&#34;mac%d%d&#34; % (butt.ord, butt.id))
        value = pedconfig.conf.sql.get(&#34;val%d%d&#34; % (butt.ord, butt.id))
        if not value:
            self.update_statusbar(&#34;No data on button action &#39;%d.%d&#39;&#34; % (butt.ord, butt.id))
            return
        nn2 = notebook.get_current_page()
        vcurr2 = notebook.get_nth_page(nn2)
        if not vcurr2:
            self.update_statusbar(&#34;Cannot paste from button action &#39;%s&#39;&#34; % head)
            return

        # Patch in variables
        dt = datetime.datetime(1990, 1, 1);
        dt2 = dt.now()
        strx2 =  dt2.strftime(&#34;%a %d.%b.%Y&#34;)
        value = value.replace(&#34;%DATE%&#34;, strx2)

        strx3 =  dt2.strftime(&#34;%H:%M:%S&#34;)
        value = value.replace(&#34;%TIME%&#34;, strx3)
        value = value.replace(&#34;%FILE%&#34;, os.path.basename(vcurr2.area.fname))

        value = value.replace(&#34;%PROJECT%&#34;, self.sess)

        disp = Gdk.Display().get_default()
        clip = Gtk.Clipboard.get_default(disp)
        clip.set_text(value, len(value))
        pedconfig.conf.keyh.acth.ctrl_v(vcurr2.area)
        self.mywin.set_focus(vcurr2.vbox.area)
        self.update_statusbar(&#34;Pasted from button action &#39;%s&#39;&#34; % head)

    def rcl2(self, butt, arg1, arg2):
        #print(&#34;rcl2 label&#34;, &#34;&#39;&#34; + arg1.get_label() + &#34;&#39;&#34;, arg1.ord, arg1.id)
        menu = MenuButt((&#34;Action&#34;, &#34;Configure&#34;, &#34;Face&#34;), self.submenu_click)
        menu.area_rbutton(arg1, arg2)
        menu.ord = arg1.ord; menu.id = arg1.id

    def submenu_click(self, menu, arg1, arg2):
        #print(&#34;submenu_click&#34;, menu.ord, menu.id, arg1, arg2)
        #pedconfig.conf.sql.put(&#34;xx&#34;, xx)
        if arg2 == 0:
            # Call the action -- note menu contains button coordinates
            self.rcl(menu, arg1, arg2)

        if arg2 == 1:
            #print(&#34;submenu_click config&#34;, menu.ord, menu.id, arg1, arg2)
            head = pedconfig.conf.sql.get(&#34;mac%d%d&#34; % (menu.ord, menu.id))
            if not head:
                abarr = &#34;AAB&#34;
                head = &#34;Func %s%d&#34; % (abarr[menu.ord], menu.id)
            clip = pedconfig.conf.sql.get(&#34;val%d%d&#34; % (menu.ord, menu.id))
            if not clip:
                clip = &#34;None&#34;

            filled = peddlg.config_dlg(&#34;Edit Macro Entry&#34;, head, clip)
            if filled[0]:
                pedconfig.conf.sql.put(&#34;mac%d%d&#34; % (menu.ord, menu.id), filled[0])
                pedconfig.conf.sql.put(&#34;val%d%d&#34; % (menu.ord, menu.id), filled[1])
                # Also fill in header
                for aa in self.buttarr:
                    if aa.ord == menu.ord and aa.id == menu.id:
                        aa.set_label(filled[0])

    def buttA(self, arg1, arg2):
        #print(&#34;buttA&#34;, arg1, arg2)
        self.update_statusbar(&#34;ButtA pressed, num {0:d}&#34;.format(arg2), False)

    def buttB(self, arg1, arg2):
        #print(&#34;buttB&#34;, arg1, arg2)
        self.update_statusbar(&#34;ButtB pressed, num {0:d}&#34;.format(arg2), False)

    def menu_open(self, arg, arg2):
        #print(&#34;menu_open&#34;, arg, arg2)
        #self.update_statusbar(&#34;Menu open num {0:d}&#34;.format(arg2))
        pass

    def focus_out2(self, book, obj):
        #print(&#34;nb2 focus out&#34;, obj)
        pass

    def ttt(self, butt):
        self.show_tbar = not self.show_tbar
        if self.show_tbar:
            self.tbar.show()
        else:
            self.tbar.hide()

    def mmm(self, butt):
        self.show_menu = not self.show_menu
        if self.show_menu:
            self.mbar.show()
        else:
            self.mbar.hide()

    def doall(self, butt):
        #pedync.message(&#34;\n&#34; + &#34;Under construction&#34; + &#34;\n&#34;)
        ccc =  &#34;cycle.sh&#34;
        self.update_statusbar(&#34;Executing &#34; + ccc)
        comline2 = [&#34;bash&#34;, ccc, ]
        if not os.path.isfile(ccc):
            print(&#34;Cannot execute %s&#34; % str(comline2), &#34;no such file&#34;)
            self.update_statusbar(&#34;Cannot execute: &#39;&#34; + ccc + &#34;&#39; no such file&#34; )
            return
        try:
            ret = subprocess.Popen(comline2, stderr=subprocess.PIPE, stdout=subprocess.PIPE)
        except:
            print(&#34;Cannot execute %s&#34; % str(comline2), sys.exc_info())
            self.update_statusbar(&#34;Cannot execute: &#34; + ccc + &#34; &#34; + str(sys.exc_info()[1]) )
        try:
            outs, errs = ret.communicate()
        except:
            print(&#34;Cannot communicate with %s&#34; % str(comline), sys.exc_info())
            return
        print(outs, errs)

    def bleft(self, butt):
        #print(butt)
        self.prevwin()

    def bright(self, butt):
        #print(butt)
        self.nextwin()

    def menu_click(self, item, arg1, arg2):
        #print(&#34;menu_click&#34;, item, arg1, arg2)
        if &#34;pen&#34; in arg1:
            self.open()
        if &#34;lose&#34; in arg1:
            self.close_document()
        if &#34;xit&#34; in arg1:
            self.activate_exit()

    def on_drag_begin(self, widget, context):
        global drag_page_number
        drag_page_number = widget.get_current_page()
        print(&#39;drag-begin:&#39;, drag_page_number, widget)

    def on_drag_motion(self, widgt, context, c, y, time):
        #Gdk.drag_status(context, Gdk.DragAction.COPY, time)
        print (&#34;motion&#34;)
        #return True

    def on_drag_drop(self, widget, context, x, y, time):
        #widget.drag_get_data(context, context.list_targets()[-1], time)
        pass
        print (&#34;Dropping&#34;)

    def on_drag_data_received(self, widget, drag_context, x, y, data, info, time):

        print(&#34;Received drop: %s&#34; % data)

        if info == TARGET_ENTRY_TEXT:
            text = data.get_text()
            print(&#34;Received text: %s&#34; % text)

        elif info == TARGET_ENTRY_PIXBUF:
            pixbuf = data.get_pixbuf()
            width = pixbuf.get_width()
            height = pixbuf.get_height()

            print(&#34;Received pixbuf with width %spx and height %spx&#34; % (width, height))

    # --------------------------------------------------------------------

    def label_callb(self, lab, widg, context):
        #print(&#34;label_callb&#34;, context)
        pass

    def make_label(self, strx):
        hbox = Gtk.HBox()
        labx  = Gtk.Label.new_with_mnemonic(strx)
        labx.set_mnemonic_widget(hbox)
        eb = Gtk.EventBox(); eb.add(labx)
        eb.connect_after(&#34;button-press-event&#34;, self.label_callb, strx)
        eb.set_above_child(True)

        hbox.pack_start(eb, 0, 0, 0)
        hbox.show_all()
        return hbox

    def open_recent(self, action):
        if pedconfig.conf.pgdebug &gt; 0:
            print(&#34;open recent&#34;, action)

        #warnings.simplefilter(&#34;ignore&#34;)
        strx = action.get_name()
        #print(strx)
        #warnings.simplefilter(&#34;default&#34;)
        self.openfile(strx);

    def open_recent_sess(self, action):
        if pedconfig.conf.pgdebug &gt; 0:
            print(&#34;open recent sess&#34;, action)
        #warnings.simplefilter(&#34;ignore&#34;)
        strx = action.get_name()
        #print(strx)
        #warnings.simplefilter(&#34;default&#34;)
        self.opensess(strx);

    def opensess(self, strx):
        #print(&#34;opensess&#34;, strx)

        pedlog.log(&#34;Opening session&#34;, strx, time.ctime(None))
        pedconfig.conf.pedwin.sess = os.path.basename(strx)
        self.sess_label.set_text(pedconfig.conf.pedwin.sess)

        sesslist = []
        fh = open(strx, &#34;rb&#34;)
        try:
            sesslist = pickle.load(fh)
        except:
            print(&#34;Cannot load sess list&#34;, sys.exc_info())
            fh.close()
            return
        fh.close()
        for fff in str.split(sesslist, &#34;\n&#34;):
            #print (&#34;Session opening file:&#34;, &#34;&#39;&#34; + fff + &#34;&#39;&#34;)
            pedconfig.conf.pedwin.openfile(fff)
            usleep(10)

    # --------------------------------------------------------------------
    # Add MRU

    def add_mru(self, mergex, merge_id, action_group):

        for aa in self.oh.histarr:
            if aa[2]:
                #print(&#34;.oh&#34;, aa)
                fname = aa[2]
                ac = Gtk.Action(fname, fname, fname, None)
                ac.connect(&#39;activate&#39;, self.open_recent)
                action_group.add_action(ac)
                mergex.add_ui(merge_id, &#34;/MenuBar/FileMenu/Recent/Recent Files/&#34;,
                    fname, fname, Gtk.UIManagerItemType.MENUITEM, False)

        for aa in self.os.histarr:
            if aa[2]:
                #print(&#34;.os&#34;, aa)
                fname = aa[2]
                ac = Gtk.Action(fname, fname, fname, None)
                ac.connect(&#39;activate&#39;, self.open_recent_sess)
                action_group.add_action(ac)
                mergex.add_ui(merge_id, &#34;/MenuBar/FileMenu/Sessions/Recent Sessions/&#34;,
                    fname, fname, Gtk.UIManagerItemType.MENUITEM, False)

    def area_winstate(self, arg1, arg2):
        pass
        #print( &#34;area_winstate&#34;, arg1, arg2)
        #print( &#34;state&#34;, self.mywin.get_state())

    def config_event(self, win, event):
        pass
        #print( &#34;config_event&#34;, event.x, event.y, &#34;old events&#34;, self.old_x, self.old_y)
        self.old_x = event.x
        self.old_y = event.y

    def unmap(self, arg1, arg2):
        #print( &#34;unmap&#34;, arg1, arg2)
        pass

    def tree_sel_row(self, xtree):
        #print(&#34;tree_sel_row&#34;, xtree)
        pass
        #sel = xtree.get_selection()
        #xmodel, xiter = sel.get_selected()
        #if xiter:
        #    xstr = xmodel.get_value(xiter, 0)
        #    vcurr = notebook.get_nth_page(notebook.get_current_page())
        #    vcurr.area.locate(xstr)

    def tree_sel_row2(self, xtree):
        pass
        #sel = xtree.get_selection()
        #xmodel, xiter = sel.get_selected()
        #print(&#34;tree_sel_row2&#34;, xtree, xmodel, xiter)
        #if xiter:
        #    xstr = xmodel.get_value(xiter, 0)
        #    vcurr = notebook.get_nth_page(notebook.get_current_page())
        #    vcurr.area.locate(xstr)

    def tree_sel(self, xtree, xiter, xpath):
        #print(&#34;tree_sel&#34;, xtree, xiter, xpath)
        # Focus on main doc
        sel = xtree.get_selection()
        xmodel, xiter = sel.get_selected()
        if xiter:
            xstr = xmodel.get_value(xiter, 0)
            vcurr = notebook.get_nth_page(notebook.get_current_page())
            vcurr.area.locate(xstr)
            # Focus on main doc
            vcurr = notebook.get_nth_page(notebook.get_current_page())
            self.mywin.set_focus(vcurr.vbox.area)

    def tree_sel2(self, xtree, xiter, xpath):
        #print(&#34;tree_sel2&#34;, xtree, xiter, xpath)
        # Focus on main doc
        sel = xtree.get_selection()
        xmodel, xiter = sel.get_selected()
        if xiter:
            xstr = xmodel.get_value(xiter, 0)
            vcurr = notebook.get_nth_page(notebook.get_current_page())
            vcurr.area.locate(xstr)
            # Focus on main doc
            vcurr = notebook.get_nth_page(notebook.get_current_page())
            self.mywin.set_focus(vcurr.vbox.area)

    # --------------------------------------------------------------------

    def area_key(self, area, event):

        &#39;&#39;&#39; Call the document&#39;s key handler after some inspection &#39;&#39;&#39;

        if pedconfig.conf.pgdebug &gt; 4:
            print(&#34;pedwin key&#34;, event.keyval, event.state)

        if pedconfig.conf.keylog_on:
            if self.klfp:
                if event.type == Gdk.EventType.KEY_PRESS:
                    dt2 = datetime.datetime(1990, 1, 1).now()
                    strx2 =  dt2.strftime(&#34;%d.%b.%Y %H:%M&#34;)
                    fname = &#34;Empty&#34;
                    vcurr = notebook.get_nth_page(notebook.get_current_page())
                    if vcurr:
                        fname = os.path.basename(vcurr.vbox.area.fname)
                    print(strx2, fname,
                                event.keyval, &#34;&#39;&#34; + event.string
                                        + &#34;&#39;&#34;, int(event.state), file=self.klfp)

        if event.keyval ==  Gdk.KEY_F11:
            if event.type == Gdk.EventType.KEY_PRESS:
                if self.full:
                    self.mywin.unfullscreen()
                    self.full = False
                else:
                    self.mywin.fullscreen()
                    self.full = True
                return True

        #if event.keyval ==  Gdk.KEY_Alt_L:
        #    if event.type == Gdk.EventType.KEY_RELEASE:
        #        self.altkey = True
        #        #if time.time() - self.alttime &gt; 2:
        #        #    self.show_menu = not self.show_menu
        #        #print(&#34;self.alttime&#34;, time.time() - self.alttime)
        #        self.alttime = 0
        #    else:
        #        #print(&#34;pedwin ALT key down&#34;, event.keyval)
        #        self.altkey = False
        #        if self.alttime == 0:
        #            self.alttime = time.time()

        #if self.show_menu:       x
        #    self.mbar.show()
        #else:
        #    self.mbar.hide()

        # Inspect key press before treeview gets it
        if self.mywin.get_focus() == self.treeview:
            print(&#34;Key for treeview&#34;, event.state)
            # Do key down:
            if  event.type == Gdk.EventType.KEY_PRESS:
                if event.keyval == Gdk.KEY_Alt_L or \
                        event.keyval == Gdk.KEY_Alt_R:
                    self.alt = True

            if event.keyval == Gdk.KEY_Tab:
                print (&#34;pedwin TREE TAB&#34;, event.keyval)

            if event.keyval &gt;= Gdk.KEY_1 and event.keyval &lt;= Gdk.KEY_9:
                print (&#34;pedwin Alt num&#34;, event.keyval - Gdk.KEY_1)
                # Focus on main doc
                vcurr = notebook.get_nth_page(notebook.get_current_page())
                self.mywin.set_focus(vcurr.vbox.area)

            elif  event.type == Gdk.EventType.KEY_RELEASE:
                if event.keyval == Gdk.KEY_Alt_L or \
                      event.keyval == Gdk.KEY_Alt_R:
                    self.alt = False

        # Sad sad; do system shortcuts
        if event.type == Gdk.EventType.KEY_PRESS:
            # alt
            if event.state &amp; Gdk.ModifierType.MOD1_MASK:
                #print(&#34;alt&#34;, event.keyval)

                if event.keyval &gt;= Gdk.KEY_0 and event.keyval &lt;= Gdk.KEY_9:
                    if event.keyval == Gdk.KEY_0:
                        self.notebook.grab_focus()
                        old = self.notebook.get_current_page()
                        print(&#34;Set current&#34;, old)
                        self.notebook.set_current_page(old)
                    else:
                        num = event.keyval - Gdk.KEY_1
                        self.notebook.grab_focus()
                        if pedconfig.conf.pgdebug &gt; 5:
                            print( &#34;PedWin Keyhand Alt num&#34;, num)
                        if num &gt;  self.notebook.get_n_pages() - 1:
                            self.update_statusbar(&#34;Invalid tab (page) index.&#34;)
                        else:
                            old = self.notebook.get_current_page()
                            if old == num:
                                self.update_statusbar(&#34;Already at page %d ...&#34; % old)
                            else:
                                self.notebook.set_current_page(num)
                    return True

                # These are the menu accel keys; pass it to the system
                #  -- really dislike the accel system; takes over too many things
                # Cannot drive it programmatically -- maybe some help needed
                if event.keyval == ord(&#39;f&#39;) or event.keyval == ord(&#39;e&#39;) \
                    or event.keyval == ord(&#39;m&#39;) or \
                        event.keyval == ord(&#39;h&#39;):
                    return False

                if event.keyval == ord(&#39;o&#39;) or event.keyval == ord(&#39;O&#39;):
                    #print(&#34;mainwin alt-o&#34;)
                    self.altopen()
                    return True

            # ctrl-shift
            elif event.state &amp; Gdk.ModifierType.CONTROL_MASK and \
                    event.state &amp; Gdk.ModifierType.SHIFT_MASK:
                #print(&#34;control shift&#34;, event.keyval)
                if event.keyval == ord(&#39;S&#39;):
                    #print(&#34;save as&#34;, event.keyval)
                    self.save(True)
                    return True

                if event.keyval == ord(&#39;O&#39;):
                    #print(&#34;load session&#34;, event.keyval)
                    load_sess()
                    return True
            # ctrl
            elif event.state &amp; Gdk.ModifierType.CONTROL_MASK:
                if event.keyval == ord(&#39;o&#39;):
                    #print(&#34;open&#34;, keyval)
                    self.open()
                    return True
                if event.keyval == ord(&#39;s&#39;):
                    #print(&#34;save&#34;, event.keyval)
                    self.save()
                    return True
                if event.keyval == ord(&#39;n&#39;):
                    self.newfile()
                    return True

        # This was needed ad ALT-a and ALT-b ....
        # .... mysteriousely stopped working
        vcurr = notebook.get_nth_page(notebook.get_current_page())
        if vcurr:
            # See which window has focus
            got = self.mywin.get_focus()
            if vcurr.vbox.area == got:
                vcurr.vbox.area.area_key(area, event)
                return True
            elif vcurr.vbox2.area == got:
                vcurr.vbox2.area.area_key(area, event)
                return True
            elif self.diffpane.area == got:
                self.diffpane.area.area_key(area, event)
                return True
            else:
                return None
        else:
            pass
            #print(&#34;did not send key&#34;)  # this is normal
            return None

        return True             # Handled it
        #return None

    # Simplified alt open

    def altopen(self):
        pare = None
        vcurr = notebook.get_nth_page(notebook.get_current_page())
        if vcurr:
            pare = vcurr.vbox.area
        #print(&#34;pare&#34;, pare)
        fnames = pedofd.ofd(&#34;&#34;, pare)
        #print(&#34;openfile fnames&#34;, fnames)
        for fff in fnames:
            #print(&#34;Opening&#34;&#34;, fff)
            self.openfile(fff)
            pass

    def get_height(self):
        xx, yy = self.mywin.get_size()
        return yy

    def get_width(self):
        xx, yy = self.mywin.get_size()
        return xx

    def start_tree(self):

        global treestore
        if not treestore:
            treestore = Gtk.TreeStore(str)

    def start_tree2(self):

        global treestore2
        if not treestore2:
            treestore2 = Gtk.TreeStore(str)

        # Delete previous contents
        try:
            while True:
                root = treestore.get_iter_first()
                if not root:
                    break
                try:
                    treestore.remove(root)
                except:
                    print(&#34;Exception on rm treestore&#34;)
        except:
            print(&#34;strt_tree&#34;, sys.exc_info())
            pass

        piter = treestore.append(None, [&#34;Extracting ..&#34;])
        treestore.append(piter, [&#34;None ..&#34;])

    # --------------------------------------------------------------------
    def create_tree(self, text = None):

        global treestore
        self.start_tree()

        # create the TreeView using treestore
        tv = Gtk.TreeView(model=treestore)

        # create a CellRendererText to render the data
        cell = Gtk.CellRendererText()

        # create the TreeViewColumn to display the data
        tvcolumn = Gtk.TreeViewColumn(&#39;Functions&#39;)

        # add the cell to the tvcolumn and allow it to expand
        tvcolumn.pack_start(cell, True)

        # set the cell &#34;text&#34; attribute to column 0 - retrieve text
        # from that column in treestore
        tvcolumn.add_attribute(cell, &#39;text&#39;, 0)

        # add tvcolumn to treeview
        tv.append_column(tvcolumn)

        return tv

    # --------------------------------------------------------------------
    def create_vartree(self, text = None):

        global treestore2
        self.start_tree2()

        # create the TreeView using treestore
        tv = Gtk.TreeView(model=treestore2)

        # create a CellRendererText to render the data
        cell = Gtk.CellRendererText()

        # create the TreeViewColumn to display the data
        tvcolumn = Gtk.TreeViewColumn(&#39;Local Scope&#39;)

        # add the cell to the tvcolumn and allow it to expand
        tvcolumn.pack_start(cell, True)

        # set the cell &#34;text&#34; attribute to column 0 - retrieve text
        # from that column in treestore
        tvcolumn.add_attribute(cell, &#39;text&#39;, 0)

        # add tvcolumn to treeview
        tv.append_column(tvcolumn)

        return tv

    def xupdate_treestore(self, text):
        pass

    # --------------------------------------------------------------------
    def update_treestore(self, text):

        global treestore, treeview
        if not treestore: return

        # Remember old position
        #Gtk.TreeViewColumn Gtk.TreeView Gtk.TreeStore
        old_sel = None
        try:
            path = treeview.get_path_at_pos(0, 0)
            #print(&#34;path&#34;, path)
            xiter = treestore.get_iter(path[0])
            #print(&#34;xiter&#34;, xiter)
            if xiter:
                old_sel = treestore.get_value(xiter, 0)

        except:
            #print(&#34;update_tree old pos&#34;, sys.exc_info())
            pass

        # Delete previous contents
        try:
            while True:
                root = treestore.get_iter_first()
                if not root:
                    break
                try:
                    treestore.remove(root)
                except:
                    print(&#34;except: treestore remove&#34;)
        except:
            print(&#34;update_tree&#34;, sys.exc_info())
            pass

        if not text:
            return
        try:
            for line in text:
                piter = treestore.append(None, [cut_lead_space(line)])
            # Back to old line
            treeview.scroll_to_cell(path[0], None, False, 0, 0)
        except:
            #print(&#34;Exception in append treestore&#34;, sys.exc_info())
            pass

    # --------------------------------------------------------------------
    def update_treestore2(self, text):

        global treestore2

        if not treestore2: return
        # Delete previous contents
        try:
            while True:
                root = treestore2.get_iter_first()
                if not root:
                    break
                try:
                    treestore2.remove(root)
                except:
                    print(&#34;except: treestore remove&#34;)
        except:
            print(&#34;update_tree2&#34;, sys.exc_info())

        if not text:
            return

        try:
            for line in text:
                piter = treestore2.append(None, [cut_lead_space(line)])
        except:
            pass
            #print(&#34;Exception in append treestore2&#34;, sys.exc_info())

    # --------------------------------------------------------------------
    # Handlers: (deactivated)

    def area_event(self, win, act):
        pass
        #print(  &#34;pedwin area event&#34;, win, act)

    def area_leave(self, win, act):
        pass
        print(  &#34;pedwin area leave&#34;, win, act)

    def area_enter(self, win, act):
        pass
        #print(  &#34;pedwin area enter&#34;, win, act)

    def area_focus(self, win, act):
        pass
        #print(  &#34;pedwin area focus&#34;, win, act)

    def area_focus_in(self, win, act):
        #print(  &#34;area focus in&#34;, win, act)
        # This was needed as pygtk leaves the alt key hanging
        pedconfig.conf.keyh.reset()
        # Focus on main doc
        vcurr = notebook.get_nth_page(notebook.get_current_page())
        if vcurr:
            self.mywin.set_focus(vcurr.vbox.area)

        vcurr2 = notebook2.get_nth_page(notebook2.get_current_page())
        cc = notebook2.get_n_pages()
        for mm in range(cc):
            curr = notebook2.get_nth_page(mm)
            try:
                if curr == vcurr2:
                    #print(&#34;sending page focus signal to &#34;, curr)
                    curr.focus_in()
                    pass
            except:
                pass
        pass

    def area_focus_out(self, win, act):
        #print  (&#34;area focus out&#34;, win, act)
        global savearr
        cc = notebook.get_n_pages()
        for mm in range(cc):
            curr = notebook.get_nth_page(mm)
            #print(&#34;saving tab &#34;, curr)
            try:
                #savearr.append(curr.area.fname)
                #print(&#34;Adding&#34;, curr.area.fname)
                #curr.vbox.area.save()
                #curr.vbox.focus_out()
                pass
            except:
                #print(sys.exc_info())
                pass
        pass

    def area_size(self, win, rect):
        #print(  &#34;area size&#34;, rect)
        #self.hpaned2.set_position(self.get_width() - 280)
        pass

    def  note_focus_in(self, win, act):
        pass
        #print( &#34;note_focus_in&#34;, win, act)
        vcurr = notebook.get_nth_page(notebook.get_current_page())
        if vcurr:
            self.mywin.set_focus(vcurr.vbox.area)
            vcurr.vbox.area.doidle = 1

    def note_enter_notify(self, win):
        pass
        #print( &#34;note_enter_notify&#34;, win)

    def  note_grab_focus_cb(self, win):
        #print( &#34;note_grab_focus_cb&#34;, win)
        vcurr = notebook.get_nth_page(notebook.get_current_page())
        if vcurr:
            self.mywin.set_focus(vcurr.vbox.area)

    def  note_swpage_cb2(self, tabx, page, num):
        #print (&#34;note_swpage2&#34;, num)
        cc = notebook2.get_n_pages()
        for mm in range(cc):
            curr = notebook2.get_nth_page(mm)
            #print(&#34;sending page change signal to &#34;, curr)
            try:
                curr.switched(page)
            except:
                pass

    def  note_swpage_cb(self, tabx, page, num):
        #print( &#34;note_swpage&#34;, num)
        vcurr = tabx.get_nth_page(num)
        self.mywin.set_title(&#34;pyedpro: &#34; + vcurr.area.fname)
        self.mywin.set_focus(vcurr.vbox.area)
        hhh = hash_name(vcurr.area.fname)
        fname = os.path.basename(vcurr.area.fname)
        backx = vcurr.area.currback
        self.update_statusbar(&#34;Switched to &#39;{1:s}&#39;   {2:s}_{3:d} &#34;
                                    .format(num, fname, hhh, backx ), True)

    def  note_page_cb(self, tabx, child, num):
        pass
        #print( &#34;note_page&#34;)

    def note_focus_cb(self, tabx, foc):
        #print( &#34;note_focus_cb&#34;)
        vcurr = notebook.get_nth_page(notebook.get_current_page())
        if vcurr:
            self.mywin.set_focus(vcurr.vbox.area)

    def note_create_cb(self, tabx, page, xx, yy):
        pass
        #print( &#34;note_create&#34;)

    # Devhelp Message handler
    def activate_dhelp(self, action):
        self.update_statusbar(&#34;Showing DevHelp&#34;)
        nn2 = notebook.get_current_page()
        vcurr2 = notebook.get_nth_page(nn2)
        if vcurr2:
            pedconfig.conf.keyh.acth.f2(vcurr2.area)

    # Devhelp Message handler
    def activate_khelp(self, action):
        self.update_statusbar(&#34;Showing Keyboard Help&#34;)
        nn2 = notebook.get_current_page()
        vcurr2 = notebook.get_nth_page(nn2)
        if vcurr2:
            vcurr2.area.shift = True
            pedconfig.conf.keyh.acth.f2(vcurr2.area)
            vcurr2.area.shift = False

    def activate_qhelp(self, action):
        self.update_statusbar(&#34;Showing quick help&#34;)
        rr = get_exec_path(&#34;QHELP&#34;)
        launch_pangview(rr)

    def activate_about(self, action):
        self.update_statusbar(&#34;Showing About Dialog&#34;)
        pedync.about(self)

    def newfile(self, newname = &#34;&#34;):

        fff = &#34;&#34;

        if newname == &#34;&#34;:
            # Find non existing file
            cnt = self.fcount + 1; fff = &#34;&#34;
            base, ext = os.path.splitext(pedconfig.conf.UNTITLED)
            while True:
                fff =  &#34;%s_%d.txt&#34; % (base, cnt)
                #print( fff)
                if not os.path.isfile(fff):
                    break
                cnt += 1

            self.fcount = cnt
        else:
            fff = newname
            # Touch
            try:
                open(fff, &#34;w&#34;).close()
            except:
                sss = &#34;Cannot create file %s&#34; % newname
                self.update_statusbar(sss)
                print(sss,  sys.exc_info())
                pedync.message(&#34;\n&#34; + sss + &#34;\n&#34;)
                return

        # Try and change access/ownership to group write
        try:
            ostat = os.stat(fff)
            os.chmod(fff, ostat.st_mode | stat.S_IWGRP)
        except:
            #print(&#34;Cannot change group write on &#39;%s&#39;&#34; % fff,  sys.exc_info())
            pass

        vpaned = edPane([])
        vpaned.area.fname = os.path.realpath(fff) + &#34;&#34;
        global notebook
        add_page(vpaned)
        vpaned.area.set_tablabel()

        #label = Gtk.Label(&#34; &#34; + os.path.basename(aa) + &#34; &#34;)
        #notebook.set_tab_label(vpaned, label)
        self.mywin.show_all()

        # Make it current
        nn = notebook.get_n_pages()
        if nn:
            vcurr = notebook.set_current_page(nn-1)
            vcurr = notebook.get_nth_page(nn-1)
            self.mywin.set_focus(vcurr.vbox.area)

    def makefilter(self, mask, name):
        filter =  Gtk.FileFilter.new()
        filter.add_pattern(mask)
        filter.set_name(name)
        return filter

    # Traditional open file
    def open(self):

        #warnings.simplefilter(&#34;ignore&#34;)
        fc = Gtk.FileChooserDialog(title=&#34;Open file&#34;, transient_for=self.mywin, \
                        action=Gtk.FileChooserAction.OPEN)

        but =   &#34;Cancel&#34;, Gtk.ButtonsType.CANCEL, &#34;Open File&#34;, Gtk.ButtonsType.OK
        fc.add_buttons(*but)
        #warnings.simplefilter(&#34;default&#34;)

        filters = []
        filters.append(self.makefilter(&#34;*.*&#34;, &#34;All files (*.*)&#34;))
        filters.append(self.makefilter(&#34;*.py&#34;, &#34;Python files (*.py)&#34;))
        filters.append(self.makefilter(&#34;*.c&#34;, &#34;&#39;C&#39; source files (*.c)&#34;))
        filters.append(self.makefilter(&#34;*.h&#34;, &#34;&#39;H&#39; source files (*.h)&#34;))
        filters.append(self.makefilter(&#34;*.txt&#34;, &#34;Text files (*.txt)&#34;))
        filters.append(self.makefilter(&#34;*.md&#34;, &#34;Markup files (*.md)&#34;))
        filters.append(self.makefilter(&#34;*.ped&#34;, &#34;PED files (*.ped)&#34;))

        if filters:
            for aa in filters:
                fc.add_filter(aa)

        fc.set_default_response(Gtk.ButtonsType.OK)
        fc.set_current_folder(os.getcwd())
        fc.connect(&#34;response&#34;, self.done_open_fc)
        fc.connect(&#34;current-folder-changed&#34;, self.folder_ch )

        #fc.set_current_name(self.fname)
        fc.run()

    def save(self, flag = False):
        vcurr = notebook.get_nth_page(notebook.get_current_page())
        if flag:
            vcurr.area.saveas()
            #self.mywin.set_title(&#34;pyedpro: &#34; + vcurr.area.fname)
        else:
            vcurr.area.save()

    def copy(self):
        nn2 = notebook.get_current_page()
        vcurr2 = notebook.get_nth_page(nn2)
        if vcurr2:
            pedconfig.conf.keyh.acth.ctrl_c(vcurr2.area)

    def cut(self):
        nn2 = notebook.get_current_page()
        vcurr2 = notebook.get_nth_page(nn2)
        if vcurr2:
            pedconfig.conf.keyh.acth.ctrl_x(vcurr2.area)

    def tts(self):
        nn2 = notebook.get_current_page()
        vcurr2 = notebook.get_nth_page(nn2)
        if vcurr2:
             pedconfig.conf.keyh.acth.ctrl_alt_r(vcurr2.area)

    def paste(self):
        nn2 = notebook.get_current_page()
        vcurr2 = notebook.get_nth_page(nn2)
        if vcurr2:
            pedconfig.conf.keyh.acth.ctrl_v(vcurr2.area)

    # -------------------------------------------------------------------
    # Menu callback

    def activate_action(self, action):

        #dialog = Gtk.MessageDialog(None, Gtk.DIALOG_DESTROY_WITH_PARENT,
        #    Gtk.MESSAGE_INFO, Gtk.BUTTONS_CLOSE,
        #    &#39;Action: &#34;%s&#34; of type &#34;%s&#34;&#39; % (action.get_name(), type(action)))

        # Close dialog on user response
        #dialog.connect (&#34;response&#34;, lambda d, r: d.destroy())
        #dialog.show()

        warnings.simplefilter(&#34;ignore&#34;)
        strx = action.get_name()
        warnings.simplefilter(&#34;default&#34;)

        if 1: #pedconfig.conf.verbose:
            print (&#34;activate_action with:&#34;, strx)

        if strx == &#34;Close All&#34;:
            self.closeall()

        if strx == &#34;Load Session&#34;:
            #print(&#34;Loading session&#34;)
            load_sess()

        if strx == &#34;Save Session&#34;:
            #print(&#34;Saving session&#34;)
            # Gather all file names
            accum = &#34;&#34;
            nn = notebook.get_n_pages(); cnt = 0; cnt2 = 0
            while True:
                if cnt &gt;= nn: break
                ppp = notebook.get_nth_page(cnt)
                #print (&#34;file:&#34;, ppp.area.fname)
                accum +=  ppp.area.fname + &#34;\n&#34;
                cnt += 1
            #print (&#34;file list&#34;, accum)
            save_sess(accum)

            self.update_statusbar(&#34;Session %s saved.&#34; % (&#34;noname&#34;))

        if strx == &#34;Start Terminal&#34;:
            #print(&#34;Starting terminal&#34;)
            #if os.name == &#34;nt&#34;:
            #    os.system(&#34;C:\\msys64\\mingw32.exe&#34;)
            self.start_term()

        if strx == &#34;New&#34;:
            self.newfile()

        if strx == &#34;Open&#34;:
            #print(&#34;open frm menu&#34;)
            self.open()

        if strx == &#34;Save&#34;:
            self.save()

        if strx == &#34;SaveAs&#34;:
            self.save(True)

        if strx == &#34;Close&#34;:
            self.close_document()

        if strx == &#34;Copy&#34;:
            self.copy()

        if strx == &#34;Cut&#34;:
            self.cut()

        if strx == &#34;Paste&#34;:
            self.paste()

        if strx == &#34;Goto&#34;:
            nn2 = notebook.get_current_page()
            vcurr2 = notebook.get_nth_page(nn2)
            if vcurr2:
                pedconfig.conf.keyh.acth.alt_g(vcurr2.area)

        if strx == &#34;Find&#34;:
            #print &#34;find&#34;
            nn2 = notebook.get_current_page()
            vcurr2 = notebook.get_nth_page(nn2)
            if vcurr2:
                pedconfig.conf.keyh.acth.ctrl_f(vcurr2.area)

        if strx == &#34;Record&#34;:
            #print &#34;record&#34;
            nn2 = notebook.get_current_page()
            vcurr2 = notebook.get_nth_page(nn2)
            if vcurr2:
                pedconfig.conf.keyh.acth.f7(vcurr2.area)

        if strx == &#34;Play&#34;:
            nn2 = notebook.get_current_page()
            vcurr2 = notebook.get_nth_page(nn2)
            if vcurr2:
                pedconfig.conf.keyh.acth.f8(vcurr2.area)

        if strx == &#34;Spell&#34;:
            nn2 = notebook.get_current_page()
            vcurr2 = notebook.get_nth_page(nn2)
            if vcurr2:
                pedconfig.conf.keyh.acth.f9(vcurr2.area)

        if strx == &#34;Spell2&#34;:
            nn2 = notebook.get_current_page()
            vcurr2 = notebook.get_nth_page(nn2)
            if vcurr2:
                pedconfig.conf.keyh.acth.f9(vcurr2.area, True)

        if strx == &#34;MakeRO&#34;:
            nn = notebook.get_n_pages(); cnt = 0; cnt2 = 0
            vcurr2 = notebook.get_nth_page(notebook.get_current_page())
            while True:
                if cnt &gt;= nn: break
                ppp = notebook.get_nth_page(cnt)
                #print (&#34;Make read only file:&#34;, ppp.area.fname)
                ppp.area.readonly = True
                ppp.area.set_tablabel()
                if ppp == vcurr2:
                    ppp.area.invalidate()
                cnt += 1
            self.update_statusbar(&#34;Made all buffers READ only&#34;)

        if strx == &#34;MakeRW&#34;:
            nn = notebook.get_n_pages(); cnt = 0; cnt2 = 0
            vcurr2 = notebook.get_nth_page(notebook.get_current_page())
            while True:
                if cnt &gt;= nn: break
                ppp = notebook.get_nth_page(cnt)
                #print (&#34;Make read only file:&#34;, ppp.area.fname)
                ppp.area.readonly = False
                ppp.area.set_tablabel()
                if ppp == vcurr2:
                    ppp.area.invalidate()
                cnt += 1
            self.update_statusbar(&#34;Made all buffers READ/WRITE&#34;)

        if strx == &#34;unColorBar&#34;:
            if not self.headcolor:
                style = self.headbar.get_style_context()
                self.headcolor = style.get_property(&#34;background-color&#34;, Gtk.StateFlags.NORMAL)

            self.headbar.override_background_color(
                    Gtk.StateFlags.NORMAL, self.headcolor)
            notebook.override_background_color(
                    Gtk.StateFlags.NORMAL, self.headcolor)
            self.update_statusbar(&#34;Color Bar Reset&#34;)

        if strx == &#34;ColorBar&#34;:
            #states =  (Gtk.StateFlags.NORMAL, Gtk.StateFlags.ACTIVE,
            #    Gtk.StateFlags.VISITED, Gtk.StateFlags.FOCUSED,
            #        Gtk.StateFlags.SELECTED, Gtk.StateFlags.INSENSITIVE,
            #         Gtk.StateFlags.BACKDROP, Gtk.StateFlags.DIR_RTL,
            #         Gtk.StateFlags.VISITED, Gtk.StateFlags.INCONSISTENT,
            #         Gtk.StateFlags.DIR_LTR)
            # for aa in states:  # tested .. no difference
            #    self.headbar.override_background_color(
            #        aa, Gdk.RGBA(.8, .9, .8) )

            if not self.headcolor:
                style = self.headbar.get_style_context()
                self.headcolor = style.get_property(&#34;background-color&#34;, Gtk.StateFlags.NORMAL)

            self.headbar.override_background_color(
                    Gtk.StateFlags.NORMAL, Gdk.RGBA(.8, .86, .85) )

            notebook.override_background_color(
                    Gtk.StateFlags.NORMAL, Gdk.RGBA(.8, .86, .85) )

            self.update_statusbar(&#34;Color Bar Changed TEAL&#34;)


        if strx == &#34;RedBar&#34;:
            if not self.headcolor:
                style = self.headbar.get_style_context()
                self.headcolor = style.get_property(&#34;background-color&#34;, Gtk.StateFlags.NORMAL)

            self.headbar.override_background_color(
                    Gtk.StateFlags.NORMAL, Gdk.RGBA(.86, .80, .80) )

            notebook.override_background_color(
                    Gtk.StateFlags.NORMAL, Gdk.RGBA(.86, .80, .80) )

            self.update_statusbar(&#34;Color Bar Changed RED&#34;)

        if strx == &#34;StopDiff&#34;:
            nn = notebook.get_n_pages(); cnt = 0; cnt2 = 0
            vcurr2 = notebook.get_nth_page(notebook.get_current_page())
            while True:
                if cnt &gt;= nn: break
                ppp = notebook.get_nth_page(cnt)
                #print (&#34;Make read only file:&#34;, ppp.area.fname)
                ppp.area.diffmode = 0
                ppp.area.set_tablabel()
                if ppp == vcurr2:
                    ppp.area.invalidate()
                cnt += 1
            self.update_statusbar(&#34;Stopped diffing.&#34;)

        if strx == &#34;TogStrip&#34;:
            self.togstrip = not self.togstrip
            print(&#34;Toggle strip&#34;, self.togstrip)
            vcurr = notebook.get_nth_page(notebook.get_current_page())
            if self.togstrip:
                vcurr.area.strip = 50
            else:
                vcurr.area.strip = 0
            vcurr.area.invalidate()

        if strx == &#34;Animate&#34;:
            nn2 = notebook.get_current_page()
            vcurr2 = notebook.get_nth_page(nn2)
            if vcurr2:
                pedconfig.conf.keyh.acth.f8(vcurr2.area, True)

        if strx == &#34;Undo&#34;:
            nn2 = notebook.get_current_page()
            vcurr2 = notebook.get_nth_page(nn2)
            if vcurr2:
                pedconfig.conf.keyh.acth.ctrl_z(vcurr2.area)

        if strx == &#34;Redo&#34;:
            nn2 = notebook.get_current_page()
            vcurr2 = notebook.get_nth_page(nn2)
            if vcurr2:
                pedconfig.conf.keyh.acth.ctrl_y(vcurr2.area)

        if strx == &#34;SaveAll&#34;:
            nn2 = notebook.get_current_page()
            vcurr2 = notebook.get_nth_page(nn2)
            if vcurr2:
                pedconfig.conf.keyh.acth.alt_a(vcurr2.area)

        if strx == &#34;Discard Undo&#34;:
            nn2 = notebook.get_current_page()
            vcurr2 = notebook.get_nth_page(nn2)
            if vcurr2:
                vcurr2.area.delundo()

        if strx == &#34;Savemacro&#34;:
            nn2 = notebook.get_current_page()
            vcurr2 = notebook.get_nth_page(nn2)
            if vcurr2:
                vcurr2.area.savemacro()

        if strx == &#34;Loadmacro&#34;:
            nn2 = notebook.get_current_page()
            vcurr2 = notebook.get_nth_page(nn2)
            if vcurr2:
                vcurr2.area.loadmacro()

        if strx == &#34;NextWin&#34;:
            self.nextwin()

        if strx == &#34;PrevWin&#34;:
            self.prevwin()

        if strx == &#34;ShowLog&#34;:
            pedlog.show_logwin()

        if strx.find(&#34;/sess_&#34;) &gt;= 0:
            fname = pedconfig.conf.sql.get_str(strx)
            self.openfile(fname)

        if strx == &#34;Colors&#34;:
            nn2 = notebook.get_current_page()
            vcurr2 = notebook.get_nth_page(nn2)
            if vcurr2:
                pass
                pedcolor.colordlg(self, vcurr2.area)

        if strx == &#34;Fonts&#34;:
            nn2 = notebook.get_current_page()
            vcurr2 = notebook.get_nth_page(nn2)
            if vcurr2:
                pedfont.selfont(self, vcurr2.area)

        if strx == &#34;Settings&#34;:
            self.update_statusbar(&#34;Showing Settings Dialog&#34;)
            pedync.message(&#34;\n    Settings: Work in progress    \n&#34;)

        if strx == &#34;Help&#34;:
            #pedync.message(&#34;\n    Help: Work in progress    \n&#34;)
            nn2 = notebook.get_current_page()
            vcurr2 = notebook.get_nth_page(nn2)
            if vcurr2:
                pedconfig.conf.keyh.acth.f1(vcurr2.area)

        if strx == &#34;KeyDoc&#34;:
            self.update_statusbar(&#34;Showing Keyboard Help&#34;)
            fname = get_exec_path(&#34;KEYS.TXT&#34;)
            self.openfile(fname)

    def closeall(self):
        cc = notebook.get_n_pages()
        for aa in range(cc-1, -1, -1):
            #print (&#34;closing doc index&#34;, aa)
            vcurr = notebook.get_nth_page(aa)
            vcurr.area.closedoc()
            notebook.remove_page(aa)
        self.mywin.set_title(&#34;pyedpro &#34;)

    def close_document(self, other = None):
        cc = notebook.get_n_pages()
        if other:
            for aa in range(cc):
                vcurr = notebook.get_nth_page(aa)
                if vcurr.area == other:
                    notebook.set_current_page(aa)
                    break
        nn = notebook.get_current_page()
        vcurr = notebook.get_nth_page(nn)

        # Disable close
        if vcurr.area.closedoc():
            self.update_statusbar(&#34;Did not close doc: &#39;%s&#39;&#34; %  vcurr.area.fname);
            return

        self.mywin.set_title(&#34;pyedpro: (closed doc)&#34;)

        # Wrap around if closed first
        if nn == 0: mm = cc - 1
        else:       mm = nn - 1

        notebook.set_current_page(mm)
        nn2 = notebook.get_current_page()
        vcurr2 = notebook.get_nth_page(nn2)
        self.mywin.set_focus(vcurr2.vbox.area)
        notebook.remove_page(nn)
        self.mywin.show_all()

    def  firstwin(self):
        cc = notebook.get_n_pages()
        if cc == 0:
            return
        notebook.set_current_page(0)
        nn2 = notebook.get_current_page()
        vcurr2 = notebook.get_nth_page(nn2)
        self.mywin.set_focus(vcurr2.vbox.area)
        self.mywin.show_all()

    def  lastwin(self):
        cc = notebook.get_n_pages()
        if cc == 0:
            return
        notebook.set_current_page(cc-1)
        nn2 = notebook.get_current_page()
        vcurr2 = notebook.get_nth_page(nn2)
        self.mywin.set_focus(vcurr2.vbox.area)
        self.mywin.show_all()

    def  nextwin(self):
        cc = notebook.get_n_pages()
        nn = notebook.get_current_page()
        vcurr = notebook.get_nth_page(nn)

        # Wrap around if needed
        if nn == cc - 1: mm = 0
        else:       mm = nn + 1
        notebook.set_current_page(mm)
        nn2 = notebook.get_current_page()
        vcurr2 = notebook.get_nth_page(nn2)
        self.mywin.set_focus(vcurr2.vbox.area)
        vcurr2.vbox.area.fire = 1
        #self.mywin.show_all()

    def  prevwin(self):
        cc = notebook.get_n_pages()
        nn = notebook.get_current_page()
        vcurr = notebook.get_nth_page(nn)

        # Wrap around if needed
        if nn == 0: mm = cc - 1
        else:       mm = nn - 1
        notebook.set_current_page(mm)
        nn2 = notebook.get_current_page()
        vcurr2 = notebook.get_nth_page(nn2)
        self.mywin.set_focus(vcurr2.vbox.area)
        #self.mywin.show_all()

    def folder_ch(self, win):
        #print &#34;folder_ch&#34;
        pass
        #return True

    def done_open_fc(self, win, resp):
        #print &#34;done_open_fc&#34;, win, resp
        if resp == Gtk.ButtonsType.OK:
            fname = win.get_filename()
            if not fname:
                #print &#34;Must have filename&#34;
                self.update_statusbar(&#34;No filename specified&#34;)
                pass
            elif os.path.isdir(fname):
                self.update_statusbar(&#34;Changed to %s&#34; % fname)
                os.chdir(fname)
                win.set_current_folder(fname)
                return
            else:
                self.openfile(fname)
        win.destroy()

    def saveall(self):
        #print &#34;saveall&#34;
        # Save all files
        nn = notebook.get_n_pages(); cnt = 0; cnt2 = 0
        while True:
            if cnt &gt;= nn: break
            ppp = notebook.get_nth_page(cnt)
            if ppp.area.changed:
                ppp.area.writeout()
                cnt2 += 1
            cnt += 1
        self.update_statusbar(&#34;%d of %d buffers saved.&#34; % (cnt2, nn))

    def start_term(self):
        #print(&#34;Terminal Here&#34;)
        exename = &#34;&#34;
        try:
            if platform.system().find(&#34;Win&#34;) &gt;= 0:
                ret = subprocess.Popen([&#34;putty&#34;])
                #if not ret.returncode:
                #    raise OSError
                #print(&#34;No terminal on windows. (TODO)&#34;)
            else:
                ret = None
                # The order represents the priority of opening
                termstr = (&#34;xfce4-terminal&#34;, &#34;gnome-terminal&#34;, &#34;lxterminal&#34;, &#34;xterm&#34;,)
                for exename in termstr:
                    # Stumble until terminal found
                    try:
                        ret = subprocess.Popen([exename],)
                        if not ret.returncode:
                            break
                    except:
                        pass

                if ret.returncode:
                    raise OSError
        except:
            print(&#34;Cannot launch terminal&#34;, sys.exc_info())
            pedync.message(&#34;\n   Cannot launch terminal executable \n\n&#34;
                       &#34;              (Please install)&#34;)
        finally:
            self.update_statusbar(&#34;Started terminal &#39;%s&#39;&#34; % exename)

    def status_hist(self, arg1, arg2):
        print(&#34;hist pressed&#34;)
        pass

    # -------------------------------------------------------------------

    def openfile(self, fnamex):

        # Empty line from sess load
        if not fnamex:
            #print(&#34;Empty file name passed&#34;)
            return

        # Any indication it is there?
        if not os.path.isfile(fnamex):
            print(&#34;Cannot open file:&#34;, &#34;&#39;&#34; + fnamex + &#34;&#39;&#34;)
            self.update_statusbar(&#34;Cannot open file &#39;{0:s}&#39;&#34;.format(fnamex))
            return

        # Is it already loaded? ... activate
        nn = notebook.get_n_pages()
        fname2 = os.path.realpath(fnamex)
        for aa in range(nn):
            vcurr = notebook.get_nth_page(aa)
            if vcurr.area.fname == fname2:
                if pedconfig.conf.verbose:
                    print(&#34;Already open &#39;&#34;+ fname2 + &#34;&#39;&#34;)
                self.update_statusbar(&#34;Already open, activating &#39;{0:s}&#39;&#34;.format(fname2))
                vcurr = notebook.set_current_page(aa)
                vcurr = notebook.get_nth_page(aa)
                self.mywin.set_focus(vcurr.vbox.area)
                return

        if pedconfig.conf.verbose:
            print(&#34;Opening &#39;&#34;+ fname2 + &#34;&#39;&#34;)

        self.update_statusbar(&#34;Opening file &#39;{0:s}&#39;&#34;.format(fname2), True)
        vpaned = edPane()
        ret = vpaned.area.loadfile(fname2)
        if not ret:
            self.update_statusbar(&#34;Cannot read file &#39;{0:s}&#39;&#34;.format(fname2))
            return
        vpaned.area2.loadfile(fname2)
        self.update_statusbar(&#34;Opened file &#39;{0:s}&#39;&#34;.format(fname2))

        #self.oh.add(fname2) # added at lower level now

        # Add to the list of buffers
        add_page(vpaned)
        vpaned.area.set_tablabel()
        self.mywin.show_all()
        # Make it current
        nn = notebook.get_n_pages()
        if nn:
            vcurr = notebook.set_current_page(nn-1)
            vcurr = notebook.get_nth_page(nn-1)
            self.mywin.set_focus(vcurr.vbox.area)

        usleep(10)
        return vcurr.vbox.area

    def activate_exit(self, action = None):
        #print &#34;activate_exit called&#34;
        OnExit(self.mywin, self)

    def activate_quit(self, action):
        #print &#34;activate_quit called&#34;
        OnExit(self.mywin, self, False)

    def activate_radio_action(self, action, current):
        active = current.get_active()
        value = current.get_current_value()

        if active:
            dialog = Gtk.MessageDialog(self, Gtk.DIALOG_DESTROY_WITH_PARENT,
                Gtk.MESSAGE_INFO, Gtk.ButtonsType.CLOSE,
                &#34;You activated radio action: \&#34;%s\&#34; of type \&#34;%s\&#34;.\nCurrent value: %d&#34; %
                (current.get_name(), type(current), value))

            # Close dialog on user response
            dialog.connect(&#34;response&#34;, lambda d, r: d.destroy())
            dialog.show()

    # This is the line count / pos status bar
    def update_statusbar2(self, xx = 0, yy = 0, ins=0, tlen=0, clip=0, caps=0, scr=0, colsel=0):
        # Always update line / col
        if ins: str2 = &#34;INS&#34;
        else: str2 =&#34;OVR&#34;

        # Always update CAPS
        if caps: str3 = &#34;CAP&#34;
        else: str3 =&#34;cap&#34;

        if scr: str4 = &#34;SCR&#34;
        else: str4 =&#34;scr&#34;

        if colsel: str5 = &#34;COL&#34;
        else: str5 =&#34;ROW&#34;

        strx2 = &#34;  Ln {0:d} Col {1:d} Tot {3:d}  {2:s} {5:s} {6:s} Clip: {4:d} {7:s}  &#34;.\
                                format(int(yy+1), int(xx+1), str2, tlen, clip, str3, str4, str5)

        #self.statusbar2.pop(0)
        #self.statusbar2.push(0, strx2)
        self.slab2.set_text(strx2)

    def status_lang(self, atg1, arf2):
        print(&#34;Lang pressed&#34;)

    def update_statusbar(self, strx, nolog = False):
        # Clear any previous message, underflow is allowed
        #self.statusbar.pop(0)
        if not strx:
            self.update_statusbar(&#34;Idle&#34;, True)
            return

        #self.statusbar.push(0, strx)
        self.statuscount = STATUSCOUNT
        self.slab.set_text(strx)
        if not nolog:
            pedlog.log(strx)

    def update_resize_grip(self, widget, event):
        #print &#34;update state&#34;, event, event.changed_mask
        #self.mywin.set_focus(notebook)

        mask = Gdk.WindowState.MAXIMIZED
        # | Gdk.FULLSCREEN

        &#39;&#39;&#39;if (event.changed_mask &amp; mask):
            self.statusbar.set_has_resize_grip(not (event.new_window_state &amp; mask))
        &#39;&#39;&#39;
# ------------------------------------------------------------------------

def     OnExit(arg, arg2 = False, prompt = True):

    global exiting

    #print(&#34;Exiting in OnExit&#34;, arg)

    # Nope, done here
    if exiting:
        return
    exiting = True

    arg.set_title(&#34;Exiting ...&#34;)
    #print(&#34;Exit called&#34;)
    #if arg2:
    #    arg2.stopthread = True

    # This way the header shows what is happening
    usleep(200)

    # Close log
    if pedconfig.conf.pedwin.klfp:
         pedconfig.conf.pedwin.klfp.close()

    try:
        pedconfig.conf.pedwin.oh.save()
    except:
        print(&#34;Cannot save file history.&#34;, sys.exc_info())

    try:
        pedconfig.conf.pedwin.os.save()
    except:
        print(&#34;Cannot save session history.&#34;, sys.exc_info())

    # Save UI related data
    pos = mained.hpaned.get_position()
    pos = max(pos, 1)

    #pedfind.load_find_history(True)

    pedconfig.conf.sql.put(&#34;hpaned&#34;, pos)

    vcurr = notebook.get_nth_page(notebook.get_current_page())
    if vcurr:
        pos = vcurr .get_position()
        pos = max(pos, 1)

        pedconfig.conf.sql.put(&#34;vpaned&#34;, pos)

    # Do not save full screen coordinates (when used F11)
    #print( mained.full)

    if 1: #not mained.full:
        xx, yy = mained.mywin.get_position()
        ww, hh = mained.mywin.get_size()

        if pedconfig.conf.verbose:
            print(&#34;Save coord&#34;, xx, yy, ww, hh)

        pedconfig.conf.sql.put(&#34;xx&#34;, xx)
        pedconfig.conf.sql.put(&#34;yy&#34;, yy)

        pedconfig.conf.sql.put(&#34;ww&#34;, ww)
        pedconfig.conf.sql.put(&#34;hh&#34;, hh)

    pedconfig.conf.sql.put(&#34;sess&#34;, mained.sess)

    # Save current doc to config memory:
    vcurr = notebook.get_nth_page(notebook.get_current_page())
    if vcurr:
        pedconfig.conf.sql.put(&#34;curr&#34;, vcurr.area.fname)

    # Prompt for save files. Build list and execute saves
    parr = []
    for aa in range(notebook.get_n_pages()):
        parr.append(notebook.get_nth_page(aa))

    cnt2 = 0
    for ppp in parr:
        #print (&#34;close:&#34;, ppp.area.fname)
        ppp.area.saveparms()
        ss = &#34;/sess_%d&#34; % cnt2
        if cnt2 &lt; 30:
            pedconfig.conf.sql.put(ss, ppp.area.fname)
            cnt2 += 1

        if ppp.area.changed:
            if prompt:
                # This way all the closing doc functions get called
                if ppp.area.closedoc():
                    exiting = False
                    return  True
            else:
                # Rescue to temporary:
                hhh = hash_name(ppp.area.fname) + &#34;.rescue&#34;
                xfile = pedconfig.conf.config_dir + os.sep + hhh
                if pedconfig.conf.verbose:
                    print(&#34;Rescuing&#34;, xfile)
                writefile(xfile, ppp.area.text, &#34;\n&#34;)

    # Prevent empty session from clearing old session
    if cnt2 != 0:
        pedconfig.conf.sql.put(&#34;cnt&#34;, cnt2)

    #if pedconfig.conf.verbose:
    #    print(&#34;Exiting&#34;)

    # Add to accounting:
    timesheet(&#34;Ended pyedpro&#34;, mained.start_time, time.time())

    #print( &#34;OnExit called \&#34;&#34; + arg.get_title() + &#34;\&#34;&#34;)

    # Force save note and web content
    for aa in range(notebook2.get_n_pages()):
        ppp = notebook2.get_nth_page(aa)
        #print(&#34;ppp&#34;, ppp)
        try:
            ppp.save()
        except:
            #print(&#34;sys&#34;, sys.exc_info() )
            pass

    # Exit here, destroy / stop
    arg.destroy()
    Gtk.main_quit()

def  initial_load(self2, arg):

    global notebook, hidden

    #self2 =  pedconfig.conf.pedwin

    try:
        if os.getuid() == 0:
            ret = pedync.yes_no_cancel(&#34;Root user detected&#34;, &#34;This program was not meant to run as root.\n&#34;
                                    &#34;\nPress Yes to run anyway, No to quit.&#34;, False)
            if ret == Gtk.ResponseType.NO:
                sys.exit()
    except:
        pass

    try:
        #print( &#39;Signal handler called with signal&#39;)
        #print( pedconfig.conf.idle, pedconfig.conf.syncidle)
        #print (&#34;exec init handler&#34;)

        # ----------------------------------------------------------------
        # Read in buffers

        seen = []

        cnt = 0
        for aa in self2.names:

            # Comline names are relative to original path, not the changed load
            #aaa = os.path.realpath(aa)
            #aaa = pedconfig.conf.orig_dir + os.sep + aa

            # Absolute path?
            if aa[0] == os.sep:
                aaa = aa
            else:
                aaa = pedconfig.conf.orig_path + os.sep + aa
            if aaa in seen:
                continue

            seen.append(aaa)
            if pedconfig.conf.verbose:
                print( &#34;loading file: &#34;, aaa)

            if not os.path.isfile(aaa):
                print( &#34;No such file on load: &#34;, aaa)
                continue

            vpaned = edPane()
            ret = vpaned.area.loadfile(aaa)
            if not ret:
                self2.update_statusbar(&#34;Cannot read file &#39;{0:s}&#39;, creating ...&#34;. format(aaa))
                ret = self2.newfile(aaa)
                if not ret:
                    self2.update_statusbar(&#34;Cannot create fle &#39;{0:s}&#39;&#34;. format(aaa))
                    continue

            ret = vpaned.area2.loadfile(aaa)

            cnt += 1
            add_page(vpaned)
            vpaned.area.set_tablabel()
            usleep(10)

        if cnt == 0:
            if pedconfig.conf.verbose:
                print(&#34;Loading session in&#34;, os.getcwd())
            fcnt = pedconfig.conf.sql.get_int(&#34;cnt&#34;)

            # Load old session
            for nnn in range(fcnt):
                ss = &#34;/sess_%d&#34; % nnn
                fff = pedconfig.conf.sql.get_str(ss)

                if pedconfig.conf.verbose &gt; 2:
                    print(&#34;Loading (initial) file:&#34;, fff)

                vpaned = edPane()
                ret = vpaned.area.loadfile(fff)
                if not ret:
                    self2.update_statusbar(&#34;Cannot read file &#39;{0:s}&#39;&#34;.format(fff))
                    continue
                vpaned.area2.loadfile(fff)

                add_page(vpaned)
                self2.mywin.show_all()
                vpaned.area.set_tablabel()
                nn = notebook.get_n_pages()
                if nn:
                    vcurr = notebook.set_current_page(nn-1)
                    usleep(10)
                    vcurr = notebook.get_nth_page(nn-1)
                    self2.mywin.set_focus(vcurr.vbox.area)
                    usleep(10)

                #vpaned.queue_draw();
                #notebook.queue_draw();
                self2.mywin.show_all()
                usleep(10)

        # Show newly created buffers:
        self2.mywin.show_all()

        # Set last file
        self2.lastfile = pedconfig.conf.sql.get_str(&#34;curr&#34;)
        #print( &#34;curr file&#34;, fff)
        cc = notebook.get_n_pages()
        for mm in range(cc):
            vcurr = notebook.get_nth_page(mm)
            if vcurr.area.fname == self2.lastfile:
                #print( &#34;found buff, initial show&#34;, self2.lastfile)
                notebook.set_current_page(mm)
                self2.mywin.set_focus(vcurr.vbox.area)
                break
    except:
        print(&#34;Exception in load handler&#34;, sys.exc_info())
        put_exception(&#34;Load handler&#34;)
        pass

exiting = False

# ------------------------------------------------------------------------

def handler_tick(arg, arg2):

    global savearr, notebook, exiting

    # No timer while exiting, but keep the timer going
    if exiting:
        return True

    #print( &#34;handler_tick&#34;, time.ctime())

    # Update lastfile&#39;s func list
    mw = pedconfig.conf.pedwin

    #try:
    #    print(&#34;mw&#34;, mw.mywin.get_focus())
    #except:
    #    pass

    if mw.lastfile:
        cc = notebook.get_n_pages()
        for mm in range(cc):
            vcurr = notebook.get_nth_page(mm)
            if vcurr.area.fname == mw.lastfile:
                #print( &#34;found buff, initial show&#34;, mw.lastfile)
                notebook.set_current_page(mm)
                mw.mywin.set_focus(vcurr.vbox.area)
                usleep(10)
                vcurr.vbox.area.doidle =  1
                break
        mw.lastfile = &#34;&#34;

    try:
        for bb in savearr:
            print(&#34;SAVE&#34;, bb)
        savearr = []
    except:
        print(&#34;Exception in save handler&#34;, sys.exc_info())

    try:
        #print( &#39;Signal handler called with signal&#39;)
        #print( pedconfig.conf.idle, pedconfig.conf.syncidle)
        global hidden

        if not hidden:
            hidden = True
            if os.name == &#34;nt&#34;:
                try:
                    #a = input(&#39;Input value here:&#39;)
                    kernel32 = ctypes.WinDLL(&#39;kernel32&#39;)
                    user32 = ctypes.WinDLL(&#39;user32&#39;)

                    if kernel32:
                        print(&#34;Hiding controlling terminal&#34;)
                        SW_HIDE = 0
                        hWnd = kernel32.GetConsoleWindow()
                        user32.ShowWindow(hWnd, SW_HIDE)
                except:
                    print(&#34;Exception in hide console&#34;, sys.exc_info())
                    pass

        if pedconfig.conf.idle:
            pedconfig.conf.idle -= 1
            if pedconfig.conf.idle == 0:
                vcurr = notebook.get_nth_page(notebook.get_current_page())
                # Rescue to save:
                if vcurr:
                    vcurr.area.doidle = 1
                    if not mw.mac:
                        vcurr.area.source_id = \
                            GLib.idle_add(peddoc.idle_callback, vcurr.area, 0)

        if pedconfig.conf.syncidle:
            pedconfig.conf.syncidle -= 1
            if pedconfig.conf.syncidle == 0:
                vcurr = notebook.get_nth_page(notebook.get_current_page())
                if vcurr:
                    if not mw.mac:
                        #pedspell.spell(vcurr.area)
                        #print(&#34;adding callback2&#34;)
                        vcurr.area.source_id2 = \
                            GLib.idle_add(peddoc.idle_callback2, vcurr.area, 0)

                    if len(vcurr.area2.text) == 0:
                        vcurr.area2.text = vcurr.area.text
                        vcurr.area2.fname = vcurr.area.fname
                        vcurr.area2.set_maxlines()
                        vcurr.area2.set_maxlinelen()

                    if vcurr.area.changed:
                        vcurr.area2.text = vcurr.area.text
                        vcurr.area2.set_maxlines(0)
                        vcurr.area2.invalidate()

        if pedconfig.conf.pedwin.statuscount:
            pedconfig.conf.pedwin.statuscount -= 1
            if pedconfig.conf.pedwin.statuscount == 0:
                pedconfig.conf.pedwin.update_statusbar(&#34;Idle.&#34;, True);
                pedconfig.conf.pedwin.statuscount = 0

    except:
        print(&#34;Exception in timer handler&#34;, sys.exc_info())

    # This GPFs in mac ... we return TRUE instead
    #GLib.timeout_add(1000, handler_tick, arg, arg2)
    #print( &#34;handler_tick done&#34;)
    return True

# EOF</code></pre>
</details>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-functions">Functions</h2>
<dl>
<dt id="pedwin.OnExit"><code class="name flex">
<span>def <span class="ident">OnExit</span></span>(<span>arg, arg2=False, prompt=True)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def     OnExit(arg, arg2 = False, prompt = True):

    global exiting

    #print(&#34;Exiting in OnExit&#34;, arg)

    # Nope, done here
    if exiting:
        return
    exiting = True

    arg.set_title(&#34;Exiting ...&#34;)
    #print(&#34;Exit called&#34;)
    #if arg2:
    #    arg2.stopthread = True

    # This way the header shows what is happening
    usleep(200)

    # Close log
    if pedconfig.conf.pedwin.klfp:
         pedconfig.conf.pedwin.klfp.close()

    try:
        pedconfig.conf.pedwin.oh.save()
    except:
        print(&#34;Cannot save file history.&#34;, sys.exc_info())

    try:
        pedconfig.conf.pedwin.os.save()
    except:
        print(&#34;Cannot save session history.&#34;, sys.exc_info())

    # Save UI related data
    pos = mained.hpaned.get_position()
    pos = max(pos, 1)

    #pedfind.load_find_history(True)

    pedconfig.conf.sql.put(&#34;hpaned&#34;, pos)

    vcurr = notebook.get_nth_page(notebook.get_current_page())
    if vcurr:
        pos = vcurr .get_position()
        pos = max(pos, 1)

        pedconfig.conf.sql.put(&#34;vpaned&#34;, pos)

    # Do not save full screen coordinates (when used F11)
    #print( mained.full)

    if 1: #not mained.full:
        xx, yy = mained.mywin.get_position()
        ww, hh = mained.mywin.get_size()

        if pedconfig.conf.verbose:
            print(&#34;Save coord&#34;, xx, yy, ww, hh)

        pedconfig.conf.sql.put(&#34;xx&#34;, xx)
        pedconfig.conf.sql.put(&#34;yy&#34;, yy)

        pedconfig.conf.sql.put(&#34;ww&#34;, ww)
        pedconfig.conf.sql.put(&#34;hh&#34;, hh)

    pedconfig.conf.sql.put(&#34;sess&#34;, mained.sess)

    # Save current doc to config memory:
    vcurr = notebook.get_nth_page(notebook.get_current_page())
    if vcurr:
        pedconfig.conf.sql.put(&#34;curr&#34;, vcurr.area.fname)

    # Prompt for save files. Build list and execute saves
    parr = []
    for aa in range(notebook.get_n_pages()):
        parr.append(notebook.get_nth_page(aa))

    cnt2 = 0
    for ppp in parr:
        #print (&#34;close:&#34;, ppp.area.fname)
        ppp.area.saveparms()
        ss = &#34;/sess_%d&#34; % cnt2
        if cnt2 &lt; 30:
            pedconfig.conf.sql.put(ss, ppp.area.fname)
            cnt2 += 1

        if ppp.area.changed:
            if prompt:
                # This way all the closing doc functions get called
                if ppp.area.closedoc():
                    exiting = False
                    return  True
            else:
                # Rescue to temporary:
                hhh = hash_name(ppp.area.fname) + &#34;.rescue&#34;
                xfile = pedconfig.conf.config_dir + os.sep + hhh
                if pedconfig.conf.verbose:
                    print(&#34;Rescuing&#34;, xfile)
                writefile(xfile, ppp.area.text, &#34;\n&#34;)

    # Prevent empty session from clearing old session
    if cnt2 != 0:
        pedconfig.conf.sql.put(&#34;cnt&#34;, cnt2)

    #if pedconfig.conf.verbose:
    #    print(&#34;Exiting&#34;)

    # Add to accounting:
    timesheet(&#34;Ended pyedpro&#34;, mained.start_time, time.time())

    #print( &#34;OnExit called \&#34;&#34; + arg.get_title() + &#34;\&#34;&#34;)

    # Force save note and web content
    for aa in range(notebook2.get_n_pages()):
        ppp = notebook2.get_nth_page(aa)
        #print(&#34;ppp&#34;, ppp)
        try:
            ppp.save()
        except:
            #print(&#34;sys&#34;, sys.exc_info() )
            pass

    # Exit here, destroy / stop
    arg.destroy()
    Gtk.main_quit()</code></pre>
</details>
</dd>
<dt id="pedwin.add_page"><code class="name flex">
<span>def <span class="ident">add_page</span></span>(<span>page)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def add_page(page):
    global notebook
    notebook.append_page(page)
    notebook.set_tab_detachable(page, True)</code></pre>
</details>
</dd>
<dt id="pedwin.handler_tick"><code class="name flex">
<span>def <span class="ident">handler_tick</span></span>(<span>arg, arg2)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def handler_tick(arg, arg2):

    global savearr, notebook, exiting

    # No timer while exiting, but keep the timer going
    if exiting:
        return True

    #print( &#34;handler_tick&#34;, time.ctime())

    # Update lastfile&#39;s func list
    mw = pedconfig.conf.pedwin

    #try:
    #    print(&#34;mw&#34;, mw.mywin.get_focus())
    #except:
    #    pass

    if mw.lastfile:
        cc = notebook.get_n_pages()
        for mm in range(cc):
            vcurr = notebook.get_nth_page(mm)
            if vcurr.area.fname == mw.lastfile:
                #print( &#34;found buff, initial show&#34;, mw.lastfile)
                notebook.set_current_page(mm)
                mw.mywin.set_focus(vcurr.vbox.area)
                usleep(10)
                vcurr.vbox.area.doidle =  1
                break
        mw.lastfile = &#34;&#34;

    try:
        for bb in savearr:
            print(&#34;SAVE&#34;, bb)
        savearr = []
    except:
        print(&#34;Exception in save handler&#34;, sys.exc_info())

    try:
        #print( &#39;Signal handler called with signal&#39;)
        #print( pedconfig.conf.idle, pedconfig.conf.syncidle)
        global hidden

        if not hidden:
            hidden = True
            if os.name == &#34;nt&#34;:
                try:
                    #a = input(&#39;Input value here:&#39;)
                    kernel32 = ctypes.WinDLL(&#39;kernel32&#39;)
                    user32 = ctypes.WinDLL(&#39;user32&#39;)

                    if kernel32:
                        print(&#34;Hiding controlling terminal&#34;)
                        SW_HIDE = 0
                        hWnd = kernel32.GetConsoleWindow()
                        user32.ShowWindow(hWnd, SW_HIDE)
                except:
                    print(&#34;Exception in hide console&#34;, sys.exc_info())
                    pass

        if pedconfig.conf.idle:
            pedconfig.conf.idle -= 1
            if pedconfig.conf.idle == 0:
                vcurr = notebook.get_nth_page(notebook.get_current_page())
                # Rescue to save:
                if vcurr:
                    vcurr.area.doidle = 1
                    if not mw.mac:
                        vcurr.area.source_id = \
                            GLib.idle_add(peddoc.idle_callback, vcurr.area, 0)

        if pedconfig.conf.syncidle:
            pedconfig.conf.syncidle -= 1
            if pedconfig.conf.syncidle == 0:
                vcurr = notebook.get_nth_page(notebook.get_current_page())
                if vcurr:
                    if not mw.mac:
                        #pedspell.spell(vcurr.area)
                        #print(&#34;adding callback2&#34;)
                        vcurr.area.source_id2 = \
                            GLib.idle_add(peddoc.idle_callback2, vcurr.area, 0)

                    if len(vcurr.area2.text) == 0:
                        vcurr.area2.text = vcurr.area.text
                        vcurr.area2.fname = vcurr.area.fname
                        vcurr.area2.set_maxlines()
                        vcurr.area2.set_maxlinelen()

                    if vcurr.area.changed:
                        vcurr.area2.text = vcurr.area.text
                        vcurr.area2.set_maxlines(0)
                        vcurr.area2.invalidate()

        if pedconfig.conf.pedwin.statuscount:
            pedconfig.conf.pedwin.statuscount -= 1
            if pedconfig.conf.pedwin.statuscount == 0:
                pedconfig.conf.pedwin.update_statusbar(&#34;Idle.&#34;, True);
                pedconfig.conf.pedwin.statuscount = 0

    except:
        print(&#34;Exception in timer handler&#34;, sys.exc_info())

    # This GPFs in mac ... we return TRUE instead
    #GLib.timeout_add(1000, handler_tick, arg, arg2)
    #print( &#34;handler_tick done&#34;)
    return True</code></pre>
</details>
</dd>
<dt id="pedwin.initial_load"><code class="name flex">
<span>def <span class="ident">initial_load</span></span>(<span>self2, arg)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def  initial_load(self2, arg):

    global notebook, hidden

    #self2 =  pedconfig.conf.pedwin

    try:
        if os.getuid() == 0:
            ret = pedync.yes_no_cancel(&#34;Root user detected&#34;, &#34;This program was not meant to run as root.\n&#34;
                                    &#34;\nPress Yes to run anyway, No to quit.&#34;, False)
            if ret == Gtk.ResponseType.NO:
                sys.exit()
    except:
        pass

    try:
        #print( &#39;Signal handler called with signal&#39;)
        #print( pedconfig.conf.idle, pedconfig.conf.syncidle)
        #print (&#34;exec init handler&#34;)

        # ----------------------------------------------------------------
        # Read in buffers

        seen = []

        cnt = 0
        for aa in self2.names:

            # Comline names are relative to original path, not the changed load
            #aaa = os.path.realpath(aa)
            #aaa = pedconfig.conf.orig_dir + os.sep + aa

            # Absolute path?
            if aa[0] == os.sep:
                aaa = aa
            else:
                aaa = pedconfig.conf.orig_path + os.sep + aa
            if aaa in seen:
                continue

            seen.append(aaa)
            if pedconfig.conf.verbose:
                print( &#34;loading file: &#34;, aaa)

            if not os.path.isfile(aaa):
                print( &#34;No such file on load: &#34;, aaa)
                continue

            vpaned = edPane()
            ret = vpaned.area.loadfile(aaa)
            if not ret:
                self2.update_statusbar(&#34;Cannot read file &#39;{0:s}&#39;, creating ...&#34;. format(aaa))
                ret = self2.newfile(aaa)
                if not ret:
                    self2.update_statusbar(&#34;Cannot create fle &#39;{0:s}&#39;&#34;. format(aaa))
                    continue

            ret = vpaned.area2.loadfile(aaa)

            cnt += 1
            add_page(vpaned)
            vpaned.area.set_tablabel()
            usleep(10)

        if cnt == 0:
            if pedconfig.conf.verbose:
                print(&#34;Loading session in&#34;, os.getcwd())
            fcnt = pedconfig.conf.sql.get_int(&#34;cnt&#34;)

            # Load old session
            for nnn in range(fcnt):
                ss = &#34;/sess_%d&#34; % nnn
                fff = pedconfig.conf.sql.get_str(ss)

                if pedconfig.conf.verbose &gt; 2:
                    print(&#34;Loading (initial) file:&#34;, fff)

                vpaned = edPane()
                ret = vpaned.area.loadfile(fff)
                if not ret:
                    self2.update_statusbar(&#34;Cannot read file &#39;{0:s}&#39;&#34;.format(fff))
                    continue
                vpaned.area2.loadfile(fff)

                add_page(vpaned)
                self2.mywin.show_all()
                vpaned.area.set_tablabel()
                nn = notebook.get_n_pages()
                if nn:
                    vcurr = notebook.set_current_page(nn-1)
                    usleep(10)
                    vcurr = notebook.get_nth_page(nn-1)
                    self2.mywin.set_focus(vcurr.vbox.area)
                    usleep(10)

                #vpaned.queue_draw();
                #notebook.queue_draw();
                self2.mywin.show_all()
                usleep(10)

        # Show newly created buffers:
        self2.mywin.show_all()

        # Set last file
        self2.lastfile = pedconfig.conf.sql.get_str(&#34;curr&#34;)
        #print( &#34;curr file&#34;, fff)
        cc = notebook.get_n_pages()
        for mm in range(cc):
            vcurr = notebook.get_nth_page(mm)
            if vcurr.area.fname == self2.lastfile:
                #print( &#34;found buff, initial show&#34;, self2.lastfile)
                notebook.set_current_page(mm)
                self2.mywin.set_focus(vcurr.vbox.area)
                break
    except:
        print(&#34;Exception in load handler&#34;, sys.exc_info())
        put_exception(&#34;Load handler&#34;)
        pass</code></pre>
</details>
</dd>
</dl>
</section>
<section>
<h2 class="section-title" id="header-classes">Classes</h2>
<dl>
<dt id="pedwin.EdMainWindow"><code class="flex name class">
<span>class <span class="ident">EdMainWindow</span></span>
<span>(</span><span>fname, parent, names, orgdir)</span>
</code></dt>
<dd>
<div class="desc"><p>Define Application Main Window claass</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class EdMainWindow():

    &#39;&#39;&#39;  Define Application Main Window claass &#39;&#39;&#39;

    def __init__(self, fname, parent, names, orgdir):

        #Gdk.threads_init()
        self.togstrip = True

        pedconfig.conf.pedwin = self

        if &#34;Darwin&#34; in platform.system():
            self.mac = True
        else:
            self.mac  = False

        self.orgdir = orgdir
        self.colorbar = 0
        self.headcolor = 0
        self.rescnt = 0
        self.full = False
        self.fcount = 0
        self.statuscount = 0
        self.alt = False
        self.altkey = False
        self.names = names
        self.show_menu = True
        self.show_tbar = True
        #self.alttime = 0
        self.old_x = 0
        self.old_y = 0
        self.lastfile = &#34;&#34;
        self.oh = itemhistory(pedconfig.conf.history)
        self.os = itemhistory(pedconfig.conf.sessions)
        self.sess = &#34;initial.sess&#34;

        if pedconfig.conf.keylog_on:
            self.klfp = open(pedconfig.conf.keylog_file, &#34;at&#34;)
        else:
            self.klfp = None

        register_stock_icons()

        #Gdk.threads_init()

        global mained
        mained = self

        disp2 = Gdk.Display()
        disp = disp2.get_default()
        #print( disp)
        scr = disp.get_default_screen()
        ptr = disp.get_pointer()
        mon = scr.get_monitor_at_point(ptr[1], ptr[2])
        geo = scr.get_monitor_geometry(mon)
        www = geo.width; hhh = geo.height
        xxx = geo.x;     yyy = geo.y

        # Resort to old means of getting screen w / h
        if www == 0 or hhh == 0:
            www = Gdk.screen_width(); hhh = Gdk.screen_height()

        if pedconfig.conf.pgdebug &gt; 3:
            print(&#34;www&#34;, www, &#34;hhh&#34;, hhh)

        # Create the toplevel window
        #window = Gtk.Window(Gtk.WINDOW_TOPLEVEL)
        self.mywin = Gtk.Window()
        #www = Gdk.screen_width(); hhh = Gdk.screen_height();

        if pedconfig.conf.full_screen:
            if pedconfig.conf.verbose:
                print(&#34;Setting full screen&#34;)

            self.mywin.set_default_size(www, hhh)
        else:
            xx = pedconfig.conf.sql.get_int(&#34;xx&#34;)
            yy = pedconfig.conf.sql.get_int(&#34;yy&#34;)
            ww = pedconfig.conf.sql.get_int(&#34;ww&#34;)
            hh = pedconfig.conf.sql.get_int(&#34;hh&#34;)

            if pedconfig.conf.pgdebug &gt; 2:
                print(&#34;load coords&#34;, xx, yy, ww, hh)

            if ww == 0 or hh == 0:
                self.mywin.set_position(Gtk.WindowPosition.CENTER)
                if www / hhh &gt; 2:
                    www = hhh
                self.mywin.set_default_size(7*www/8, 5*hhh/8)
                #self.mywin.move(www / 32, hhh / 10)
            else:
                self.mywin.set_default_size(ww, hh)
                self.mywin.move(xx, yy)

            #self.mywin.set_default_size(7*www/8, 7*hhh/8)
            #self.mywin.set_position(Gtk.WindowPosition.CENTER)
            #self.mywin.move(xxx + www / 16, yyy / hhh / 16)

        try:
            self.mywin.set_icon_from_file(get_img_path(&#34;pyedpro.png&#34;))
        except:
            try:
                self.mywin.set_icon_from_file(&#34;images/pyedpro.png&#34;)
            except:
                print(&#34;Canot load main icon.&#34;)

        self.merge = Gtk.UIManager()
        #self.merge.connect(&#34;pre-activate&#34;, self.menu_open)
        #self.merge.connect(&#34;add_widget&#34;, self.menu_open)
        #self.mywin.set_data(&#34;ui-manager&#34;, self.merge)

        self.acg = create_action_group(self)
        self.merge.insert_action_group(self.acg, 0)
        self.accel = self.merge.get_accel_group()

        ##accel.disconnect_key(Gdk.KEY_o, Gdk.ModifierType.CONTROL_MASK)
        #accel.disconnect_key(Gdk.KEY_a, Gdk.ModifierType.META_MASK)
        #accel.disconnect_key(Gdk.KEY_o, Gdk.ModifierType.CONTROL_MASK |
        #                                        Gdk.ModifierType.SHIFT_MASK)

        self.mywin.add_accel_group(self.accel)

        try:
            mergeid = self.merge.add_ui_from_string(ui_info)
        except GLib.GError as msg:
            print(&#34;Building menus failed: %s&#34; % msg)

        merge_id = self.merge.new_merge_id()
        self.add_mru(self.merge, merge_id, self.acg)

        # Keybinder
        #actions = self.acg.list_actions()
        #for aa in actions:
        #    print(aa.get_name(), )

        self.mbar = self.merge.get_widget(&#34;/MenuBar&#34;)
        self.mbar.show()

        self.mywin.set_events(Gdk.EventMask.ALL_EVENTS_MASK )

        global notebook, notebook2, notebook3

        # Create note for the main window, give access to it for all
        notebook = Gtk.Notebook.new(); self.notebook = notebook
        #notebook.size_allocate(Gdk.Rectangle(0, 0, 10,10))

        #notebook.popup_enable()
        notebook.set_scrollable(True)
        # test
        #notebook.append_page(edPane([]))
        #notebook.drag_dest_set(0, [], 0)
        #notebook.drag_dest_set(Gtk.DestDefaults.HIGHLIGHT | Gtk.DestDefaults.DROP
        #                 | Gtk.DestDefaults.MOTION,
        #                 [Gtk.TargetEntry.new(&#39;GTK_NOTEBOOK_TAB&#39;,
        #                                      Gtk.TargetFlags.SAME_APP, 0)],
        #                                         Gdk.DragAction.MOVE)

        notebook.set_group_name(&#39;0&#39;)

        #notebook.drag_source_set(Gdk.ModifierType.BUTTON1_MASK, [], Gdk.DragAction.MOVE)

        #notebook.connect_after(&#39;drag-begin&#39;, self.on_drag_begin)
        #notebook.connect_after(&#39;drag-motion&#39;, self.on_drag_motion)
        #notebook.connect_after(&#39;drag-drop&#39;, self.on_drag_drop)
        #notebook.connect_after(&#34;drag-data-received&#34;, self.on_drag_data_received)

        # This is the right notebook
        notebook3 = Gtk.Notebook.new(); self.notebook3 = notebook3
        #notebook3.size_allocate(Gdk.Rectangle(0, 0, 10,10))

        notebook3.set_scrollable(True)
        self.diffpane = edPane()
        self.diffpane.area.readonly = True
        self.diffpane.area.diffpane = True
        self.diffpane.area.nomenu = True

        notebook3.append_page(self.diffpane)
        ppp = self.notebook3.get_nth_page(self.notebook.get_n_pages()-1)
        self.notebook3.set_tab_label(ppp, self.make_label(&#34; Diff &#34;))

        # This is the left notebook
        notebook2 = Gtk.Notebook.new(); self.notebook2 = notebook2
        #notebook2.size_allocate(Gdk.Rectangle(0, 0, 100,100))

        #notebook2.popup_enable()
        notebook2.set_scrollable(True)
        notebook2.connect(&#34;switch-page&#34;, self.note_swpage_cb2)
        notebook2.connect(&#34;move_focus_out&#34;, self.focus_out2)
        #notebook2.override_background_color(
        #            Gtk.StateFlags.NORMAL, Gdk.RGBA(.85, .8, .8) )

        #notebook.add_events(Gdk.FOCUS_CHANGE_MASK)
        #notebook.add_events(Gdk.ALL_EVENTS_MASK)

        notebook.connect(&#34;switch-page&#34;, self.note_swpage_cb)
        notebook.connect(&#34;focus-in-event&#34;, self.note_focus_in)
        notebook.connect(&#34;drag-data-received&#34;, self.on_drag_data_received)

        # Futile attempts
        #notebook.connect(&#34;change-current-page&#34;, self.note_page_cb)
        #notebook.connect(&#34;grab-focus&#34;, self.note_grab_focus_cb)
        #notebook.connect(&#34;focus&#34;, self.note_focus_cb)
        #notebook.connect(&#34;create-window&#34;, self.note_create_cb)
        #notebook.connect(&#34;enter-notify-event&#34;, self.note_enter_notify)

        notebook.connect(&#34;button-press-event&#34;, self.note_button)
        self.mywin.connect(&#34;window_state_event&#34;, self.update_resize_grip)
        self.mywin.connect(&#34;delete-event&#34;, OnExit)
        #self.mywin.connect(&#34;unmap&#34;, OnExit, self)

        self.mywin.connect(&#34;key-press-event&#34;, self.area_key)
        self.mywin.connect(&#34;key-release-event&#34;, self.area_key)

        #self.mywin.connect(&#34;set-focus&#34;, self.area_focus)
        self.mywin.connect(&#34;focus-in-event&#34;, self.area_focus_in)
        self.mywin.connect(&#34;focus-out-event&#34;, self.area_focus_out)
        self.mywin.connect(&#34;window-state-event&#34;, self.area_winstate)
        self.mywin.connect(&#34;size_allocate&#34;, self.area_size)
        self.mywin.connect(&#34;configure-event&#34;, self.config_event)

        #self.mywin.connect(&#34;area-focus-event&#34;, self.area_focus_in)
        #self.mywin.connect(&#34;event&#34;, self.area_event)
        #self.mywin.connect(&#34;enter-notify-event&#34;, self.area_enter)
        #self.mywin.connect(&#34;leave-notify-event&#34;, self.area_leave)
        #self.mywin.connect(&#34;event&#34;, self.unmap)

        self.tbar = self.merge.get_widget(&#34;/ToolBar&#34;)
        #self.tbar.set_tooltips(True)
        self.tbar.set_icon_size(Gtk.IconSize.LARGE_TOOLBAR)
        self.tbar.show()

        self.hpaned = Gtk.HPaned(); self.hpaned.set_border_width(2)

        #warnings.simplefilter(&#34;ignore&#34;)
        scroll = Gtk.ScrolledWindow()
        #warnings.simplefilter(&#34;default&#34;)

        global treeview
        treeview = self.create_tree()
        treeview.set_activate_on_single_click (True)
        treeview.connect(&#34;row-activated&#34;,  self.tree_sel)
        #treeview.connect(&#34;cursor-changed&#34;,  self.tree_sel_row)
        self.treeview = treeview
        #treeview.modify_bg(Gtk.StateType.NORMAL, Gdk.color_parse(&#34;#888888&#34;))

        global treeview2
        treeview2 = self.create_vartree()
        treeview2.set_activate_on_single_click (True)
        treeview2.connect(&#34;row-activated&#34;,  self.tree_sel2)
        #treeview2.connect(&#34;cursor-changed&#34;,  self.tree_sel_row2)
        self.treeview2 = treeview2

        vpaned = Gtk.VPaned() #vpaned.set_border_width(2)

        scroll.add(treeview)
        frame2 = Gtk.Frame(); frame2.add(scroll)
        vpaned.add(frame2)

        scroll2 = Gtk.ScrolledWindow()
        scroll2.add(treeview2)
        frame3 = Gtk.Frame(); frame3.add(scroll2)
        vpaned.set_focus_chain((frame2,))
        vpaned.add(frame3)

        vpaned.set_position(self.get_height() - 340)
        #vpaned.set_position(10)
        #self.hpaned.add(vpaned)

        try:
            notebook2.append_page(vpaned)
            ppp = self.notebook2.get_nth_page(self.notebook2.get_n_pages()-1)
            self.notebook2.set_tab_label(ppp, self.make_label(&#34;Funcs&#34;))
        except:
            print(&#34;Cannot load auxiliary func tab.&#34;)
            if pedconfig.conf.verbose:
                print(sys.exc_info())
                pedutil.put_exception(&#34;func tab&#34;)

        try:
            #pw = Gtk.Label(&#34;hello&#34;)
            pw = pedai.pgAI()
            notebook2.append_page(pw)
            ppp = self.notebook2.get_nth_page(self.notebook2.get_n_pages()-1)
            self.notebook2.set_tab_label(ppp, self.make_label(&#34;_AI&#34;))
            pass
        except:
            print(&#34;Cannot load auxiliary AI tab.&#34;)
            if pedconfig.conf.verbose:
                print(sys.exc_info())
                if pedconfig.conf.verbose:
                    put_exception(&#34;load AI tab&#34;)

        try:
            notebook2.append_page(pedcal.pgcal())
            ppp = self.notebook2.get_nth_page(self.notebook2.get_n_pages()-1)
            self.notebook2.set_tab_label(ppp, self.make_label(&#34;Cal&#34;))
            pass
        except:
            print(&#34;Cannot load auxiliary cal tab.&#34;)
            if pedconfig.conf.verbose:
                print(sys.exc_info())
                pedutil.put_exception(&#34;cal tab&#34;)

        try:
            notebook2.append_page(pednotes.pgnotes())
            ppp = self.notebook2.get_nth_page(self.notebook2.get_n_pages()-1)
            self.notebook2.set_tab_label(ppp, self.make_label(&#34;Notes&#34;))
            pass
        except:
            print(&#34;Cannot load auxiliary notes tab&#34;)
            print(sys.exc_info())
            if pedconfig.conf.verbose:
                put_exception(&#34;Notes&#34;)

            if pedconfig.conf.pgdebug &gt; 2:
                put_exception(&#34;Notes&#34;)

        try:
            notebook2.append_page(pedoline.pgoline())
            ppp = self.notebook2.get_nth_page(self.notebook2.get_n_pages()-1)
            self.notebook2.set_tab_label(ppp, self.make_label(&#34;Draw&#34;))
            pass
        except:
            print(&#34;Cannot load outline tab.&#34;)
            if pedconfig.conf.verbose:
                print(sys.exc_info())
                pedutil.put_exception(&#34;outline&#34;)

        try:
            pw = pedweb.pgweb()
            notebook2.append_page(pw)
            ppp = self.notebook2.get_nth_page(self.notebook2.get_n_pages()-1)
            self.notebook2.set_tab_label(ppp, self.make_label(&#34;Web&#34;))
            pass
        except:
            print(&#34;Cannot load auxiliary web tab.&#34;)
            if pedconfig.conf.verbose:
                print(sys.exc_info())
                if pedconfig.conf.verbose:
                    put_exception(&#34;load web tab&#34;)

        self.hpanepos = pedconfig.conf.sql.get_int(&#34;hpaned&#34;)
        if self.hpanepos == 0: self.hpanepos = 200
        self.hpaned.set_position(self.hpanepos)

        self.hpaned.add(notebook2)
        #self.hpaned.pack2(Gtk.Label(&#34;hello &#34;))
        self.hpaned.pack2(notebook)
        #notebook.modify_bg(Gtk.StateType.NORMAL, Gdk.color_parse(&#34;#888888&#34;))

        self.hpaned3 = Gtk.HPaned(); self.hpaned3.set_border_width(2)
        self.hpaned3.set_position(20)

        self.hpaned3.add(self.hpaned)
        self.hpaned3.pack2(notebook3)
        self.hpaned3.set_position(self.get_width() - 10)

        # Create statusbars (obsolete)
        #self.statusbar = Gtk.Statusbar()
        #self.statusbar2 = Gtk.Statusbar()
        #self.statusbar2.set_spacing(0)

        # Replaced it with simple labels
        slabs = Gtk.Label(&#34;   &#34;)
        self.slab = Gtk.Label(&#34; status  &#34;)
        self.slab.set_xalign(Gtk.Align.START)
        self.slab.set_yalign(Gtk.Align.START)

        #self.slab.override_background_color(
        #            Gtk.StateFlags.NORMAL, Gdk.RGBA(1, .5, .5) )

        shbox = Gtk.HBox()
        shbox.pack_start(slabs, 0, 0, 0)
        shbox.pack_start(self.slab, 0, 0, 0)

        shbox.pack_end(Gtk.Label(&#34; | &#34;), 0, 0, 0)
        eb = smallbutt(&#34; Hist &#34;, self.status_hist, &#34;Look at event history&#34;)
        shbox.pack_end(eb, 0, 0, 0)
        shbox.pack_end(Gtk.Label(&#34; | &#34;), 0, 0, 0)

        shbox.pack_end(Gtk.Label(&#34; | &#34;), 0, 0, 0)
        eb2 = smallbutt(&#34; Lang &#34;, self.status_lang, &#34;Change language&#34;)
        shbox.pack_end(eb2, 0, 0, 0)
        shbox.pack_end(Gtk.Label(&#34; | &#34;), 0, 0, 0)

        #shbox.override_background_color(
        #            Gtk.StateFlags.NORMAL, Gdk.RGBA(1, .5, 1) )

        self.slab2 = Gtk.Label(&#34; status2  &#34;)

        #self.hpaned2 = Gtk.HPaned(); self.hpaned2.set_border_width(5)
        #self.hpaned2.set_position(20)
        #self.hpaned2.pack1(shbox, 0, 0)
        #self.hpaned2.pack2(self.slab2, 0, 0)

        self.hbox3 = Gtk.HBox()
        self.hbox3.pack_start(shbox, 1, 1, 2)
        self.hbox3.pack_start(self.slab2, 0, 0, 2)

        bbox = Gtk.VBox()
        nbox = Gtk.HBox()
        obox = Gtk.VBox()

        obox.pack_start(self.mbar, 0, 0, 0)
        obox.pack_start(self.tbar, 0, 0, 0)
        nbox.pack_start(obox, 0, 0, 0)

        obox3 = Gtk.HBox()
        obox2 = Gtk.VBox()
        self.newbox = Gtk.HBox()
        self.newbox2 = Gtk.HBox()

        # This many buttons on screen
        self.num_butts =  www // (1280 // 6)
        self.buttarr = []               # So later we can change labels
        self.newbox.pack_start(Gtk.Label(&#34; &#34;), 0, 0, 0)
        for aa in range(self.num_butts):
            #butt = Gtk.Button(&#34;FuncA %d &#34; % (aa + 1))
            head = pedconfig.conf.sql.get(&#34;mac%d%d&#34; % (1, aa))
            if not head:
                head =  &#34;B_A%d&#34; % (aa + 1)
            butt = RCLButt(head, self.rcl, self.rcl2, space=0, ttip = &#34;Action Button %d&#34; % (aa+1))
            butt.ord = 1; butt.id = aa ;
            self.buttarr.append(butt)
            #butt.connect(&#34;pressed&#34;, self.buttA, aa + 1)
            self.newbox.pack_start(butt, 1, 1, 0)
        self.newbox.pack_start(Gtk.Label(&#34; &#34;), 0, 0, 0)
        combox = Gtk.VBox()
        combox.pack_start(self.newbox, 1, 1, 1)
        newscroll = Gtk.ScrolledWindow()
        newscroll.set_overlay_scrolling(False)
        newscroll.set_policy(Gtk.PolicyType.NEVER, Gtk.PolicyType.NEVER)
        newscroll.add_with_viewport(combox)
        obox2.pack_start(newscroll, 1, 1, 0)

        self.newbox2.pack_start(Gtk.Label(&#34; &#34;), 0, 0, 0)
        for aa in range(self.num_butts):
            #butt = Gtk.Button(&#34;FuncB %d &#34; % (aa + 1))
            head = pedconfig.conf.sql.get(&#34;mac%d%d&#34; % (2, aa))
            if not head:
                head =  &#34;B_B%d&#34; % (aa + 1)
            butt = RCLButt(head, self.rcl, self.rcl2, space=0, ttip = &#34;Lower Action Button %d&#34; % (aa+1))
            butt.ord = 2; butt.id = aa;
            self.buttarr.append(butt)
            #butt.connect(&#34;pressed&#34;, self.buttB, aa + 1)
            self.newbox2.pack_start(butt, 1, 1, 0)
        self.newbox2.pack_start(Gtk.Label(&#34; &#34;), 0, 0, 0)
        combox.pack_start(self.newbox2, 1, 1, 1)

        leftb = Gtk.Button(&#34;&lt;&#34;)
        rightb = Gtk.Button(&#34;&gt;&#34;)
        #obox3.pack_start(leftb, 0,0,0)

        oscroll = Gtk.ScrolledWindow()
        adj =  Gtk.Adjustment()
        oscroll.set_hadjustment(adj)
        oscroll.get_hscrollbar().hide()
        oscroll.add(obox2)
        obox3.pack_start(oscroll, 1, 1, 0)
        #obox3.pack_start(obox2, 1,1,0)

        #obox3.pack_start(rightb, 0,0,0)
        nbox.pack_start(obox3, 1, 1, 0)
        bbox.pack_start(nbox, 0, 0, 0)
        bbox.pack_start(self.hpaned3, 1, 1, 0)

        # Buttom statubar
        #bbox.pack_start(self.hpaned2, 0, 0, 0)
        bbox.pack_start(self.hbox3, 0, 0, 0)

        #self.hpaned2.modify_bg(Gtk.StateType.NORMAL, Gdk.color_parse(&#34;#888888&#34;))

        self.headbar = Gtk.HeaderBar()
        self.headbar.set_decoration_layout(&#34;icon,menu:minimize,maximize,close&#34;)
        self.headbar.set_show_close_button(True)

        #print(&#34;self.headcolor&#34;, self.headcolor)

        button = Gtk.Button()
        button.connect(&#34;pressed&#34;, self.doall)
        button.set_tooltip_text(&#34;Will execute ./cycle.sh in current directory&#34;)

        icon = Gio.ThemedIcon(name=&#34;mail-send-receive-symbolic&#34;)
        image = Gtk.Image.new_from_gicon(icon, Gtk.IconSize.BUTTON)
        button.add(image)

        self.headbar.pack_end(button)

        self.menu = MenuButt((&#34;Open&#34;, &#34;Close&#34;, &#34;Exit&#34;), self.menu_click)
        self.headbar.pack_start(Gtk.Label())
        self.headbar.pack_start(self.menu)
        self.headbar.pack_start(Gtk.Label())

        box = Gtk.Box(orientation=Gtk.Orientation.HORIZONTAL)
        Gtk.StyleContext.add_class(box.get_style_context(), &#34;linked&#34;)

        button = Gtk.Button()
        button.add(Gtk.Arrow(Gtk.ArrowType.DOWN, Gtk.ShadowType.NONE))
        button.set_tooltip_text(&#34;Show / Hide Toolbar&#34;)
        box.add(button)
        box.add(Gtk.Label(&#34; &#34;))
        button.connect(&#34;pressed&#34;, self.ttt)

        button = Gtk.Button()
        button.add(Gtk.Arrow(Gtk.ArrowType.DOWN, Gtk.ShadowType.NONE))
        button.connect(&#34;pressed&#34;, self.mmm)
        button.set_tooltip_text(&#34;Show / Hide menu&#34;)
        box.add(button)
        box.add(Gtk.Label(&#34;   &#34;))

        button = Gtk.Button()
        button.add(Gtk.Arrow(Gtk.ArrowType.LEFT, Gtk.ShadowType.NONE))
        button.connect(&#34;pressed&#34;, self.bleft)
        box.add(button)
        box.add(Gtk.Label(&#34; &#34;))

        button = Gtk.Button()
        button.add(Gtk.Arrow(Gtk.ArrowType.RIGHT, Gtk.ShadowType.NONE))
        button.connect(&#34;pressed&#34;, self.bright)
        box.add(button)

        # See if session is remembred
        oldsess = pedconfig.conf.sql.get(&#34;sess&#34;)
        if oldsess:
            self.sess = oldsess

        self.headbar.pack_start(box)
        self.sess_label =  Gtk.Label(self.sess)
        self.headbar.pack_start(self.sess_label)

        self.mywin.set_titlebar(self.headbar)

        # Set the signal handler for 1s tick
        #signal.signal(signal.SIGALRM, handler_tick)
        #signal.alarm(1)
        # Show newly created buffers:
        #self.mywin.show_all()

        pedfind.load_find_history(False)
        self.update_statusbar(&#34;Initial&#34;, True)

        # Add to accounting:
        self.start_time = time.time()
        timesheet(&#34;Started pyedpro&#34;, self.start_time, 0)

        self.mywin.add(bbox)
        self.mywin.show_all()

        if 1: #not self.mac:
            GLib.timeout_add(1000, handler_tick, self, 0)
            pass

        if not self.mac:
            GLib.timeout_add(100, initial_load, self, 0)
            #initial_load(self, 0)
            pass
        else:
            initial_load(self, 0)

        #print(&#34;initial key state&#34;, Gtk.get_current_event_state())

        # Tried it ... NO
        #GObject.signal_new(&#34;my-custom-signal&#34;, self.mywin, GObject.SIGNAL_RUN_LAST, GObject.TYPE_PYOBJECT,
        #               (GObject.TYPE_PYOBJECT,))
        #self.mywin.connect(&#34;my-custom-signal&#34;, self.threadevent)
        #threading.Thread(target=self.ThredMine, daemon=True).start()
        #GLib.timeout_add(1000, self.ThredCallback)

    #Gtk.Action

    def activate_webtab(self):
        ppp = self.notebook2.get_nth_page(self.notebook2.get_n_pages()-1)
        if ppp:
            # This assumes the webtab is the last one
            self.notebook2.set_current_page(self.notebook2.get_n_pages()-1)
            pp = self.notebook2.get_current_page()
            self.notebook2.get_nth_page(pp).treeview2.grab_focus()

    def activate_notetab(self):
        ppp = self.notebook2.get_nth_page(self.notebook2.get_n_pages()-3)
        if ppp:
            # This assumes the notetab is the one before the last one
            self.notebook2.set_current_page(self.notebook2.get_n_pages()-3)
            pp = self.notebook2.get_current_page()
            self.notebook2.get_nth_page(pp).treeview2.grab_focus()

    def activate_caltab(self):
        ppp = self.notebook2.get_nth_page(self.notebook2.get_n_pages()-4)
        if ppp:
            # This assumes the notetab is the one before the last one
            self.notebook2.set_current_page(self.notebook2.get_n_pages()-4)


    def openmenu(self, strx):

        # Thu 27.Oct.2022 Deactivated TODO
        return

        #for bb in self.accel:
        #for aa in self.acg.list_actions():
        #    #print(&#34;action&#34;, aa.get_name())
        #    sss = aa.get_name().split(&#34; &#34;)
        #    #print(&#34;action&#34;, sss)
        #    if strx in sss[0]:
        #        ttt = &#34;/ui/&#34; + sss[0]
        #        # Gtk.Action
        #        print(&#34;file action:&#34;, aa, aa.get_name(), aa.get_accel_path(), ttt)
        #        #print(aa, dir(aa))
        #        #print(self.acg, dir(self.acg))
        #        #aa.set_sensitive(True)
        #        aa.set_sensitive(True)
        #        aa.set_visible(True)
        #        aa.activate()
        #        break

        # MenuItem
        mb = self.mbar.get_children()
        for aa in mb:
            #print(&#34;menu&#34;, aa, aa.get_label())
            if strx in aa.get_label():
                # Gtk.ImageMenuItem
                print(&#34;opening menu&#34;, aa, aa.get_label(), aa.get_accel_path())
                #print(self.acg, dir(self.acg))
                aa.select()
                #aa.activate()
                #aa.grab_focus()
                #aa.show_all()
                #print(&#34;has&#34;, self.acg.has_action(aa.get_accel_path()))
                #self.acg.activate_action(aa.get_accel_path())
                break
        pass

    def note_button(self, arg1, arg2):
        #print(&#34;note_button&#34;, arg1, arg2)
        pass

    def ThredMine(self):
        cnt = 0
        while(1):
            event = threading.Event()
            result = []
            Gdk.threads_enter()
            #GLib.idle_add(self.ThredCallback, event, cnt)
            event.wait()
            Gdk.threads_leave()
            cnt += 1
            #usleep(1000)
            time.sleep(1)

    def ThredCallback(self): #, event, cnt):

        #Gdk.threads_enter()
        #if pedconfig.conf.verbose:
        #    print(&#34;Callback from thread&#34;, self.rescnt)
        self.rescnt += 1

        #self.mywin.emit(&#34;my-custom-signal&#34;, event)
        #event.set()
        #event = threading.Event()
        #result = []
        #Gdk.threads_leave()
        return True

    def threadevent(self, win, event):
        pass
        #if pedconfig.conf.verbose:
        #    print(&#34;Thread Event&#34;, win, event)

    def rcl(self, butt, arg1, arg2):
        #print(&#34;rcl label&#34;, but.get_label(), butt.ord, butt.id)
        head = pedconfig.conf.sql.get(&#34;mac%d%d&#34; % (butt.ord, butt.id))
        value = pedconfig.conf.sql.get(&#34;val%d%d&#34; % (butt.ord, butt.id))
        if not value:
            self.update_statusbar(&#34;No data on button action &#39;%d.%d&#39;&#34; % (butt.ord, butt.id))
            return
        nn2 = notebook.get_current_page()
        vcurr2 = notebook.get_nth_page(nn2)
        if not vcurr2:
            self.update_statusbar(&#34;Cannot paste from button action &#39;%s&#39;&#34; % head)
            return

        # Patch in variables
        dt = datetime.datetime(1990, 1, 1);
        dt2 = dt.now()
        strx2 =  dt2.strftime(&#34;%a %d.%b.%Y&#34;)
        value = value.replace(&#34;%DATE%&#34;, strx2)

        strx3 =  dt2.strftime(&#34;%H:%M:%S&#34;)
        value = value.replace(&#34;%TIME%&#34;, strx3)
        value = value.replace(&#34;%FILE%&#34;, os.path.basename(vcurr2.area.fname))

        value = value.replace(&#34;%PROJECT%&#34;, self.sess)

        disp = Gdk.Display().get_default()
        clip = Gtk.Clipboard.get_default(disp)
        clip.set_text(value, len(value))
        pedconfig.conf.keyh.acth.ctrl_v(vcurr2.area)
        self.mywin.set_focus(vcurr2.vbox.area)
        self.update_statusbar(&#34;Pasted from button action &#39;%s&#39;&#34; % head)

    def rcl2(self, butt, arg1, arg2):
        #print(&#34;rcl2 label&#34;, &#34;&#39;&#34; + arg1.get_label() + &#34;&#39;&#34;, arg1.ord, arg1.id)
        menu = MenuButt((&#34;Action&#34;, &#34;Configure&#34;, &#34;Face&#34;), self.submenu_click)
        menu.area_rbutton(arg1, arg2)
        menu.ord = arg1.ord; menu.id = arg1.id

    def submenu_click(self, menu, arg1, arg2):
        #print(&#34;submenu_click&#34;, menu.ord, menu.id, arg1, arg2)
        #pedconfig.conf.sql.put(&#34;xx&#34;, xx)
        if arg2 == 0:
            # Call the action -- note menu contains button coordinates
            self.rcl(menu, arg1, arg2)

        if arg2 == 1:
            #print(&#34;submenu_click config&#34;, menu.ord, menu.id, arg1, arg2)
            head = pedconfig.conf.sql.get(&#34;mac%d%d&#34; % (menu.ord, menu.id))
            if not head:
                abarr = &#34;AAB&#34;
                head = &#34;Func %s%d&#34; % (abarr[menu.ord], menu.id)
            clip = pedconfig.conf.sql.get(&#34;val%d%d&#34; % (menu.ord, menu.id))
            if not clip:
                clip = &#34;None&#34;

            filled = peddlg.config_dlg(&#34;Edit Macro Entry&#34;, head, clip)
            if filled[0]:
                pedconfig.conf.sql.put(&#34;mac%d%d&#34; % (menu.ord, menu.id), filled[0])
                pedconfig.conf.sql.put(&#34;val%d%d&#34; % (menu.ord, menu.id), filled[1])
                # Also fill in header
                for aa in self.buttarr:
                    if aa.ord == menu.ord and aa.id == menu.id:
                        aa.set_label(filled[0])

    def buttA(self, arg1, arg2):
        #print(&#34;buttA&#34;, arg1, arg2)
        self.update_statusbar(&#34;ButtA pressed, num {0:d}&#34;.format(arg2), False)

    def buttB(self, arg1, arg2):
        #print(&#34;buttB&#34;, arg1, arg2)
        self.update_statusbar(&#34;ButtB pressed, num {0:d}&#34;.format(arg2), False)

    def menu_open(self, arg, arg2):
        #print(&#34;menu_open&#34;, arg, arg2)
        #self.update_statusbar(&#34;Menu open num {0:d}&#34;.format(arg2))
        pass

    def focus_out2(self, book, obj):
        #print(&#34;nb2 focus out&#34;, obj)
        pass

    def ttt(self, butt):
        self.show_tbar = not self.show_tbar
        if self.show_tbar:
            self.tbar.show()
        else:
            self.tbar.hide()

    def mmm(self, butt):
        self.show_menu = not self.show_menu
        if self.show_menu:
            self.mbar.show()
        else:
            self.mbar.hide()

    def doall(self, butt):
        #pedync.message(&#34;\n&#34; + &#34;Under construction&#34; + &#34;\n&#34;)
        ccc =  &#34;cycle.sh&#34;
        self.update_statusbar(&#34;Executing &#34; + ccc)
        comline2 = [&#34;bash&#34;, ccc, ]
        if not os.path.isfile(ccc):
            print(&#34;Cannot execute %s&#34; % str(comline2), &#34;no such file&#34;)
            self.update_statusbar(&#34;Cannot execute: &#39;&#34; + ccc + &#34;&#39; no such file&#34; )
            return
        try:
            ret = subprocess.Popen(comline2, stderr=subprocess.PIPE, stdout=subprocess.PIPE)
        except:
            print(&#34;Cannot execute %s&#34; % str(comline2), sys.exc_info())
            self.update_statusbar(&#34;Cannot execute: &#34; + ccc + &#34; &#34; + str(sys.exc_info()[1]) )
        try:
            outs, errs = ret.communicate()
        except:
            print(&#34;Cannot communicate with %s&#34; % str(comline), sys.exc_info())
            return
        print(outs, errs)

    def bleft(self, butt):
        #print(butt)
        self.prevwin()

    def bright(self, butt):
        #print(butt)
        self.nextwin()

    def menu_click(self, item, arg1, arg2):
        #print(&#34;menu_click&#34;, item, arg1, arg2)
        if &#34;pen&#34; in arg1:
            self.open()
        if &#34;lose&#34; in arg1:
            self.close_document()
        if &#34;xit&#34; in arg1:
            self.activate_exit()

    def on_drag_begin(self, widget, context):
        global drag_page_number
        drag_page_number = widget.get_current_page()
        print(&#39;drag-begin:&#39;, drag_page_number, widget)

    def on_drag_motion(self, widgt, context, c, y, time):
        #Gdk.drag_status(context, Gdk.DragAction.COPY, time)
        print (&#34;motion&#34;)
        #return True

    def on_drag_drop(self, widget, context, x, y, time):
        #widget.drag_get_data(context, context.list_targets()[-1], time)
        pass
        print (&#34;Dropping&#34;)

    def on_drag_data_received(self, widget, drag_context, x, y, data, info, time):

        print(&#34;Received drop: %s&#34; % data)

        if info == TARGET_ENTRY_TEXT:
            text = data.get_text()
            print(&#34;Received text: %s&#34; % text)

        elif info == TARGET_ENTRY_PIXBUF:
            pixbuf = data.get_pixbuf()
            width = pixbuf.get_width()
            height = pixbuf.get_height()

            print(&#34;Received pixbuf with width %spx and height %spx&#34; % (width, height))

    # --------------------------------------------------------------------

    def label_callb(self, lab, widg, context):
        #print(&#34;label_callb&#34;, context)
        pass

    def make_label(self, strx):
        hbox = Gtk.HBox()
        labx  = Gtk.Label.new_with_mnemonic(strx)
        labx.set_mnemonic_widget(hbox)
        eb = Gtk.EventBox(); eb.add(labx)
        eb.connect_after(&#34;button-press-event&#34;, self.label_callb, strx)
        eb.set_above_child(True)

        hbox.pack_start(eb, 0, 0, 0)
        hbox.show_all()
        return hbox

    def open_recent(self, action):
        if pedconfig.conf.pgdebug &gt; 0:
            print(&#34;open recent&#34;, action)

        #warnings.simplefilter(&#34;ignore&#34;)
        strx = action.get_name()
        #print(strx)
        #warnings.simplefilter(&#34;default&#34;)
        self.openfile(strx);

    def open_recent_sess(self, action):
        if pedconfig.conf.pgdebug &gt; 0:
            print(&#34;open recent sess&#34;, action)
        #warnings.simplefilter(&#34;ignore&#34;)
        strx = action.get_name()
        #print(strx)
        #warnings.simplefilter(&#34;default&#34;)
        self.opensess(strx);

    def opensess(self, strx):
        #print(&#34;opensess&#34;, strx)

        pedlog.log(&#34;Opening session&#34;, strx, time.ctime(None))
        pedconfig.conf.pedwin.sess = os.path.basename(strx)
        self.sess_label.set_text(pedconfig.conf.pedwin.sess)

        sesslist = []
        fh = open(strx, &#34;rb&#34;)
        try:
            sesslist = pickle.load(fh)
        except:
            print(&#34;Cannot load sess list&#34;, sys.exc_info())
            fh.close()
            return
        fh.close()
        for fff in str.split(sesslist, &#34;\n&#34;):
            #print (&#34;Session opening file:&#34;, &#34;&#39;&#34; + fff + &#34;&#39;&#34;)
            pedconfig.conf.pedwin.openfile(fff)
            usleep(10)

    # --------------------------------------------------------------------
    # Add MRU

    def add_mru(self, mergex, merge_id, action_group):

        for aa in self.oh.histarr:
            if aa[2]:
                #print(&#34;.oh&#34;, aa)
                fname = aa[2]
                ac = Gtk.Action(fname, fname, fname, None)
                ac.connect(&#39;activate&#39;, self.open_recent)
                action_group.add_action(ac)
                mergex.add_ui(merge_id, &#34;/MenuBar/FileMenu/Recent/Recent Files/&#34;,
                    fname, fname, Gtk.UIManagerItemType.MENUITEM, False)

        for aa in self.os.histarr:
            if aa[2]:
                #print(&#34;.os&#34;, aa)
                fname = aa[2]
                ac = Gtk.Action(fname, fname, fname, None)
                ac.connect(&#39;activate&#39;, self.open_recent_sess)
                action_group.add_action(ac)
                mergex.add_ui(merge_id, &#34;/MenuBar/FileMenu/Sessions/Recent Sessions/&#34;,
                    fname, fname, Gtk.UIManagerItemType.MENUITEM, False)

    def area_winstate(self, arg1, arg2):
        pass
        #print( &#34;area_winstate&#34;, arg1, arg2)
        #print( &#34;state&#34;, self.mywin.get_state())

    def config_event(self, win, event):
        pass
        #print( &#34;config_event&#34;, event.x, event.y, &#34;old events&#34;, self.old_x, self.old_y)
        self.old_x = event.x
        self.old_y = event.y

    def unmap(self, arg1, arg2):
        #print( &#34;unmap&#34;, arg1, arg2)
        pass

    def tree_sel_row(self, xtree):
        #print(&#34;tree_sel_row&#34;, xtree)
        pass
        #sel = xtree.get_selection()
        #xmodel, xiter = sel.get_selected()
        #if xiter:
        #    xstr = xmodel.get_value(xiter, 0)
        #    vcurr = notebook.get_nth_page(notebook.get_current_page())
        #    vcurr.area.locate(xstr)

    def tree_sel_row2(self, xtree):
        pass
        #sel = xtree.get_selection()
        #xmodel, xiter = sel.get_selected()
        #print(&#34;tree_sel_row2&#34;, xtree, xmodel, xiter)
        #if xiter:
        #    xstr = xmodel.get_value(xiter, 0)
        #    vcurr = notebook.get_nth_page(notebook.get_current_page())
        #    vcurr.area.locate(xstr)

    def tree_sel(self, xtree, xiter, xpath):
        #print(&#34;tree_sel&#34;, xtree, xiter, xpath)
        # Focus on main doc
        sel = xtree.get_selection()
        xmodel, xiter = sel.get_selected()
        if xiter:
            xstr = xmodel.get_value(xiter, 0)
            vcurr = notebook.get_nth_page(notebook.get_current_page())
            vcurr.area.locate(xstr)
            # Focus on main doc
            vcurr = notebook.get_nth_page(notebook.get_current_page())
            self.mywin.set_focus(vcurr.vbox.area)

    def tree_sel2(self, xtree, xiter, xpath):
        #print(&#34;tree_sel2&#34;, xtree, xiter, xpath)
        # Focus on main doc
        sel = xtree.get_selection()
        xmodel, xiter = sel.get_selected()
        if xiter:
            xstr = xmodel.get_value(xiter, 0)
            vcurr = notebook.get_nth_page(notebook.get_current_page())
            vcurr.area.locate(xstr)
            # Focus on main doc
            vcurr = notebook.get_nth_page(notebook.get_current_page())
            self.mywin.set_focus(vcurr.vbox.area)

    # --------------------------------------------------------------------

    def area_key(self, area, event):

        &#39;&#39;&#39; Call the document&#39;s key handler after some inspection &#39;&#39;&#39;

        if pedconfig.conf.pgdebug &gt; 4:
            print(&#34;pedwin key&#34;, event.keyval, event.state)

        if pedconfig.conf.keylog_on:
            if self.klfp:
                if event.type == Gdk.EventType.KEY_PRESS:
                    dt2 = datetime.datetime(1990, 1, 1).now()
                    strx2 =  dt2.strftime(&#34;%d.%b.%Y %H:%M&#34;)
                    fname = &#34;Empty&#34;
                    vcurr = notebook.get_nth_page(notebook.get_current_page())
                    if vcurr:
                        fname = os.path.basename(vcurr.vbox.area.fname)
                    print(strx2, fname,
                                event.keyval, &#34;&#39;&#34; + event.string
                                        + &#34;&#39;&#34;, int(event.state), file=self.klfp)

        if event.keyval ==  Gdk.KEY_F11:
            if event.type == Gdk.EventType.KEY_PRESS:
                if self.full:
                    self.mywin.unfullscreen()
                    self.full = False
                else:
                    self.mywin.fullscreen()
                    self.full = True
                return True

        #if event.keyval ==  Gdk.KEY_Alt_L:
        #    if event.type == Gdk.EventType.KEY_RELEASE:
        #        self.altkey = True
        #        #if time.time() - self.alttime &gt; 2:
        #        #    self.show_menu = not self.show_menu
        #        #print(&#34;self.alttime&#34;, time.time() - self.alttime)
        #        self.alttime = 0
        #    else:
        #        #print(&#34;pedwin ALT key down&#34;, event.keyval)
        #        self.altkey = False
        #        if self.alttime == 0:
        #            self.alttime = time.time()

        #if self.show_menu:       x
        #    self.mbar.show()
        #else:
        #    self.mbar.hide()

        # Inspect key press before treeview gets it
        if self.mywin.get_focus() == self.treeview:
            print(&#34;Key for treeview&#34;, event.state)
            # Do key down:
            if  event.type == Gdk.EventType.KEY_PRESS:
                if event.keyval == Gdk.KEY_Alt_L or \
                        event.keyval == Gdk.KEY_Alt_R:
                    self.alt = True

            if event.keyval == Gdk.KEY_Tab:
                print (&#34;pedwin TREE TAB&#34;, event.keyval)

            if event.keyval &gt;= Gdk.KEY_1 and event.keyval &lt;= Gdk.KEY_9:
                print (&#34;pedwin Alt num&#34;, event.keyval - Gdk.KEY_1)
                # Focus on main doc
                vcurr = notebook.get_nth_page(notebook.get_current_page())
                self.mywin.set_focus(vcurr.vbox.area)

            elif  event.type == Gdk.EventType.KEY_RELEASE:
                if event.keyval == Gdk.KEY_Alt_L or \
                      event.keyval == Gdk.KEY_Alt_R:
                    self.alt = False

        # Sad sad; do system shortcuts
        if event.type == Gdk.EventType.KEY_PRESS:
            # alt
            if event.state &amp; Gdk.ModifierType.MOD1_MASK:
                #print(&#34;alt&#34;, event.keyval)

                if event.keyval &gt;= Gdk.KEY_0 and event.keyval &lt;= Gdk.KEY_9:
                    if event.keyval == Gdk.KEY_0:
                        self.notebook.grab_focus()
                        old = self.notebook.get_current_page()
                        print(&#34;Set current&#34;, old)
                        self.notebook.set_current_page(old)
                    else:
                        num = event.keyval - Gdk.KEY_1
                        self.notebook.grab_focus()
                        if pedconfig.conf.pgdebug &gt; 5:
                            print( &#34;PedWin Keyhand Alt num&#34;, num)
                        if num &gt;  self.notebook.get_n_pages() - 1:
                            self.update_statusbar(&#34;Invalid tab (page) index.&#34;)
                        else:
                            old = self.notebook.get_current_page()
                            if old == num:
                                self.update_statusbar(&#34;Already at page %d ...&#34; % old)
                            else:
                                self.notebook.set_current_page(num)
                    return True

                # These are the menu accel keys; pass it to the system
                #  -- really dislike the accel system; takes over too many things
                # Cannot drive it programmatically -- maybe some help needed
                if event.keyval == ord(&#39;f&#39;) or event.keyval == ord(&#39;e&#39;) \
                    or event.keyval == ord(&#39;m&#39;) or \
                        event.keyval == ord(&#39;h&#39;):
                    return False

                if event.keyval == ord(&#39;o&#39;) or event.keyval == ord(&#39;O&#39;):
                    #print(&#34;mainwin alt-o&#34;)
                    self.altopen()
                    return True

            # ctrl-shift
            elif event.state &amp; Gdk.ModifierType.CONTROL_MASK and \
                    event.state &amp; Gdk.ModifierType.SHIFT_MASK:
                #print(&#34;control shift&#34;, event.keyval)
                if event.keyval == ord(&#39;S&#39;):
                    #print(&#34;save as&#34;, event.keyval)
                    self.save(True)
                    return True

                if event.keyval == ord(&#39;O&#39;):
                    #print(&#34;load session&#34;, event.keyval)
                    load_sess()
                    return True
            # ctrl
            elif event.state &amp; Gdk.ModifierType.CONTROL_MASK:
                if event.keyval == ord(&#39;o&#39;):
                    #print(&#34;open&#34;, keyval)
                    self.open()
                    return True
                if event.keyval == ord(&#39;s&#39;):
                    #print(&#34;save&#34;, event.keyval)
                    self.save()
                    return True
                if event.keyval == ord(&#39;n&#39;):
                    self.newfile()
                    return True

        # This was needed ad ALT-a and ALT-b ....
        # .... mysteriousely stopped working
        vcurr = notebook.get_nth_page(notebook.get_current_page())
        if vcurr:
            # See which window has focus
            got = self.mywin.get_focus()
            if vcurr.vbox.area == got:
                vcurr.vbox.area.area_key(area, event)
                return True
            elif vcurr.vbox2.area == got:
                vcurr.vbox2.area.area_key(area, event)
                return True
            elif self.diffpane.area == got:
                self.diffpane.area.area_key(area, event)
                return True
            else:
                return None
        else:
            pass
            #print(&#34;did not send key&#34;)  # this is normal
            return None

        return True             # Handled it
        #return None

    # Simplified alt open

    def altopen(self):
        pare = None
        vcurr = notebook.get_nth_page(notebook.get_current_page())
        if vcurr:
            pare = vcurr.vbox.area
        #print(&#34;pare&#34;, pare)
        fnames = pedofd.ofd(&#34;&#34;, pare)
        #print(&#34;openfile fnames&#34;, fnames)
        for fff in fnames:
            #print(&#34;Opening&#34;&#34;, fff)
            self.openfile(fff)
            pass

    def get_height(self):
        xx, yy = self.mywin.get_size()
        return yy

    def get_width(self):
        xx, yy = self.mywin.get_size()
        return xx

    def start_tree(self):

        global treestore
        if not treestore:
            treestore = Gtk.TreeStore(str)

    def start_tree2(self):

        global treestore2
        if not treestore2:
            treestore2 = Gtk.TreeStore(str)

        # Delete previous contents
        try:
            while True:
                root = treestore.get_iter_first()
                if not root:
                    break
                try:
                    treestore.remove(root)
                except:
                    print(&#34;Exception on rm treestore&#34;)
        except:
            print(&#34;strt_tree&#34;, sys.exc_info())
            pass

        piter = treestore.append(None, [&#34;Extracting ..&#34;])
        treestore.append(piter, [&#34;None ..&#34;])

    # --------------------------------------------------------------------
    def create_tree(self, text = None):

        global treestore
        self.start_tree()

        # create the TreeView using treestore
        tv = Gtk.TreeView(model=treestore)

        # create a CellRendererText to render the data
        cell = Gtk.CellRendererText()

        # create the TreeViewColumn to display the data
        tvcolumn = Gtk.TreeViewColumn(&#39;Functions&#39;)

        # add the cell to the tvcolumn and allow it to expand
        tvcolumn.pack_start(cell, True)

        # set the cell &#34;text&#34; attribute to column 0 - retrieve text
        # from that column in treestore
        tvcolumn.add_attribute(cell, &#39;text&#39;, 0)

        # add tvcolumn to treeview
        tv.append_column(tvcolumn)

        return tv

    # --------------------------------------------------------------------
    def create_vartree(self, text = None):

        global treestore2
        self.start_tree2()

        # create the TreeView using treestore
        tv = Gtk.TreeView(model=treestore2)

        # create a CellRendererText to render the data
        cell = Gtk.CellRendererText()

        # create the TreeViewColumn to display the data
        tvcolumn = Gtk.TreeViewColumn(&#39;Local Scope&#39;)

        # add the cell to the tvcolumn and allow it to expand
        tvcolumn.pack_start(cell, True)

        # set the cell &#34;text&#34; attribute to column 0 - retrieve text
        # from that column in treestore
        tvcolumn.add_attribute(cell, &#39;text&#39;, 0)

        # add tvcolumn to treeview
        tv.append_column(tvcolumn)

        return tv

    def xupdate_treestore(self, text):
        pass

    # --------------------------------------------------------------------
    def update_treestore(self, text):

        global treestore, treeview
        if not treestore: return

        # Remember old position
        #Gtk.TreeViewColumn Gtk.TreeView Gtk.TreeStore
        old_sel = None
        try:
            path = treeview.get_path_at_pos(0, 0)
            #print(&#34;path&#34;, path)
            xiter = treestore.get_iter(path[0])
            #print(&#34;xiter&#34;, xiter)
            if xiter:
                old_sel = treestore.get_value(xiter, 0)

        except:
            #print(&#34;update_tree old pos&#34;, sys.exc_info())
            pass

        # Delete previous contents
        try:
            while True:
                root = treestore.get_iter_first()
                if not root:
                    break
                try:
                    treestore.remove(root)
                except:
                    print(&#34;except: treestore remove&#34;)
        except:
            print(&#34;update_tree&#34;, sys.exc_info())
            pass

        if not text:
            return
        try:
            for line in text:
                piter = treestore.append(None, [cut_lead_space(line)])
            # Back to old line
            treeview.scroll_to_cell(path[0], None, False, 0, 0)
        except:
            #print(&#34;Exception in append treestore&#34;, sys.exc_info())
            pass

    # --------------------------------------------------------------------
    def update_treestore2(self, text):

        global treestore2

        if not treestore2: return
        # Delete previous contents
        try:
            while True:
                root = treestore2.get_iter_first()
                if not root:
                    break
                try:
                    treestore2.remove(root)
                except:
                    print(&#34;except: treestore remove&#34;)
        except:
            print(&#34;update_tree2&#34;, sys.exc_info())

        if not text:
            return

        try:
            for line in text:
                piter = treestore2.append(None, [cut_lead_space(line)])
        except:
            pass
            #print(&#34;Exception in append treestore2&#34;, sys.exc_info())

    # --------------------------------------------------------------------
    # Handlers: (deactivated)

    def area_event(self, win, act):
        pass
        #print(  &#34;pedwin area event&#34;, win, act)

    def area_leave(self, win, act):
        pass
        print(  &#34;pedwin area leave&#34;, win, act)

    def area_enter(self, win, act):
        pass
        #print(  &#34;pedwin area enter&#34;, win, act)

    def area_focus(self, win, act):
        pass
        #print(  &#34;pedwin area focus&#34;, win, act)

    def area_focus_in(self, win, act):
        #print(  &#34;area focus in&#34;, win, act)
        # This was needed as pygtk leaves the alt key hanging
        pedconfig.conf.keyh.reset()
        # Focus on main doc
        vcurr = notebook.get_nth_page(notebook.get_current_page())
        if vcurr:
            self.mywin.set_focus(vcurr.vbox.area)

        vcurr2 = notebook2.get_nth_page(notebook2.get_current_page())
        cc = notebook2.get_n_pages()
        for mm in range(cc):
            curr = notebook2.get_nth_page(mm)
            try:
                if curr == vcurr2:
                    #print(&#34;sending page focus signal to &#34;, curr)
                    curr.focus_in()
                    pass
            except:
                pass
        pass

    def area_focus_out(self, win, act):
        #print  (&#34;area focus out&#34;, win, act)
        global savearr
        cc = notebook.get_n_pages()
        for mm in range(cc):
            curr = notebook.get_nth_page(mm)
            #print(&#34;saving tab &#34;, curr)
            try:
                #savearr.append(curr.area.fname)
                #print(&#34;Adding&#34;, curr.area.fname)
                #curr.vbox.area.save()
                #curr.vbox.focus_out()
                pass
            except:
                #print(sys.exc_info())
                pass
        pass

    def area_size(self, win, rect):
        #print(  &#34;area size&#34;, rect)
        #self.hpaned2.set_position(self.get_width() - 280)
        pass

    def  note_focus_in(self, win, act):
        pass
        #print( &#34;note_focus_in&#34;, win, act)
        vcurr = notebook.get_nth_page(notebook.get_current_page())
        if vcurr:
            self.mywin.set_focus(vcurr.vbox.area)
            vcurr.vbox.area.doidle = 1

    def note_enter_notify(self, win):
        pass
        #print( &#34;note_enter_notify&#34;, win)

    def  note_grab_focus_cb(self, win):
        #print( &#34;note_grab_focus_cb&#34;, win)
        vcurr = notebook.get_nth_page(notebook.get_current_page())
        if vcurr:
            self.mywin.set_focus(vcurr.vbox.area)

    def  note_swpage_cb2(self, tabx, page, num):
        #print (&#34;note_swpage2&#34;, num)
        cc = notebook2.get_n_pages()
        for mm in range(cc):
            curr = notebook2.get_nth_page(mm)
            #print(&#34;sending page change signal to &#34;, curr)
            try:
                curr.switched(page)
            except:
                pass

    def  note_swpage_cb(self, tabx, page, num):
        #print( &#34;note_swpage&#34;, num)
        vcurr = tabx.get_nth_page(num)
        self.mywin.set_title(&#34;pyedpro: &#34; + vcurr.area.fname)
        self.mywin.set_focus(vcurr.vbox.area)
        hhh = hash_name(vcurr.area.fname)
        fname = os.path.basename(vcurr.area.fname)
        backx = vcurr.area.currback
        self.update_statusbar(&#34;Switched to &#39;{1:s}&#39;   {2:s}_{3:d} &#34;
                                    .format(num, fname, hhh, backx ), True)

    def  note_page_cb(self, tabx, child, num):
        pass
        #print( &#34;note_page&#34;)

    def note_focus_cb(self, tabx, foc):
        #print( &#34;note_focus_cb&#34;)
        vcurr = notebook.get_nth_page(notebook.get_current_page())
        if vcurr:
            self.mywin.set_focus(vcurr.vbox.area)

    def note_create_cb(self, tabx, page, xx, yy):
        pass
        #print( &#34;note_create&#34;)

    # Devhelp Message handler
    def activate_dhelp(self, action):
        self.update_statusbar(&#34;Showing DevHelp&#34;)
        nn2 = notebook.get_current_page()
        vcurr2 = notebook.get_nth_page(nn2)
        if vcurr2:
            pedconfig.conf.keyh.acth.f2(vcurr2.area)

    # Devhelp Message handler
    def activate_khelp(self, action):
        self.update_statusbar(&#34;Showing Keyboard Help&#34;)
        nn2 = notebook.get_current_page()
        vcurr2 = notebook.get_nth_page(nn2)
        if vcurr2:
            vcurr2.area.shift = True
            pedconfig.conf.keyh.acth.f2(vcurr2.area)
            vcurr2.area.shift = False

    def activate_qhelp(self, action):
        self.update_statusbar(&#34;Showing quick help&#34;)
        rr = get_exec_path(&#34;QHELP&#34;)
        launch_pangview(rr)

    def activate_about(self, action):
        self.update_statusbar(&#34;Showing About Dialog&#34;)
        pedync.about(self)

    def newfile(self, newname = &#34;&#34;):

        fff = &#34;&#34;

        if newname == &#34;&#34;:
            # Find non existing file
            cnt = self.fcount + 1; fff = &#34;&#34;
            base, ext = os.path.splitext(pedconfig.conf.UNTITLED)
            while True:
                fff =  &#34;%s_%d.txt&#34; % (base, cnt)
                #print( fff)
                if not os.path.isfile(fff):
                    break
                cnt += 1

            self.fcount = cnt
        else:
            fff = newname
            # Touch
            try:
                open(fff, &#34;w&#34;).close()
            except:
                sss = &#34;Cannot create file %s&#34; % newname
                self.update_statusbar(sss)
                print(sss,  sys.exc_info())
                pedync.message(&#34;\n&#34; + sss + &#34;\n&#34;)
                return

        # Try and change access/ownership to group write
        try:
            ostat = os.stat(fff)
            os.chmod(fff, ostat.st_mode | stat.S_IWGRP)
        except:
            #print(&#34;Cannot change group write on &#39;%s&#39;&#34; % fff,  sys.exc_info())
            pass

        vpaned = edPane([])
        vpaned.area.fname = os.path.realpath(fff) + &#34;&#34;
        global notebook
        add_page(vpaned)
        vpaned.area.set_tablabel()

        #label = Gtk.Label(&#34; &#34; + os.path.basename(aa) + &#34; &#34;)
        #notebook.set_tab_label(vpaned, label)
        self.mywin.show_all()

        # Make it current
        nn = notebook.get_n_pages()
        if nn:
            vcurr = notebook.set_current_page(nn-1)
            vcurr = notebook.get_nth_page(nn-1)
            self.mywin.set_focus(vcurr.vbox.area)

    def makefilter(self, mask, name):
        filter =  Gtk.FileFilter.new()
        filter.add_pattern(mask)
        filter.set_name(name)
        return filter

    # Traditional open file
    def open(self):

        #warnings.simplefilter(&#34;ignore&#34;)
        fc = Gtk.FileChooserDialog(title=&#34;Open file&#34;, transient_for=self.mywin, \
                        action=Gtk.FileChooserAction.OPEN)

        but =   &#34;Cancel&#34;, Gtk.ButtonsType.CANCEL, &#34;Open File&#34;, Gtk.ButtonsType.OK
        fc.add_buttons(*but)
        #warnings.simplefilter(&#34;default&#34;)

        filters = []
        filters.append(self.makefilter(&#34;*.*&#34;, &#34;All files (*.*)&#34;))
        filters.append(self.makefilter(&#34;*.py&#34;, &#34;Python files (*.py)&#34;))
        filters.append(self.makefilter(&#34;*.c&#34;, &#34;&#39;C&#39; source files (*.c)&#34;))
        filters.append(self.makefilter(&#34;*.h&#34;, &#34;&#39;H&#39; source files (*.h)&#34;))
        filters.append(self.makefilter(&#34;*.txt&#34;, &#34;Text files (*.txt)&#34;))
        filters.append(self.makefilter(&#34;*.md&#34;, &#34;Markup files (*.md)&#34;))
        filters.append(self.makefilter(&#34;*.ped&#34;, &#34;PED files (*.ped)&#34;))

        if filters:
            for aa in filters:
                fc.add_filter(aa)

        fc.set_default_response(Gtk.ButtonsType.OK)
        fc.set_current_folder(os.getcwd())
        fc.connect(&#34;response&#34;, self.done_open_fc)
        fc.connect(&#34;current-folder-changed&#34;, self.folder_ch )

        #fc.set_current_name(self.fname)
        fc.run()

    def save(self, flag = False):
        vcurr = notebook.get_nth_page(notebook.get_current_page())
        if flag:
            vcurr.area.saveas()
            #self.mywin.set_title(&#34;pyedpro: &#34; + vcurr.area.fname)
        else:
            vcurr.area.save()

    def copy(self):
        nn2 = notebook.get_current_page()
        vcurr2 = notebook.get_nth_page(nn2)
        if vcurr2:
            pedconfig.conf.keyh.acth.ctrl_c(vcurr2.area)

    def cut(self):
        nn2 = notebook.get_current_page()
        vcurr2 = notebook.get_nth_page(nn2)
        if vcurr2:
            pedconfig.conf.keyh.acth.ctrl_x(vcurr2.area)

    def tts(self):
        nn2 = notebook.get_current_page()
        vcurr2 = notebook.get_nth_page(nn2)
        if vcurr2:
             pedconfig.conf.keyh.acth.ctrl_alt_r(vcurr2.area)

    def paste(self):
        nn2 = notebook.get_current_page()
        vcurr2 = notebook.get_nth_page(nn2)
        if vcurr2:
            pedconfig.conf.keyh.acth.ctrl_v(vcurr2.area)

    # -------------------------------------------------------------------
    # Menu callback

    def activate_action(self, action):

        #dialog = Gtk.MessageDialog(None, Gtk.DIALOG_DESTROY_WITH_PARENT,
        #    Gtk.MESSAGE_INFO, Gtk.BUTTONS_CLOSE,
        #    &#39;Action: &#34;%s&#34; of type &#34;%s&#34;&#39; % (action.get_name(), type(action)))

        # Close dialog on user response
        #dialog.connect (&#34;response&#34;, lambda d, r: d.destroy())
        #dialog.show()

        warnings.simplefilter(&#34;ignore&#34;)
        strx = action.get_name()
        warnings.simplefilter(&#34;default&#34;)

        if 1: #pedconfig.conf.verbose:
            print (&#34;activate_action with:&#34;, strx)

        if strx == &#34;Close All&#34;:
            self.closeall()

        if strx == &#34;Load Session&#34;:
            #print(&#34;Loading session&#34;)
            load_sess()

        if strx == &#34;Save Session&#34;:
            #print(&#34;Saving session&#34;)
            # Gather all file names
            accum = &#34;&#34;
            nn = notebook.get_n_pages(); cnt = 0; cnt2 = 0
            while True:
                if cnt &gt;= nn: break
                ppp = notebook.get_nth_page(cnt)
                #print (&#34;file:&#34;, ppp.area.fname)
                accum +=  ppp.area.fname + &#34;\n&#34;
                cnt += 1
            #print (&#34;file list&#34;, accum)
            save_sess(accum)

            self.update_statusbar(&#34;Session %s saved.&#34; % (&#34;noname&#34;))

        if strx == &#34;Start Terminal&#34;:
            #print(&#34;Starting terminal&#34;)
            #if os.name == &#34;nt&#34;:
            #    os.system(&#34;C:\\msys64\\mingw32.exe&#34;)
            self.start_term()

        if strx == &#34;New&#34;:
            self.newfile()

        if strx == &#34;Open&#34;:
            #print(&#34;open frm menu&#34;)
            self.open()

        if strx == &#34;Save&#34;:
            self.save()

        if strx == &#34;SaveAs&#34;:
            self.save(True)

        if strx == &#34;Close&#34;:
            self.close_document()

        if strx == &#34;Copy&#34;:
            self.copy()

        if strx == &#34;Cut&#34;:
            self.cut()

        if strx == &#34;Paste&#34;:
            self.paste()

        if strx == &#34;Goto&#34;:
            nn2 = notebook.get_current_page()
            vcurr2 = notebook.get_nth_page(nn2)
            if vcurr2:
                pedconfig.conf.keyh.acth.alt_g(vcurr2.area)

        if strx == &#34;Find&#34;:
            #print &#34;find&#34;
            nn2 = notebook.get_current_page()
            vcurr2 = notebook.get_nth_page(nn2)
            if vcurr2:
                pedconfig.conf.keyh.acth.ctrl_f(vcurr2.area)

        if strx == &#34;Record&#34;:
            #print &#34;record&#34;
            nn2 = notebook.get_current_page()
            vcurr2 = notebook.get_nth_page(nn2)
            if vcurr2:
                pedconfig.conf.keyh.acth.f7(vcurr2.area)

        if strx == &#34;Play&#34;:
            nn2 = notebook.get_current_page()
            vcurr2 = notebook.get_nth_page(nn2)
            if vcurr2:
                pedconfig.conf.keyh.acth.f8(vcurr2.area)

        if strx == &#34;Spell&#34;:
            nn2 = notebook.get_current_page()
            vcurr2 = notebook.get_nth_page(nn2)
            if vcurr2:
                pedconfig.conf.keyh.acth.f9(vcurr2.area)

        if strx == &#34;Spell2&#34;:
            nn2 = notebook.get_current_page()
            vcurr2 = notebook.get_nth_page(nn2)
            if vcurr2:
                pedconfig.conf.keyh.acth.f9(vcurr2.area, True)

        if strx == &#34;MakeRO&#34;:
            nn = notebook.get_n_pages(); cnt = 0; cnt2 = 0
            vcurr2 = notebook.get_nth_page(notebook.get_current_page())
            while True:
                if cnt &gt;= nn: break
                ppp = notebook.get_nth_page(cnt)
                #print (&#34;Make read only file:&#34;, ppp.area.fname)
                ppp.area.readonly = True
                ppp.area.set_tablabel()
                if ppp == vcurr2:
                    ppp.area.invalidate()
                cnt += 1
            self.update_statusbar(&#34;Made all buffers READ only&#34;)

        if strx == &#34;MakeRW&#34;:
            nn = notebook.get_n_pages(); cnt = 0; cnt2 = 0
            vcurr2 = notebook.get_nth_page(notebook.get_current_page())
            while True:
                if cnt &gt;= nn: break
                ppp = notebook.get_nth_page(cnt)
                #print (&#34;Make read only file:&#34;, ppp.area.fname)
                ppp.area.readonly = False
                ppp.area.set_tablabel()
                if ppp == vcurr2:
                    ppp.area.invalidate()
                cnt += 1
            self.update_statusbar(&#34;Made all buffers READ/WRITE&#34;)

        if strx == &#34;unColorBar&#34;:
            if not self.headcolor:
                style = self.headbar.get_style_context()
                self.headcolor = style.get_property(&#34;background-color&#34;, Gtk.StateFlags.NORMAL)

            self.headbar.override_background_color(
                    Gtk.StateFlags.NORMAL, self.headcolor)
            notebook.override_background_color(
                    Gtk.StateFlags.NORMAL, self.headcolor)
            self.update_statusbar(&#34;Color Bar Reset&#34;)

        if strx == &#34;ColorBar&#34;:
            #states =  (Gtk.StateFlags.NORMAL, Gtk.StateFlags.ACTIVE,
            #    Gtk.StateFlags.VISITED, Gtk.StateFlags.FOCUSED,
            #        Gtk.StateFlags.SELECTED, Gtk.StateFlags.INSENSITIVE,
            #         Gtk.StateFlags.BACKDROP, Gtk.StateFlags.DIR_RTL,
            #         Gtk.StateFlags.VISITED, Gtk.StateFlags.INCONSISTENT,
            #         Gtk.StateFlags.DIR_LTR)
            # for aa in states:  # tested .. no difference
            #    self.headbar.override_background_color(
            #        aa, Gdk.RGBA(.8, .9, .8) )

            if not self.headcolor:
                style = self.headbar.get_style_context()
                self.headcolor = style.get_property(&#34;background-color&#34;, Gtk.StateFlags.NORMAL)

            self.headbar.override_background_color(
                    Gtk.StateFlags.NORMAL, Gdk.RGBA(.8, .86, .85) )

            notebook.override_background_color(
                    Gtk.StateFlags.NORMAL, Gdk.RGBA(.8, .86, .85) )

            self.update_statusbar(&#34;Color Bar Changed TEAL&#34;)


        if strx == &#34;RedBar&#34;:
            if not self.headcolor:
                style = self.headbar.get_style_context()
                self.headcolor = style.get_property(&#34;background-color&#34;, Gtk.StateFlags.NORMAL)

            self.headbar.override_background_color(
                    Gtk.StateFlags.NORMAL, Gdk.RGBA(.86, .80, .80) )

            notebook.override_background_color(
                    Gtk.StateFlags.NORMAL, Gdk.RGBA(.86, .80, .80) )

            self.update_statusbar(&#34;Color Bar Changed RED&#34;)

        if strx == &#34;StopDiff&#34;:
            nn = notebook.get_n_pages(); cnt = 0; cnt2 = 0
            vcurr2 = notebook.get_nth_page(notebook.get_current_page())
            while True:
                if cnt &gt;= nn: break
                ppp = notebook.get_nth_page(cnt)
                #print (&#34;Make read only file:&#34;, ppp.area.fname)
                ppp.area.diffmode = 0
                ppp.area.set_tablabel()
                if ppp == vcurr2:
                    ppp.area.invalidate()
                cnt += 1
            self.update_statusbar(&#34;Stopped diffing.&#34;)

        if strx == &#34;TogStrip&#34;:
            self.togstrip = not self.togstrip
            print(&#34;Toggle strip&#34;, self.togstrip)
            vcurr = notebook.get_nth_page(notebook.get_current_page())
            if self.togstrip:
                vcurr.area.strip = 50
            else:
                vcurr.area.strip = 0
            vcurr.area.invalidate()

        if strx == &#34;Animate&#34;:
            nn2 = notebook.get_current_page()
            vcurr2 = notebook.get_nth_page(nn2)
            if vcurr2:
                pedconfig.conf.keyh.acth.f8(vcurr2.area, True)

        if strx == &#34;Undo&#34;:
            nn2 = notebook.get_current_page()
            vcurr2 = notebook.get_nth_page(nn2)
            if vcurr2:
                pedconfig.conf.keyh.acth.ctrl_z(vcurr2.area)

        if strx == &#34;Redo&#34;:
            nn2 = notebook.get_current_page()
            vcurr2 = notebook.get_nth_page(nn2)
            if vcurr2:
                pedconfig.conf.keyh.acth.ctrl_y(vcurr2.area)

        if strx == &#34;SaveAll&#34;:
            nn2 = notebook.get_current_page()
            vcurr2 = notebook.get_nth_page(nn2)
            if vcurr2:
                pedconfig.conf.keyh.acth.alt_a(vcurr2.area)

        if strx == &#34;Discard Undo&#34;:
            nn2 = notebook.get_current_page()
            vcurr2 = notebook.get_nth_page(nn2)
            if vcurr2:
                vcurr2.area.delundo()

        if strx == &#34;Savemacro&#34;:
            nn2 = notebook.get_current_page()
            vcurr2 = notebook.get_nth_page(nn2)
            if vcurr2:
                vcurr2.area.savemacro()

        if strx == &#34;Loadmacro&#34;:
            nn2 = notebook.get_current_page()
            vcurr2 = notebook.get_nth_page(nn2)
            if vcurr2:
                vcurr2.area.loadmacro()

        if strx == &#34;NextWin&#34;:
            self.nextwin()

        if strx == &#34;PrevWin&#34;:
            self.prevwin()

        if strx == &#34;ShowLog&#34;:
            pedlog.show_logwin()

        if strx.find(&#34;/sess_&#34;) &gt;= 0:
            fname = pedconfig.conf.sql.get_str(strx)
            self.openfile(fname)

        if strx == &#34;Colors&#34;:
            nn2 = notebook.get_current_page()
            vcurr2 = notebook.get_nth_page(nn2)
            if vcurr2:
                pass
                pedcolor.colordlg(self, vcurr2.area)

        if strx == &#34;Fonts&#34;:
            nn2 = notebook.get_current_page()
            vcurr2 = notebook.get_nth_page(nn2)
            if vcurr2:
                pedfont.selfont(self, vcurr2.area)

        if strx == &#34;Settings&#34;:
            self.update_statusbar(&#34;Showing Settings Dialog&#34;)
            pedync.message(&#34;\n    Settings: Work in progress    \n&#34;)

        if strx == &#34;Help&#34;:
            #pedync.message(&#34;\n    Help: Work in progress    \n&#34;)
            nn2 = notebook.get_current_page()
            vcurr2 = notebook.get_nth_page(nn2)
            if vcurr2:
                pedconfig.conf.keyh.acth.f1(vcurr2.area)

        if strx == &#34;KeyDoc&#34;:
            self.update_statusbar(&#34;Showing Keyboard Help&#34;)
            fname = get_exec_path(&#34;KEYS.TXT&#34;)
            self.openfile(fname)

    def closeall(self):
        cc = notebook.get_n_pages()
        for aa in range(cc-1, -1, -1):
            #print (&#34;closing doc index&#34;, aa)
            vcurr = notebook.get_nth_page(aa)
            vcurr.area.closedoc()
            notebook.remove_page(aa)
        self.mywin.set_title(&#34;pyedpro &#34;)

    def close_document(self, other = None):
        cc = notebook.get_n_pages()
        if other:
            for aa in range(cc):
                vcurr = notebook.get_nth_page(aa)
                if vcurr.area == other:
                    notebook.set_current_page(aa)
                    break
        nn = notebook.get_current_page()
        vcurr = notebook.get_nth_page(nn)

        # Disable close
        if vcurr.area.closedoc():
            self.update_statusbar(&#34;Did not close doc: &#39;%s&#39;&#34; %  vcurr.area.fname);
            return

        self.mywin.set_title(&#34;pyedpro: (closed doc)&#34;)

        # Wrap around if closed first
        if nn == 0: mm = cc - 1
        else:       mm = nn - 1

        notebook.set_current_page(mm)
        nn2 = notebook.get_current_page()
        vcurr2 = notebook.get_nth_page(nn2)
        self.mywin.set_focus(vcurr2.vbox.area)
        notebook.remove_page(nn)
        self.mywin.show_all()

    def  firstwin(self):
        cc = notebook.get_n_pages()
        if cc == 0:
            return
        notebook.set_current_page(0)
        nn2 = notebook.get_current_page()
        vcurr2 = notebook.get_nth_page(nn2)
        self.mywin.set_focus(vcurr2.vbox.area)
        self.mywin.show_all()

    def  lastwin(self):
        cc = notebook.get_n_pages()
        if cc == 0:
            return
        notebook.set_current_page(cc-1)
        nn2 = notebook.get_current_page()
        vcurr2 = notebook.get_nth_page(nn2)
        self.mywin.set_focus(vcurr2.vbox.area)
        self.mywin.show_all()

    def  nextwin(self):
        cc = notebook.get_n_pages()
        nn = notebook.get_current_page()
        vcurr = notebook.get_nth_page(nn)

        # Wrap around if needed
        if nn == cc - 1: mm = 0
        else:       mm = nn + 1
        notebook.set_current_page(mm)
        nn2 = notebook.get_current_page()
        vcurr2 = notebook.get_nth_page(nn2)
        self.mywin.set_focus(vcurr2.vbox.area)
        vcurr2.vbox.area.fire = 1
        #self.mywin.show_all()

    def  prevwin(self):
        cc = notebook.get_n_pages()
        nn = notebook.get_current_page()
        vcurr = notebook.get_nth_page(nn)

        # Wrap around if needed
        if nn == 0: mm = cc - 1
        else:       mm = nn - 1
        notebook.set_current_page(mm)
        nn2 = notebook.get_current_page()
        vcurr2 = notebook.get_nth_page(nn2)
        self.mywin.set_focus(vcurr2.vbox.area)
        #self.mywin.show_all()

    def folder_ch(self, win):
        #print &#34;folder_ch&#34;
        pass
        #return True

    def done_open_fc(self, win, resp):
        #print &#34;done_open_fc&#34;, win, resp
        if resp == Gtk.ButtonsType.OK:
            fname = win.get_filename()
            if not fname:
                #print &#34;Must have filename&#34;
                self.update_statusbar(&#34;No filename specified&#34;)
                pass
            elif os.path.isdir(fname):
                self.update_statusbar(&#34;Changed to %s&#34; % fname)
                os.chdir(fname)
                win.set_current_folder(fname)
                return
            else:
                self.openfile(fname)
        win.destroy()

    def saveall(self):
        #print &#34;saveall&#34;
        # Save all files
        nn = notebook.get_n_pages(); cnt = 0; cnt2 = 0
        while True:
            if cnt &gt;= nn: break
            ppp = notebook.get_nth_page(cnt)
            if ppp.area.changed:
                ppp.area.writeout()
                cnt2 += 1
            cnt += 1
        self.update_statusbar(&#34;%d of %d buffers saved.&#34; % (cnt2, nn))

    def start_term(self):
        #print(&#34;Terminal Here&#34;)
        exename = &#34;&#34;
        try:
            if platform.system().find(&#34;Win&#34;) &gt;= 0:
                ret = subprocess.Popen([&#34;putty&#34;])
                #if not ret.returncode:
                #    raise OSError
                #print(&#34;No terminal on windows. (TODO)&#34;)
            else:
                ret = None
                # The order represents the priority of opening
                termstr = (&#34;xfce4-terminal&#34;, &#34;gnome-terminal&#34;, &#34;lxterminal&#34;, &#34;xterm&#34;,)
                for exename in termstr:
                    # Stumble until terminal found
                    try:
                        ret = subprocess.Popen([exename],)
                        if not ret.returncode:
                            break
                    except:
                        pass

                if ret.returncode:
                    raise OSError
        except:
            print(&#34;Cannot launch terminal&#34;, sys.exc_info())
            pedync.message(&#34;\n   Cannot launch terminal executable \n\n&#34;
                       &#34;              (Please install)&#34;)
        finally:
            self.update_statusbar(&#34;Started terminal &#39;%s&#39;&#34; % exename)

    def status_hist(self, arg1, arg2):
        print(&#34;hist pressed&#34;)
        pass

    # -------------------------------------------------------------------

    def openfile(self, fnamex):

        # Empty line from sess load
        if not fnamex:
            #print(&#34;Empty file name passed&#34;)
            return

        # Any indication it is there?
        if not os.path.isfile(fnamex):
            print(&#34;Cannot open file:&#34;, &#34;&#39;&#34; + fnamex + &#34;&#39;&#34;)
            self.update_statusbar(&#34;Cannot open file &#39;{0:s}&#39;&#34;.format(fnamex))
            return

        # Is it already loaded? ... activate
        nn = notebook.get_n_pages()
        fname2 = os.path.realpath(fnamex)
        for aa in range(nn):
            vcurr = notebook.get_nth_page(aa)
            if vcurr.area.fname == fname2:
                if pedconfig.conf.verbose:
                    print(&#34;Already open &#39;&#34;+ fname2 + &#34;&#39;&#34;)
                self.update_statusbar(&#34;Already open, activating &#39;{0:s}&#39;&#34;.format(fname2))
                vcurr = notebook.set_current_page(aa)
                vcurr = notebook.get_nth_page(aa)
                self.mywin.set_focus(vcurr.vbox.area)
                return

        if pedconfig.conf.verbose:
            print(&#34;Opening &#39;&#34;+ fname2 + &#34;&#39;&#34;)

        self.update_statusbar(&#34;Opening file &#39;{0:s}&#39;&#34;.format(fname2), True)
        vpaned = edPane()
        ret = vpaned.area.loadfile(fname2)
        if not ret:
            self.update_statusbar(&#34;Cannot read file &#39;{0:s}&#39;&#34;.format(fname2))
            return
        vpaned.area2.loadfile(fname2)
        self.update_statusbar(&#34;Opened file &#39;{0:s}&#39;&#34;.format(fname2))

        #self.oh.add(fname2) # added at lower level now

        # Add to the list of buffers
        add_page(vpaned)
        vpaned.area.set_tablabel()
        self.mywin.show_all()
        # Make it current
        nn = notebook.get_n_pages()
        if nn:
            vcurr = notebook.set_current_page(nn-1)
            vcurr = notebook.get_nth_page(nn-1)
            self.mywin.set_focus(vcurr.vbox.area)

        usleep(10)
        return vcurr.vbox.area

    def activate_exit(self, action = None):
        #print &#34;activate_exit called&#34;
        OnExit(self.mywin, self)

    def activate_quit(self, action):
        #print &#34;activate_quit called&#34;
        OnExit(self.mywin, self, False)

    def activate_radio_action(self, action, current):
        active = current.get_active()
        value = current.get_current_value()

        if active:
            dialog = Gtk.MessageDialog(self, Gtk.DIALOG_DESTROY_WITH_PARENT,
                Gtk.MESSAGE_INFO, Gtk.ButtonsType.CLOSE,
                &#34;You activated radio action: \&#34;%s\&#34; of type \&#34;%s\&#34;.\nCurrent value: %d&#34; %
                (current.get_name(), type(current), value))

            # Close dialog on user response
            dialog.connect(&#34;response&#34;, lambda d, r: d.destroy())
            dialog.show()

    # This is the line count / pos status bar
    def update_statusbar2(self, xx = 0, yy = 0, ins=0, tlen=0, clip=0, caps=0, scr=0, colsel=0):
        # Always update line / col
        if ins: str2 = &#34;INS&#34;
        else: str2 =&#34;OVR&#34;

        # Always update CAPS
        if caps: str3 = &#34;CAP&#34;
        else: str3 =&#34;cap&#34;

        if scr: str4 = &#34;SCR&#34;
        else: str4 =&#34;scr&#34;

        if colsel: str5 = &#34;COL&#34;
        else: str5 =&#34;ROW&#34;

        strx2 = &#34;  Ln {0:d} Col {1:d} Tot {3:d}  {2:s} {5:s} {6:s} Clip: {4:d} {7:s}  &#34;.\
                                format(int(yy+1), int(xx+1), str2, tlen, clip, str3, str4, str5)

        #self.statusbar2.pop(0)
        #self.statusbar2.push(0, strx2)
        self.slab2.set_text(strx2)

    def status_lang(self, atg1, arf2):
        print(&#34;Lang pressed&#34;)

    def update_statusbar(self, strx, nolog = False):
        # Clear any previous message, underflow is allowed
        #self.statusbar.pop(0)
        if not strx:
            self.update_statusbar(&#34;Idle&#34;, True)
            return

        #self.statusbar.push(0, strx)
        self.statuscount = STATUSCOUNT
        self.slab.set_text(strx)
        if not nolog:
            pedlog.log(strx)

    def update_resize_grip(self, widget, event):
        #print &#34;update state&#34;, event, event.changed_mask
        #self.mywin.set_focus(notebook)

        mask = Gdk.WindowState.MAXIMIZED
        # | Gdk.FULLSCREEN

        &#39;&#39;&#39;if (event.changed_mask &amp; mask):
            self.statusbar.set_has_resize_grip(not (event.new_window_state &amp; mask))
        &#39;&#39;&#39;</code></pre>
</details>
<h3>Methods</h3>
<dl>
<dt id="pedwin.EdMainWindow.ThredCallback"><code class="name flex">
<span>def <span class="ident">ThredCallback</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def ThredCallback(self): #, event, cnt):

    #Gdk.threads_enter()
    #if pedconfig.conf.verbose:
    #    print(&#34;Callback from thread&#34;, self.rescnt)
    self.rescnt += 1

    #self.mywin.emit(&#34;my-custom-signal&#34;, event)
    #event.set()
    #event = threading.Event()
    #result = []
    #Gdk.threads_leave()
    return True</code></pre>
</details>
</dd>
<dt id="pedwin.EdMainWindow.ThredMine"><code class="name flex">
<span>def <span class="ident">ThredMine</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def ThredMine(self):
    cnt = 0
    while(1):
        event = threading.Event()
        result = []
        Gdk.threads_enter()
        #GLib.idle_add(self.ThredCallback, event, cnt)
        event.wait()
        Gdk.threads_leave()
        cnt += 1
        #usleep(1000)
        time.sleep(1)</code></pre>
</details>
</dd>
<dt id="pedwin.EdMainWindow.activate_about"><code class="name flex">
<span>def <span class="ident">activate_about</span></span>(<span>self, action)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def activate_about(self, action):
    self.update_statusbar(&#34;Showing About Dialog&#34;)
    pedync.about(self)</code></pre>
</details>
</dd>
<dt id="pedwin.EdMainWindow.activate_action"><code class="name flex">
<span>def <span class="ident">activate_action</span></span>(<span>self, action)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def activate_action(self, action):

    #dialog = Gtk.MessageDialog(None, Gtk.DIALOG_DESTROY_WITH_PARENT,
    #    Gtk.MESSAGE_INFO, Gtk.BUTTONS_CLOSE,
    #    &#39;Action: &#34;%s&#34; of type &#34;%s&#34;&#39; % (action.get_name(), type(action)))

    # Close dialog on user response
    #dialog.connect (&#34;response&#34;, lambda d, r: d.destroy())
    #dialog.show()

    warnings.simplefilter(&#34;ignore&#34;)
    strx = action.get_name()
    warnings.simplefilter(&#34;default&#34;)

    if 1: #pedconfig.conf.verbose:
        print (&#34;activate_action with:&#34;, strx)

    if strx == &#34;Close All&#34;:
        self.closeall()

    if strx == &#34;Load Session&#34;:
        #print(&#34;Loading session&#34;)
        load_sess()

    if strx == &#34;Save Session&#34;:
        #print(&#34;Saving session&#34;)
        # Gather all file names
        accum = &#34;&#34;
        nn = notebook.get_n_pages(); cnt = 0; cnt2 = 0
        while True:
            if cnt &gt;= nn: break
            ppp = notebook.get_nth_page(cnt)
            #print (&#34;file:&#34;, ppp.area.fname)
            accum +=  ppp.area.fname + &#34;\n&#34;
            cnt += 1
        #print (&#34;file list&#34;, accum)
        save_sess(accum)

        self.update_statusbar(&#34;Session %s saved.&#34; % (&#34;noname&#34;))

    if strx == &#34;Start Terminal&#34;:
        #print(&#34;Starting terminal&#34;)
        #if os.name == &#34;nt&#34;:
        #    os.system(&#34;C:\\msys64\\mingw32.exe&#34;)
        self.start_term()

    if strx == &#34;New&#34;:
        self.newfile()

    if strx == &#34;Open&#34;:
        #print(&#34;open frm menu&#34;)
        self.open()

    if strx == &#34;Save&#34;:
        self.save()

    if strx == &#34;SaveAs&#34;:
        self.save(True)

    if strx == &#34;Close&#34;:
        self.close_document()

    if strx == &#34;Copy&#34;:
        self.copy()

    if strx == &#34;Cut&#34;:
        self.cut()

    if strx == &#34;Paste&#34;:
        self.paste()

    if strx == &#34;Goto&#34;:
        nn2 = notebook.get_current_page()
        vcurr2 = notebook.get_nth_page(nn2)
        if vcurr2:
            pedconfig.conf.keyh.acth.alt_g(vcurr2.area)

    if strx == &#34;Find&#34;:
        #print &#34;find&#34;
        nn2 = notebook.get_current_page()
        vcurr2 = notebook.get_nth_page(nn2)
        if vcurr2:
            pedconfig.conf.keyh.acth.ctrl_f(vcurr2.area)

    if strx == &#34;Record&#34;:
        #print &#34;record&#34;
        nn2 = notebook.get_current_page()
        vcurr2 = notebook.get_nth_page(nn2)
        if vcurr2:
            pedconfig.conf.keyh.acth.f7(vcurr2.area)

    if strx == &#34;Play&#34;:
        nn2 = notebook.get_current_page()
        vcurr2 = notebook.get_nth_page(nn2)
        if vcurr2:
            pedconfig.conf.keyh.acth.f8(vcurr2.area)

    if strx == &#34;Spell&#34;:
        nn2 = notebook.get_current_page()
        vcurr2 = notebook.get_nth_page(nn2)
        if vcurr2:
            pedconfig.conf.keyh.acth.f9(vcurr2.area)

    if strx == &#34;Spell2&#34;:
        nn2 = notebook.get_current_page()
        vcurr2 = notebook.get_nth_page(nn2)
        if vcurr2:
            pedconfig.conf.keyh.acth.f9(vcurr2.area, True)

    if strx == &#34;MakeRO&#34;:
        nn = notebook.get_n_pages(); cnt = 0; cnt2 = 0
        vcurr2 = notebook.get_nth_page(notebook.get_current_page())
        while True:
            if cnt &gt;= nn: break
            ppp = notebook.get_nth_page(cnt)
            #print (&#34;Make read only file:&#34;, ppp.area.fname)
            ppp.area.readonly = True
            ppp.area.set_tablabel()
            if ppp == vcurr2:
                ppp.area.invalidate()
            cnt += 1
        self.update_statusbar(&#34;Made all buffers READ only&#34;)

    if strx == &#34;MakeRW&#34;:
        nn = notebook.get_n_pages(); cnt = 0; cnt2 = 0
        vcurr2 = notebook.get_nth_page(notebook.get_current_page())
        while True:
            if cnt &gt;= nn: break
            ppp = notebook.get_nth_page(cnt)
            #print (&#34;Make read only file:&#34;, ppp.area.fname)
            ppp.area.readonly = False
            ppp.area.set_tablabel()
            if ppp == vcurr2:
                ppp.area.invalidate()
            cnt += 1
        self.update_statusbar(&#34;Made all buffers READ/WRITE&#34;)

    if strx == &#34;unColorBar&#34;:
        if not self.headcolor:
            style = self.headbar.get_style_context()
            self.headcolor = style.get_property(&#34;background-color&#34;, Gtk.StateFlags.NORMAL)

        self.headbar.override_background_color(
                Gtk.StateFlags.NORMAL, self.headcolor)
        notebook.override_background_color(
                Gtk.StateFlags.NORMAL, self.headcolor)
        self.update_statusbar(&#34;Color Bar Reset&#34;)

    if strx == &#34;ColorBar&#34;:
        #states =  (Gtk.StateFlags.NORMAL, Gtk.StateFlags.ACTIVE,
        #    Gtk.StateFlags.VISITED, Gtk.StateFlags.FOCUSED,
        #        Gtk.StateFlags.SELECTED, Gtk.StateFlags.INSENSITIVE,
        #         Gtk.StateFlags.BACKDROP, Gtk.StateFlags.DIR_RTL,
        #         Gtk.StateFlags.VISITED, Gtk.StateFlags.INCONSISTENT,
        #         Gtk.StateFlags.DIR_LTR)
        # for aa in states:  # tested .. no difference
        #    self.headbar.override_background_color(
        #        aa, Gdk.RGBA(.8, .9, .8) )

        if not self.headcolor:
            style = self.headbar.get_style_context()
            self.headcolor = style.get_property(&#34;background-color&#34;, Gtk.StateFlags.NORMAL)

        self.headbar.override_background_color(
                Gtk.StateFlags.NORMAL, Gdk.RGBA(.8, .86, .85) )

        notebook.override_background_color(
                Gtk.StateFlags.NORMAL, Gdk.RGBA(.8, .86, .85) )

        self.update_statusbar(&#34;Color Bar Changed TEAL&#34;)


    if strx == &#34;RedBar&#34;:
        if not self.headcolor:
            style = self.headbar.get_style_context()
            self.headcolor = style.get_property(&#34;background-color&#34;, Gtk.StateFlags.NORMAL)

        self.headbar.override_background_color(
                Gtk.StateFlags.NORMAL, Gdk.RGBA(.86, .80, .80) )

        notebook.override_background_color(
                Gtk.StateFlags.NORMAL, Gdk.RGBA(.86, .80, .80) )

        self.update_statusbar(&#34;Color Bar Changed RED&#34;)

    if strx == &#34;StopDiff&#34;:
        nn = notebook.get_n_pages(); cnt = 0; cnt2 = 0
        vcurr2 = notebook.get_nth_page(notebook.get_current_page())
        while True:
            if cnt &gt;= nn: break
            ppp = notebook.get_nth_page(cnt)
            #print (&#34;Make read only file:&#34;, ppp.area.fname)
            ppp.area.diffmode = 0
            ppp.area.set_tablabel()
            if ppp == vcurr2:
                ppp.area.invalidate()
            cnt += 1
        self.update_statusbar(&#34;Stopped diffing.&#34;)

    if strx == &#34;TogStrip&#34;:
        self.togstrip = not self.togstrip
        print(&#34;Toggle strip&#34;, self.togstrip)
        vcurr = notebook.get_nth_page(notebook.get_current_page())
        if self.togstrip:
            vcurr.area.strip = 50
        else:
            vcurr.area.strip = 0
        vcurr.area.invalidate()

    if strx == &#34;Animate&#34;:
        nn2 = notebook.get_current_page()
        vcurr2 = notebook.get_nth_page(nn2)
        if vcurr2:
            pedconfig.conf.keyh.acth.f8(vcurr2.area, True)

    if strx == &#34;Undo&#34;:
        nn2 = notebook.get_current_page()
        vcurr2 = notebook.get_nth_page(nn2)
        if vcurr2:
            pedconfig.conf.keyh.acth.ctrl_z(vcurr2.area)

    if strx == &#34;Redo&#34;:
        nn2 = notebook.get_current_page()
        vcurr2 = notebook.get_nth_page(nn2)
        if vcurr2:
            pedconfig.conf.keyh.acth.ctrl_y(vcurr2.area)

    if strx == &#34;SaveAll&#34;:
        nn2 = notebook.get_current_page()
        vcurr2 = notebook.get_nth_page(nn2)
        if vcurr2:
            pedconfig.conf.keyh.acth.alt_a(vcurr2.area)

    if strx == &#34;Discard Undo&#34;:
        nn2 = notebook.get_current_page()
        vcurr2 = notebook.get_nth_page(nn2)
        if vcurr2:
            vcurr2.area.delundo()

    if strx == &#34;Savemacro&#34;:
        nn2 = notebook.get_current_page()
        vcurr2 = notebook.get_nth_page(nn2)
        if vcurr2:
            vcurr2.area.savemacro()

    if strx == &#34;Loadmacro&#34;:
        nn2 = notebook.get_current_page()
        vcurr2 = notebook.get_nth_page(nn2)
        if vcurr2:
            vcurr2.area.loadmacro()

    if strx == &#34;NextWin&#34;:
        self.nextwin()

    if strx == &#34;PrevWin&#34;:
        self.prevwin()

    if strx == &#34;ShowLog&#34;:
        pedlog.show_logwin()

    if strx.find(&#34;/sess_&#34;) &gt;= 0:
        fname = pedconfig.conf.sql.get_str(strx)
        self.openfile(fname)

    if strx == &#34;Colors&#34;:
        nn2 = notebook.get_current_page()
        vcurr2 = notebook.get_nth_page(nn2)
        if vcurr2:
            pass
            pedcolor.colordlg(self, vcurr2.area)

    if strx == &#34;Fonts&#34;:
        nn2 = notebook.get_current_page()
        vcurr2 = notebook.get_nth_page(nn2)
        if vcurr2:
            pedfont.selfont(self, vcurr2.area)

    if strx == &#34;Settings&#34;:
        self.update_statusbar(&#34;Showing Settings Dialog&#34;)
        pedync.message(&#34;\n    Settings: Work in progress    \n&#34;)

    if strx == &#34;Help&#34;:
        #pedync.message(&#34;\n    Help: Work in progress    \n&#34;)
        nn2 = notebook.get_current_page()
        vcurr2 = notebook.get_nth_page(nn2)
        if vcurr2:
            pedconfig.conf.keyh.acth.f1(vcurr2.area)

    if strx == &#34;KeyDoc&#34;:
        self.update_statusbar(&#34;Showing Keyboard Help&#34;)
        fname = get_exec_path(&#34;KEYS.TXT&#34;)
        self.openfile(fname)</code></pre>
</details>
</dd>
<dt id="pedwin.EdMainWindow.activate_caltab"><code class="name flex">
<span>def <span class="ident">activate_caltab</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def activate_caltab(self):
    ppp = self.notebook2.get_nth_page(self.notebook2.get_n_pages()-4)
    if ppp:
        # This assumes the notetab is the one before the last one
        self.notebook2.set_current_page(self.notebook2.get_n_pages()-4)</code></pre>
</details>
</dd>
<dt id="pedwin.EdMainWindow.activate_dhelp"><code class="name flex">
<span>def <span class="ident">activate_dhelp</span></span>(<span>self, action)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def activate_dhelp(self, action):
    self.update_statusbar(&#34;Showing DevHelp&#34;)
    nn2 = notebook.get_current_page()
    vcurr2 = notebook.get_nth_page(nn2)
    if vcurr2:
        pedconfig.conf.keyh.acth.f2(vcurr2.area)</code></pre>
</details>
</dd>
<dt id="pedwin.EdMainWindow.activate_exit"><code class="name flex">
<span>def <span class="ident">activate_exit</span></span>(<span>self, action=None)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def activate_exit(self, action = None):
    #print &#34;activate_exit called&#34;
    OnExit(self.mywin, self)</code></pre>
</details>
</dd>
<dt id="pedwin.EdMainWindow.activate_khelp"><code class="name flex">
<span>def <span class="ident">activate_khelp</span></span>(<span>self, action)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def activate_khelp(self, action):
    self.update_statusbar(&#34;Showing Keyboard Help&#34;)
    nn2 = notebook.get_current_page()
    vcurr2 = notebook.get_nth_page(nn2)
    if vcurr2:
        vcurr2.area.shift = True
        pedconfig.conf.keyh.acth.f2(vcurr2.area)
        vcurr2.area.shift = False</code></pre>
</details>
</dd>
<dt id="pedwin.EdMainWindow.activate_notetab"><code class="name flex">
<span>def <span class="ident">activate_notetab</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def activate_notetab(self):
    ppp = self.notebook2.get_nth_page(self.notebook2.get_n_pages()-3)
    if ppp:
        # This assumes the notetab is the one before the last one
        self.notebook2.set_current_page(self.notebook2.get_n_pages()-3)
        pp = self.notebook2.get_current_page()
        self.notebook2.get_nth_page(pp).treeview2.grab_focus()</code></pre>
</details>
</dd>
<dt id="pedwin.EdMainWindow.activate_qhelp"><code class="name flex">
<span>def <span class="ident">activate_qhelp</span></span>(<span>self, action)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def activate_qhelp(self, action):
    self.update_statusbar(&#34;Showing quick help&#34;)
    rr = get_exec_path(&#34;QHELP&#34;)
    launch_pangview(rr)</code></pre>
</details>
</dd>
<dt id="pedwin.EdMainWindow.activate_quit"><code class="name flex">
<span>def <span class="ident">activate_quit</span></span>(<span>self, action)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def activate_quit(self, action):
    #print &#34;activate_quit called&#34;
    OnExit(self.mywin, self, False)</code></pre>
</details>
</dd>
<dt id="pedwin.EdMainWindow.activate_radio_action"><code class="name flex">
<span>def <span class="ident">activate_radio_action</span></span>(<span>self, action, current)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def activate_radio_action(self, action, current):
    active = current.get_active()
    value = current.get_current_value()

    if active:
        dialog = Gtk.MessageDialog(self, Gtk.DIALOG_DESTROY_WITH_PARENT,
            Gtk.MESSAGE_INFO, Gtk.ButtonsType.CLOSE,
            &#34;You activated radio action: \&#34;%s\&#34; of type \&#34;%s\&#34;.\nCurrent value: %d&#34; %
            (current.get_name(), type(current), value))

        # Close dialog on user response
        dialog.connect(&#34;response&#34;, lambda d, r: d.destroy())
        dialog.show()</code></pre>
</details>
</dd>
<dt id="pedwin.EdMainWindow.activate_webtab"><code class="name flex">
<span>def <span class="ident">activate_webtab</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def activate_webtab(self):
    ppp = self.notebook2.get_nth_page(self.notebook2.get_n_pages()-1)
    if ppp:
        # This assumes the webtab is the last one
        self.notebook2.set_current_page(self.notebook2.get_n_pages()-1)
        pp = self.notebook2.get_current_page()
        self.notebook2.get_nth_page(pp).treeview2.grab_focus()</code></pre>
</details>
</dd>
<dt id="pedwin.EdMainWindow.add_mru"><code class="name flex">
<span>def <span class="ident">add_mru</span></span>(<span>self, mergex, merge_id, action_group)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def add_mru(self, mergex, merge_id, action_group):

    for aa in self.oh.histarr:
        if aa[2]:
            #print(&#34;.oh&#34;, aa)
            fname = aa[2]
            ac = Gtk.Action(fname, fname, fname, None)
            ac.connect(&#39;activate&#39;, self.open_recent)
            action_group.add_action(ac)
            mergex.add_ui(merge_id, &#34;/MenuBar/FileMenu/Recent/Recent Files/&#34;,
                fname, fname, Gtk.UIManagerItemType.MENUITEM, False)

    for aa in self.os.histarr:
        if aa[2]:
            #print(&#34;.os&#34;, aa)
            fname = aa[2]
            ac = Gtk.Action(fname, fname, fname, None)
            ac.connect(&#39;activate&#39;, self.open_recent_sess)
            action_group.add_action(ac)
            mergex.add_ui(merge_id, &#34;/MenuBar/FileMenu/Sessions/Recent Sessions/&#34;,
                fname, fname, Gtk.UIManagerItemType.MENUITEM, False)</code></pre>
</details>
</dd>
<dt id="pedwin.EdMainWindow.altopen"><code class="name flex">
<span>def <span class="ident">altopen</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def altopen(self):
    pare = None
    vcurr = notebook.get_nth_page(notebook.get_current_page())
    if vcurr:
        pare = vcurr.vbox.area
    #print(&#34;pare&#34;, pare)
    fnames = pedofd.ofd(&#34;&#34;, pare)
    #print(&#34;openfile fnames&#34;, fnames)
    for fff in fnames:
        #print(&#34;Opening&#34;&#34;, fff)
        self.openfile(fff)
        pass</code></pre>
</details>
</dd>
<dt id="pedwin.EdMainWindow.area_enter"><code class="name flex">
<span>def <span class="ident">area_enter</span></span>(<span>self, win, act)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def area_enter(self, win, act):
    pass
    #print(  &#34;pedwin area enter&#34;, win, act)</code></pre>
</details>
</dd>
<dt id="pedwin.EdMainWindow.area_event"><code class="name flex">
<span>def <span class="ident">area_event</span></span>(<span>self, win, act)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def area_event(self, win, act):
    pass
    #print(  &#34;pedwin area event&#34;, win, act)</code></pre>
</details>
</dd>
<dt id="pedwin.EdMainWindow.area_focus"><code class="name flex">
<span>def <span class="ident">area_focus</span></span>(<span>self, win, act)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def area_focus(self, win, act):
    pass
    #print(  &#34;pedwin area focus&#34;, win, act)</code></pre>
</details>
</dd>
<dt id="pedwin.EdMainWindow.area_focus_in"><code class="name flex">
<span>def <span class="ident">area_focus_in</span></span>(<span>self, win, act)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def area_focus_in(self, win, act):
    #print(  &#34;area focus in&#34;, win, act)
    # This was needed as pygtk leaves the alt key hanging
    pedconfig.conf.keyh.reset()
    # Focus on main doc
    vcurr = notebook.get_nth_page(notebook.get_current_page())
    if vcurr:
        self.mywin.set_focus(vcurr.vbox.area)

    vcurr2 = notebook2.get_nth_page(notebook2.get_current_page())
    cc = notebook2.get_n_pages()
    for mm in range(cc):
        curr = notebook2.get_nth_page(mm)
        try:
            if curr == vcurr2:
                #print(&#34;sending page focus signal to &#34;, curr)
                curr.focus_in()
                pass
        except:
            pass
    pass</code></pre>
</details>
</dd>
<dt id="pedwin.EdMainWindow.area_focus_out"><code class="name flex">
<span>def <span class="ident">area_focus_out</span></span>(<span>self, win, act)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def area_focus_out(self, win, act):
    #print  (&#34;area focus out&#34;, win, act)
    global savearr
    cc = notebook.get_n_pages()
    for mm in range(cc):
        curr = notebook.get_nth_page(mm)
        #print(&#34;saving tab &#34;, curr)
        try:
            #savearr.append(curr.area.fname)
            #print(&#34;Adding&#34;, curr.area.fname)
            #curr.vbox.area.save()
            #curr.vbox.focus_out()
            pass
        except:
            #print(sys.exc_info())
            pass
    pass</code></pre>
</details>
</dd>
<dt id="pedwin.EdMainWindow.area_key"><code class="name flex">
<span>def <span class="ident">area_key</span></span>(<span>self, area, event)</span>
</code></dt>
<dd>
<div class="desc"><p>Call the document's key handler after some inspection</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def area_key(self, area, event):

    &#39;&#39;&#39; Call the document&#39;s key handler after some inspection &#39;&#39;&#39;

    if pedconfig.conf.pgdebug &gt; 4:
        print(&#34;pedwin key&#34;, event.keyval, event.state)

    if pedconfig.conf.keylog_on:
        if self.klfp:
            if event.type == Gdk.EventType.KEY_PRESS:
                dt2 = datetime.datetime(1990, 1, 1).now()
                strx2 =  dt2.strftime(&#34;%d.%b.%Y %H:%M&#34;)
                fname = &#34;Empty&#34;
                vcurr = notebook.get_nth_page(notebook.get_current_page())
                if vcurr:
                    fname = os.path.basename(vcurr.vbox.area.fname)
                print(strx2, fname,
                            event.keyval, &#34;&#39;&#34; + event.string
                                    + &#34;&#39;&#34;, int(event.state), file=self.klfp)

    if event.keyval ==  Gdk.KEY_F11:
        if event.type == Gdk.EventType.KEY_PRESS:
            if self.full:
                self.mywin.unfullscreen()
                self.full = False
            else:
                self.mywin.fullscreen()
                self.full = True
            return True

    #if event.keyval ==  Gdk.KEY_Alt_L:
    #    if event.type == Gdk.EventType.KEY_RELEASE:
    #        self.altkey = True
    #        #if time.time() - self.alttime &gt; 2:
    #        #    self.show_menu = not self.show_menu
    #        #print(&#34;self.alttime&#34;, time.time() - self.alttime)
    #        self.alttime = 0
    #    else:
    #        #print(&#34;pedwin ALT key down&#34;, event.keyval)
    #        self.altkey = False
    #        if self.alttime == 0:
    #            self.alttime = time.time()

    #if self.show_menu:       x
    #    self.mbar.show()
    #else:
    #    self.mbar.hide()

    # Inspect key press before treeview gets it
    if self.mywin.get_focus() == self.treeview:
        print(&#34;Key for treeview&#34;, event.state)
        # Do key down:
        if  event.type == Gdk.EventType.KEY_PRESS:
            if event.keyval == Gdk.KEY_Alt_L or \
                    event.keyval == Gdk.KEY_Alt_R:
                self.alt = True

        if event.keyval == Gdk.KEY_Tab:
            print (&#34;pedwin TREE TAB&#34;, event.keyval)

        if event.keyval &gt;= Gdk.KEY_1 and event.keyval &lt;= Gdk.KEY_9:
            print (&#34;pedwin Alt num&#34;, event.keyval - Gdk.KEY_1)
            # Focus on main doc
            vcurr = notebook.get_nth_page(notebook.get_current_page())
            self.mywin.set_focus(vcurr.vbox.area)

        elif  event.type == Gdk.EventType.KEY_RELEASE:
            if event.keyval == Gdk.KEY_Alt_L or \
                  event.keyval == Gdk.KEY_Alt_R:
                self.alt = False

    # Sad sad; do system shortcuts
    if event.type == Gdk.EventType.KEY_PRESS:
        # alt
        if event.state &amp; Gdk.ModifierType.MOD1_MASK:
            #print(&#34;alt&#34;, event.keyval)

            if event.keyval &gt;= Gdk.KEY_0 and event.keyval &lt;= Gdk.KEY_9:
                if event.keyval == Gdk.KEY_0:
                    self.notebook.grab_focus()
                    old = self.notebook.get_current_page()
                    print(&#34;Set current&#34;, old)
                    self.notebook.set_current_page(old)
                else:
                    num = event.keyval - Gdk.KEY_1
                    self.notebook.grab_focus()
                    if pedconfig.conf.pgdebug &gt; 5:
                        print( &#34;PedWin Keyhand Alt num&#34;, num)
                    if num &gt;  self.notebook.get_n_pages() - 1:
                        self.update_statusbar(&#34;Invalid tab (page) index.&#34;)
                    else:
                        old = self.notebook.get_current_page()
                        if old == num:
                            self.update_statusbar(&#34;Already at page %d ...&#34; % old)
                        else:
                            self.notebook.set_current_page(num)
                return True

            # These are the menu accel keys; pass it to the system
            #  -- really dislike the accel system; takes over too many things
            # Cannot drive it programmatically -- maybe some help needed
            if event.keyval == ord(&#39;f&#39;) or event.keyval == ord(&#39;e&#39;) \
                or event.keyval == ord(&#39;m&#39;) or \
                    event.keyval == ord(&#39;h&#39;):
                return False

            if event.keyval == ord(&#39;o&#39;) or event.keyval == ord(&#39;O&#39;):
                #print(&#34;mainwin alt-o&#34;)
                self.altopen()
                return True

        # ctrl-shift
        elif event.state &amp; Gdk.ModifierType.CONTROL_MASK and \
                event.state &amp; Gdk.ModifierType.SHIFT_MASK:
            #print(&#34;control shift&#34;, event.keyval)
            if event.keyval == ord(&#39;S&#39;):
                #print(&#34;save as&#34;, event.keyval)
                self.save(True)
                return True

            if event.keyval == ord(&#39;O&#39;):
                #print(&#34;load session&#34;, event.keyval)
                load_sess()
                return True
        # ctrl
        elif event.state &amp; Gdk.ModifierType.CONTROL_MASK:
            if event.keyval == ord(&#39;o&#39;):
                #print(&#34;open&#34;, keyval)
                self.open()
                return True
            if event.keyval == ord(&#39;s&#39;):
                #print(&#34;save&#34;, event.keyval)
                self.save()
                return True
            if event.keyval == ord(&#39;n&#39;):
                self.newfile()
                return True

    # This was needed ad ALT-a and ALT-b ....
    # .... mysteriousely stopped working
    vcurr = notebook.get_nth_page(notebook.get_current_page())
    if vcurr:
        # See which window has focus
        got = self.mywin.get_focus()
        if vcurr.vbox.area == got:
            vcurr.vbox.area.area_key(area, event)
            return True
        elif vcurr.vbox2.area == got:
            vcurr.vbox2.area.area_key(area, event)
            return True
        elif self.diffpane.area == got:
            self.diffpane.area.area_key(area, event)
            return True
        else:
            return None
    else:
        pass
        #print(&#34;did not send key&#34;)  # this is normal
        return None

    return True             # Handled it
    #return None</code></pre>
</details>
</dd>
<dt id="pedwin.EdMainWindow.area_leave"><code class="name flex">
<span>def <span class="ident">area_leave</span></span>(<span>self, win, act)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def area_leave(self, win, act):
    pass
    print(  &#34;pedwin area leave&#34;, win, act)</code></pre>
</details>
</dd>
<dt id="pedwin.EdMainWindow.area_size"><code class="name flex">
<span>def <span class="ident">area_size</span></span>(<span>self, win, rect)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def area_size(self, win, rect):
    #print(  &#34;area size&#34;, rect)
    #self.hpaned2.set_position(self.get_width() - 280)
    pass</code></pre>
</details>
</dd>
<dt id="pedwin.EdMainWindow.area_winstate"><code class="name flex">
<span>def <span class="ident">area_winstate</span></span>(<span>self, arg1, arg2)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def area_winstate(self, arg1, arg2):
    pass
    #print( &#34;area_winstate&#34;, arg1, arg2)
    #print( &#34;state&#34;, self.mywin.get_state())</code></pre>
</details>
</dd>
<dt id="pedwin.EdMainWindow.bleft"><code class="name flex">
<span>def <span class="ident">bleft</span></span>(<span>self, butt)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def bleft(self, butt):
    #print(butt)
    self.prevwin()</code></pre>
</details>
</dd>
<dt id="pedwin.EdMainWindow.bright"><code class="name flex">
<span>def <span class="ident">bright</span></span>(<span>self, butt)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def bright(self, butt):
    #print(butt)
    self.nextwin()</code></pre>
</details>
</dd>
<dt id="pedwin.EdMainWindow.buttA"><code class="name flex">
<span>def <span class="ident">buttA</span></span>(<span>self, arg1, arg2)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def buttA(self, arg1, arg2):
    #print(&#34;buttA&#34;, arg1, arg2)
    self.update_statusbar(&#34;ButtA pressed, num {0:d}&#34;.format(arg2), False)</code></pre>
</details>
</dd>
<dt id="pedwin.EdMainWindow.buttB"><code class="name flex">
<span>def <span class="ident">buttB</span></span>(<span>self, arg1, arg2)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def buttB(self, arg1, arg2):
    #print(&#34;buttB&#34;, arg1, arg2)
    self.update_statusbar(&#34;ButtB pressed, num {0:d}&#34;.format(arg2), False)</code></pre>
</details>
</dd>
<dt id="pedwin.EdMainWindow.close_document"><code class="name flex">
<span>def <span class="ident">close_document</span></span>(<span>self, other=None)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def close_document(self, other = None):
    cc = notebook.get_n_pages()
    if other:
        for aa in range(cc):
            vcurr = notebook.get_nth_page(aa)
            if vcurr.area == other:
                notebook.set_current_page(aa)
                break
    nn = notebook.get_current_page()
    vcurr = notebook.get_nth_page(nn)

    # Disable close
    if vcurr.area.closedoc():
        self.update_statusbar(&#34;Did not close doc: &#39;%s&#39;&#34; %  vcurr.area.fname);
        return

    self.mywin.set_title(&#34;pyedpro: (closed doc)&#34;)

    # Wrap around if closed first
    if nn == 0: mm = cc - 1
    else:       mm = nn - 1

    notebook.set_current_page(mm)
    nn2 = notebook.get_current_page()
    vcurr2 = notebook.get_nth_page(nn2)
    self.mywin.set_focus(vcurr2.vbox.area)
    notebook.remove_page(nn)
    self.mywin.show_all()</code></pre>
</details>
</dd>
<dt id="pedwin.EdMainWindow.closeall"><code class="name flex">
<span>def <span class="ident">closeall</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def closeall(self):
    cc = notebook.get_n_pages()
    for aa in range(cc-1, -1, -1):
        #print (&#34;closing doc index&#34;, aa)
        vcurr = notebook.get_nth_page(aa)
        vcurr.area.closedoc()
        notebook.remove_page(aa)
    self.mywin.set_title(&#34;pyedpro &#34;)</code></pre>
</details>
</dd>
<dt id="pedwin.EdMainWindow.config_event"><code class="name flex">
<span>def <span class="ident">config_event</span></span>(<span>self, win, event)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def config_event(self, win, event):
    pass
    #print( &#34;config_event&#34;, event.x, event.y, &#34;old events&#34;, self.old_x, self.old_y)
    self.old_x = event.x
    self.old_y = event.y</code></pre>
</details>
</dd>
<dt id="pedwin.EdMainWindow.copy"><code class="name flex">
<span>def <span class="ident">copy</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def copy(self):
    nn2 = notebook.get_current_page()
    vcurr2 = notebook.get_nth_page(nn2)
    if vcurr2:
        pedconfig.conf.keyh.acth.ctrl_c(vcurr2.area)</code></pre>
</details>
</dd>
<dt id="pedwin.EdMainWindow.create_tree"><code class="name flex">
<span>def <span class="ident">create_tree</span></span>(<span>self, text=None)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def create_tree(self, text = None):

    global treestore
    self.start_tree()

    # create the TreeView using treestore
    tv = Gtk.TreeView(model=treestore)

    # create a CellRendererText to render the data
    cell = Gtk.CellRendererText()

    # create the TreeViewColumn to display the data
    tvcolumn = Gtk.TreeViewColumn(&#39;Functions&#39;)

    # add the cell to the tvcolumn and allow it to expand
    tvcolumn.pack_start(cell, True)

    # set the cell &#34;text&#34; attribute to column 0 - retrieve text
    # from that column in treestore
    tvcolumn.add_attribute(cell, &#39;text&#39;, 0)

    # add tvcolumn to treeview
    tv.append_column(tvcolumn)

    return tv</code></pre>
</details>
</dd>
<dt id="pedwin.EdMainWindow.create_vartree"><code class="name flex">
<span>def <span class="ident">create_vartree</span></span>(<span>self, text=None)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def create_vartree(self, text = None):

    global treestore2
    self.start_tree2()

    # create the TreeView using treestore
    tv = Gtk.TreeView(model=treestore2)

    # create a CellRendererText to render the data
    cell = Gtk.CellRendererText()

    # create the TreeViewColumn to display the data
    tvcolumn = Gtk.TreeViewColumn(&#39;Local Scope&#39;)

    # add the cell to the tvcolumn and allow it to expand
    tvcolumn.pack_start(cell, True)

    # set the cell &#34;text&#34; attribute to column 0 - retrieve text
    # from that column in treestore
    tvcolumn.add_attribute(cell, &#39;text&#39;, 0)

    # add tvcolumn to treeview
    tv.append_column(tvcolumn)

    return tv</code></pre>
</details>
</dd>
<dt id="pedwin.EdMainWindow.cut"><code class="name flex">
<span>def <span class="ident">cut</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def cut(self):
    nn2 = notebook.get_current_page()
    vcurr2 = notebook.get_nth_page(nn2)
    if vcurr2:
        pedconfig.conf.keyh.acth.ctrl_x(vcurr2.area)</code></pre>
</details>
</dd>
<dt id="pedwin.EdMainWindow.doall"><code class="name flex">
<span>def <span class="ident">doall</span></span>(<span>self, butt)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def doall(self, butt):
    #pedync.message(&#34;\n&#34; + &#34;Under construction&#34; + &#34;\n&#34;)
    ccc =  &#34;cycle.sh&#34;
    self.update_statusbar(&#34;Executing &#34; + ccc)
    comline2 = [&#34;bash&#34;, ccc, ]
    if not os.path.isfile(ccc):
        print(&#34;Cannot execute %s&#34; % str(comline2), &#34;no such file&#34;)
        self.update_statusbar(&#34;Cannot execute: &#39;&#34; + ccc + &#34;&#39; no such file&#34; )
        return
    try:
        ret = subprocess.Popen(comline2, stderr=subprocess.PIPE, stdout=subprocess.PIPE)
    except:
        print(&#34;Cannot execute %s&#34; % str(comline2), sys.exc_info())
        self.update_statusbar(&#34;Cannot execute: &#34; + ccc + &#34; &#34; + str(sys.exc_info()[1]) )
    try:
        outs, errs = ret.communicate()
    except:
        print(&#34;Cannot communicate with %s&#34; % str(comline), sys.exc_info())
        return
    print(outs, errs)</code></pre>
</details>
</dd>
<dt id="pedwin.EdMainWindow.done_open_fc"><code class="name flex">
<span>def <span class="ident">done_open_fc</span></span>(<span>self, win, resp)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def done_open_fc(self, win, resp):
    #print &#34;done_open_fc&#34;, win, resp
    if resp == Gtk.ButtonsType.OK:
        fname = win.get_filename()
        if not fname:
            #print &#34;Must have filename&#34;
            self.update_statusbar(&#34;No filename specified&#34;)
            pass
        elif os.path.isdir(fname):
            self.update_statusbar(&#34;Changed to %s&#34; % fname)
            os.chdir(fname)
            win.set_current_folder(fname)
            return
        else:
            self.openfile(fname)
    win.destroy()</code></pre>
</details>
</dd>
<dt id="pedwin.EdMainWindow.firstwin"><code class="name flex">
<span>def <span class="ident">firstwin</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def  firstwin(self):
    cc = notebook.get_n_pages()
    if cc == 0:
        return
    notebook.set_current_page(0)
    nn2 = notebook.get_current_page()
    vcurr2 = notebook.get_nth_page(nn2)
    self.mywin.set_focus(vcurr2.vbox.area)
    self.mywin.show_all()</code></pre>
</details>
</dd>
<dt id="pedwin.EdMainWindow.focus_out2"><code class="name flex">
<span>def <span class="ident">focus_out2</span></span>(<span>self, book, obj)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def focus_out2(self, book, obj):
    #print(&#34;nb2 focus out&#34;, obj)
    pass</code></pre>
</details>
</dd>
<dt id="pedwin.EdMainWindow.folder_ch"><code class="name flex">
<span>def <span class="ident">folder_ch</span></span>(<span>self, win)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def folder_ch(self, win):
    #print &#34;folder_ch&#34;
    pass
    #return True</code></pre>
</details>
</dd>
<dt id="pedwin.EdMainWindow.get_height"><code class="name flex">
<span>def <span class="ident">get_height</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def get_height(self):
    xx, yy = self.mywin.get_size()
    return yy</code></pre>
</details>
</dd>
<dt id="pedwin.EdMainWindow.get_width"><code class="name flex">
<span>def <span class="ident">get_width</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def get_width(self):
    xx, yy = self.mywin.get_size()
    return xx</code></pre>
</details>
</dd>
<dt id="pedwin.EdMainWindow.label_callb"><code class="name flex">
<span>def <span class="ident">label_callb</span></span>(<span>self, lab, widg, context)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def label_callb(self, lab, widg, context):
    #print(&#34;label_callb&#34;, context)
    pass</code></pre>
</details>
</dd>
<dt id="pedwin.EdMainWindow.lastwin"><code class="name flex">
<span>def <span class="ident">lastwin</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def  lastwin(self):
    cc = notebook.get_n_pages()
    if cc == 0:
        return
    notebook.set_current_page(cc-1)
    nn2 = notebook.get_current_page()
    vcurr2 = notebook.get_nth_page(nn2)
    self.mywin.set_focus(vcurr2.vbox.area)
    self.mywin.show_all()</code></pre>
</details>
</dd>
<dt id="pedwin.EdMainWindow.make_label"><code class="name flex">
<span>def <span class="ident">make_label</span></span>(<span>self, strx)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def make_label(self, strx):
    hbox = Gtk.HBox()
    labx  = Gtk.Label.new_with_mnemonic(strx)
    labx.set_mnemonic_widget(hbox)
    eb = Gtk.EventBox(); eb.add(labx)
    eb.connect_after(&#34;button-press-event&#34;, self.label_callb, strx)
    eb.set_above_child(True)

    hbox.pack_start(eb, 0, 0, 0)
    hbox.show_all()
    return hbox</code></pre>
</details>
</dd>
<dt id="pedwin.EdMainWindow.makefilter"><code class="name flex">
<span>def <span class="ident">makefilter</span></span>(<span>self, mask, name)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def makefilter(self, mask, name):
    filter =  Gtk.FileFilter.new()
    filter.add_pattern(mask)
    filter.set_name(name)
    return filter</code></pre>
</details>
</dd>
<dt id="pedwin.EdMainWindow.menu_click"><code class="name flex">
<span>def <span class="ident">menu_click</span></span>(<span>self, item, arg1, arg2)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def menu_click(self, item, arg1, arg2):
    #print(&#34;menu_click&#34;, item, arg1, arg2)
    if &#34;pen&#34; in arg1:
        self.open()
    if &#34;lose&#34; in arg1:
        self.close_document()
    if &#34;xit&#34; in arg1:
        self.activate_exit()</code></pre>
</details>
</dd>
<dt id="pedwin.EdMainWindow.menu_open"><code class="name flex">
<span>def <span class="ident">menu_open</span></span>(<span>self, arg, arg2)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def menu_open(self, arg, arg2):
    #print(&#34;menu_open&#34;, arg, arg2)
    #self.update_statusbar(&#34;Menu open num {0:d}&#34;.format(arg2))
    pass</code></pre>
</details>
</dd>
<dt id="pedwin.EdMainWindow.mmm"><code class="name flex">
<span>def <span class="ident">mmm</span></span>(<span>self, butt)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def mmm(self, butt):
    self.show_menu = not self.show_menu
    if self.show_menu:
        self.mbar.show()
    else:
        self.mbar.hide()</code></pre>
</details>
</dd>
<dt id="pedwin.EdMainWindow.newfile"><code class="name flex">
<span>def <span class="ident">newfile</span></span>(<span>self, newname='')</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def newfile(self, newname = &#34;&#34;):

    fff = &#34;&#34;

    if newname == &#34;&#34;:
        # Find non existing file
        cnt = self.fcount + 1; fff = &#34;&#34;
        base, ext = os.path.splitext(pedconfig.conf.UNTITLED)
        while True:
            fff =  &#34;%s_%d.txt&#34; % (base, cnt)
            #print( fff)
            if not os.path.isfile(fff):
                break
            cnt += 1

        self.fcount = cnt
    else:
        fff = newname
        # Touch
        try:
            open(fff, &#34;w&#34;).close()
        except:
            sss = &#34;Cannot create file %s&#34; % newname
            self.update_statusbar(sss)
            print(sss,  sys.exc_info())
            pedync.message(&#34;\n&#34; + sss + &#34;\n&#34;)
            return

    # Try and change access/ownership to group write
    try:
        ostat = os.stat(fff)
        os.chmod(fff, ostat.st_mode | stat.S_IWGRP)
    except:
        #print(&#34;Cannot change group write on &#39;%s&#39;&#34; % fff,  sys.exc_info())
        pass

    vpaned = edPane([])
    vpaned.area.fname = os.path.realpath(fff) + &#34;&#34;
    global notebook
    add_page(vpaned)
    vpaned.area.set_tablabel()

    #label = Gtk.Label(&#34; &#34; + os.path.basename(aa) + &#34; &#34;)
    #notebook.set_tab_label(vpaned, label)
    self.mywin.show_all()

    # Make it current
    nn = notebook.get_n_pages()
    if nn:
        vcurr = notebook.set_current_page(nn-1)
        vcurr = notebook.get_nth_page(nn-1)
        self.mywin.set_focus(vcurr.vbox.area)</code></pre>
</details>
</dd>
<dt id="pedwin.EdMainWindow.nextwin"><code class="name flex">
<span>def <span class="ident">nextwin</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def  nextwin(self):
    cc = notebook.get_n_pages()
    nn = notebook.get_current_page()
    vcurr = notebook.get_nth_page(nn)

    # Wrap around if needed
    if nn == cc - 1: mm = 0
    else:       mm = nn + 1
    notebook.set_current_page(mm)
    nn2 = notebook.get_current_page()
    vcurr2 = notebook.get_nth_page(nn2)
    self.mywin.set_focus(vcurr2.vbox.area)
    vcurr2.vbox.area.fire = 1
    #self.mywin.show_all()</code></pre>
</details>
</dd>
<dt id="pedwin.EdMainWindow.note_button"><code class="name flex">
<span>def <span class="ident">note_button</span></span>(<span>self, arg1, arg2)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def note_button(self, arg1, arg2):
    #print(&#34;note_button&#34;, arg1, arg2)
    pass</code></pre>
</details>
</dd>
<dt id="pedwin.EdMainWindow.note_create_cb"><code class="name flex">
<span>def <span class="ident">note_create_cb</span></span>(<span>self, tabx, page, xx, yy)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def note_create_cb(self, tabx, page, xx, yy):
    pass
    #print( &#34;note_create&#34;)</code></pre>
</details>
</dd>
<dt id="pedwin.EdMainWindow.note_enter_notify"><code class="name flex">
<span>def <span class="ident">note_enter_notify</span></span>(<span>self, win)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def note_enter_notify(self, win):
    pass
    #print( &#34;note_enter_notify&#34;, win)</code></pre>
</details>
</dd>
<dt id="pedwin.EdMainWindow.note_focus_cb"><code class="name flex">
<span>def <span class="ident">note_focus_cb</span></span>(<span>self, tabx, foc)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def note_focus_cb(self, tabx, foc):
    #print( &#34;note_focus_cb&#34;)
    vcurr = notebook.get_nth_page(notebook.get_current_page())
    if vcurr:
        self.mywin.set_focus(vcurr.vbox.area)</code></pre>
</details>
</dd>
<dt id="pedwin.EdMainWindow.note_focus_in"><code class="name flex">
<span>def <span class="ident">note_focus_in</span></span>(<span>self, win, act)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def  note_focus_in(self, win, act):
    pass
    #print( &#34;note_focus_in&#34;, win, act)
    vcurr = notebook.get_nth_page(notebook.get_current_page())
    if vcurr:
        self.mywin.set_focus(vcurr.vbox.area)
        vcurr.vbox.area.doidle = 1</code></pre>
</details>
</dd>
<dt id="pedwin.EdMainWindow.note_grab_focus_cb"><code class="name flex">
<span>def <span class="ident">note_grab_focus_cb</span></span>(<span>self, win)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def  note_grab_focus_cb(self, win):
    #print( &#34;note_grab_focus_cb&#34;, win)
    vcurr = notebook.get_nth_page(notebook.get_current_page())
    if vcurr:
        self.mywin.set_focus(vcurr.vbox.area)</code></pre>
</details>
</dd>
<dt id="pedwin.EdMainWindow.note_page_cb"><code class="name flex">
<span>def <span class="ident">note_page_cb</span></span>(<span>self, tabx, child, num)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def  note_page_cb(self, tabx, child, num):
    pass
    #print( &#34;note_page&#34;)</code></pre>
</details>
</dd>
<dt id="pedwin.EdMainWindow.note_swpage_cb"><code class="name flex">
<span>def <span class="ident">note_swpage_cb</span></span>(<span>self, tabx, page, num)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def  note_swpage_cb(self, tabx, page, num):
    #print( &#34;note_swpage&#34;, num)
    vcurr = tabx.get_nth_page(num)
    self.mywin.set_title(&#34;pyedpro: &#34; + vcurr.area.fname)
    self.mywin.set_focus(vcurr.vbox.area)
    hhh = hash_name(vcurr.area.fname)
    fname = os.path.basename(vcurr.area.fname)
    backx = vcurr.area.currback
    self.update_statusbar(&#34;Switched to &#39;{1:s}&#39;   {2:s}_{3:d} &#34;
                                .format(num, fname, hhh, backx ), True)</code></pre>
</details>
</dd>
<dt id="pedwin.EdMainWindow.note_swpage_cb2"><code class="name flex">
<span>def <span class="ident">note_swpage_cb2</span></span>(<span>self, tabx, page, num)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def  note_swpage_cb2(self, tabx, page, num):
    #print (&#34;note_swpage2&#34;, num)
    cc = notebook2.get_n_pages()
    for mm in range(cc):
        curr = notebook2.get_nth_page(mm)
        #print(&#34;sending page change signal to &#34;, curr)
        try:
            curr.switched(page)
        except:
            pass</code></pre>
</details>
</dd>
<dt id="pedwin.EdMainWindow.on_drag_begin"><code class="name flex">
<span>def <span class="ident">on_drag_begin</span></span>(<span>self, widget, context)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def on_drag_begin(self, widget, context):
    global drag_page_number
    drag_page_number = widget.get_current_page()
    print(&#39;drag-begin:&#39;, drag_page_number, widget)</code></pre>
</details>
</dd>
<dt id="pedwin.EdMainWindow.on_drag_data_received"><code class="name flex">
<span>def <span class="ident">on_drag_data_received</span></span>(<span>self, widget, drag_context, x, y, data, info, time)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def on_drag_data_received(self, widget, drag_context, x, y, data, info, time):

    print(&#34;Received drop: %s&#34; % data)

    if info == TARGET_ENTRY_TEXT:
        text = data.get_text()
        print(&#34;Received text: %s&#34; % text)

    elif info == TARGET_ENTRY_PIXBUF:
        pixbuf = data.get_pixbuf()
        width = pixbuf.get_width()
        height = pixbuf.get_height()

        print(&#34;Received pixbuf with width %spx and height %spx&#34; % (width, height))</code></pre>
</details>
</dd>
<dt id="pedwin.EdMainWindow.on_drag_drop"><code class="name flex">
<span>def <span class="ident">on_drag_drop</span></span>(<span>self, widget, context, x, y, time)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def on_drag_drop(self, widget, context, x, y, time):
    #widget.drag_get_data(context, context.list_targets()[-1], time)
    pass
    print (&#34;Dropping&#34;)</code></pre>
</details>
</dd>
<dt id="pedwin.EdMainWindow.on_drag_motion"><code class="name flex">
<span>def <span class="ident">on_drag_motion</span></span>(<span>self, widgt, context, c, y, time)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def on_drag_motion(self, widgt, context, c, y, time):
    #Gdk.drag_status(context, Gdk.DragAction.COPY, time)
    print (&#34;motion&#34;)
    #return True</code></pre>
</details>
</dd>
<dt id="pedwin.EdMainWindow.open"><code class="name flex">
<span>def <span class="ident">open</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def open(self):

    #warnings.simplefilter(&#34;ignore&#34;)
    fc = Gtk.FileChooserDialog(title=&#34;Open file&#34;, transient_for=self.mywin, \
                    action=Gtk.FileChooserAction.OPEN)

    but =   &#34;Cancel&#34;, Gtk.ButtonsType.CANCEL, &#34;Open File&#34;, Gtk.ButtonsType.OK
    fc.add_buttons(*but)
    #warnings.simplefilter(&#34;default&#34;)

    filters = []
    filters.append(self.makefilter(&#34;*.*&#34;, &#34;All files (*.*)&#34;))
    filters.append(self.makefilter(&#34;*.py&#34;, &#34;Python files (*.py)&#34;))
    filters.append(self.makefilter(&#34;*.c&#34;, &#34;&#39;C&#39; source files (*.c)&#34;))
    filters.append(self.makefilter(&#34;*.h&#34;, &#34;&#39;H&#39; source files (*.h)&#34;))
    filters.append(self.makefilter(&#34;*.txt&#34;, &#34;Text files (*.txt)&#34;))
    filters.append(self.makefilter(&#34;*.md&#34;, &#34;Markup files (*.md)&#34;))
    filters.append(self.makefilter(&#34;*.ped&#34;, &#34;PED files (*.ped)&#34;))

    if filters:
        for aa in filters:
            fc.add_filter(aa)

    fc.set_default_response(Gtk.ButtonsType.OK)
    fc.set_current_folder(os.getcwd())
    fc.connect(&#34;response&#34;, self.done_open_fc)
    fc.connect(&#34;current-folder-changed&#34;, self.folder_ch )

    #fc.set_current_name(self.fname)
    fc.run()</code></pre>
</details>
</dd>
<dt id="pedwin.EdMainWindow.open_recent"><code class="name flex">
<span>def <span class="ident">open_recent</span></span>(<span>self, action)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def open_recent(self, action):
    if pedconfig.conf.pgdebug &gt; 0:
        print(&#34;open recent&#34;, action)

    #warnings.simplefilter(&#34;ignore&#34;)
    strx = action.get_name()
    #print(strx)
    #warnings.simplefilter(&#34;default&#34;)
    self.openfile(strx);</code></pre>
</details>
</dd>
<dt id="pedwin.EdMainWindow.open_recent_sess"><code class="name flex">
<span>def <span class="ident">open_recent_sess</span></span>(<span>self, action)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def open_recent_sess(self, action):
    if pedconfig.conf.pgdebug &gt; 0:
        print(&#34;open recent sess&#34;, action)
    #warnings.simplefilter(&#34;ignore&#34;)
    strx = action.get_name()
    #print(strx)
    #warnings.simplefilter(&#34;default&#34;)
    self.opensess(strx);</code></pre>
</details>
</dd>
<dt id="pedwin.EdMainWindow.openfile"><code class="name flex">
<span>def <span class="ident">openfile</span></span>(<span>self, fnamex)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def openfile(self, fnamex):

    # Empty line from sess load
    if not fnamex:
        #print(&#34;Empty file name passed&#34;)
        return

    # Any indication it is there?
    if not os.path.isfile(fnamex):
        print(&#34;Cannot open file:&#34;, &#34;&#39;&#34; + fnamex + &#34;&#39;&#34;)
        self.update_statusbar(&#34;Cannot open file &#39;{0:s}&#39;&#34;.format(fnamex))
        return

    # Is it already loaded? ... activate
    nn = notebook.get_n_pages()
    fname2 = os.path.realpath(fnamex)
    for aa in range(nn):
        vcurr = notebook.get_nth_page(aa)
        if vcurr.area.fname == fname2:
            if pedconfig.conf.verbose:
                print(&#34;Already open &#39;&#34;+ fname2 + &#34;&#39;&#34;)
            self.update_statusbar(&#34;Already open, activating &#39;{0:s}&#39;&#34;.format(fname2))
            vcurr = notebook.set_current_page(aa)
            vcurr = notebook.get_nth_page(aa)
            self.mywin.set_focus(vcurr.vbox.area)
            return

    if pedconfig.conf.verbose:
        print(&#34;Opening &#39;&#34;+ fname2 + &#34;&#39;&#34;)

    self.update_statusbar(&#34;Opening file &#39;{0:s}&#39;&#34;.format(fname2), True)
    vpaned = edPane()
    ret = vpaned.area.loadfile(fname2)
    if not ret:
        self.update_statusbar(&#34;Cannot read file &#39;{0:s}&#39;&#34;.format(fname2))
        return
    vpaned.area2.loadfile(fname2)
    self.update_statusbar(&#34;Opened file &#39;{0:s}&#39;&#34;.format(fname2))

    #self.oh.add(fname2) # added at lower level now

    # Add to the list of buffers
    add_page(vpaned)
    vpaned.area.set_tablabel()
    self.mywin.show_all()
    # Make it current
    nn = notebook.get_n_pages()
    if nn:
        vcurr = notebook.set_current_page(nn-1)
        vcurr = notebook.get_nth_page(nn-1)
        self.mywin.set_focus(vcurr.vbox.area)

    usleep(10)
    return vcurr.vbox.area</code></pre>
</details>
</dd>
<dt id="pedwin.EdMainWindow.openmenu"><code class="name flex">
<span>def <span class="ident">openmenu</span></span>(<span>self, strx)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def openmenu(self, strx):

    # Thu 27.Oct.2022 Deactivated TODO
    return

    #for bb in self.accel:
    #for aa in self.acg.list_actions():
    #    #print(&#34;action&#34;, aa.get_name())
    #    sss = aa.get_name().split(&#34; &#34;)
    #    #print(&#34;action&#34;, sss)
    #    if strx in sss[0]:
    #        ttt = &#34;/ui/&#34; + sss[0]
    #        # Gtk.Action
    #        print(&#34;file action:&#34;, aa, aa.get_name(), aa.get_accel_path(), ttt)
    #        #print(aa, dir(aa))
    #        #print(self.acg, dir(self.acg))
    #        #aa.set_sensitive(True)
    #        aa.set_sensitive(True)
    #        aa.set_visible(True)
    #        aa.activate()
    #        break

    # MenuItem
    mb = self.mbar.get_children()
    for aa in mb:
        #print(&#34;menu&#34;, aa, aa.get_label())
        if strx in aa.get_label():
            # Gtk.ImageMenuItem
            print(&#34;opening menu&#34;, aa, aa.get_label(), aa.get_accel_path())
            #print(self.acg, dir(self.acg))
            aa.select()
            #aa.activate()
            #aa.grab_focus()
            #aa.show_all()
            #print(&#34;has&#34;, self.acg.has_action(aa.get_accel_path()))
            #self.acg.activate_action(aa.get_accel_path())
            break
    pass</code></pre>
</details>
</dd>
<dt id="pedwin.EdMainWindow.opensess"><code class="name flex">
<span>def <span class="ident">opensess</span></span>(<span>self, strx)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def opensess(self, strx):
    #print(&#34;opensess&#34;, strx)

    pedlog.log(&#34;Opening session&#34;, strx, time.ctime(None))
    pedconfig.conf.pedwin.sess = os.path.basename(strx)
    self.sess_label.set_text(pedconfig.conf.pedwin.sess)

    sesslist = []
    fh = open(strx, &#34;rb&#34;)
    try:
        sesslist = pickle.load(fh)
    except:
        print(&#34;Cannot load sess list&#34;, sys.exc_info())
        fh.close()
        return
    fh.close()
    for fff in str.split(sesslist, &#34;\n&#34;):
        #print (&#34;Session opening file:&#34;, &#34;&#39;&#34; + fff + &#34;&#39;&#34;)
        pedconfig.conf.pedwin.openfile(fff)
        usleep(10)</code></pre>
</details>
</dd>
<dt id="pedwin.EdMainWindow.paste"><code class="name flex">
<span>def <span class="ident">paste</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def paste(self):
    nn2 = notebook.get_current_page()
    vcurr2 = notebook.get_nth_page(nn2)
    if vcurr2:
        pedconfig.conf.keyh.acth.ctrl_v(vcurr2.area)</code></pre>
</details>
</dd>
<dt id="pedwin.EdMainWindow.prevwin"><code class="name flex">
<span>def <span class="ident">prevwin</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def  prevwin(self):
    cc = notebook.get_n_pages()
    nn = notebook.get_current_page()
    vcurr = notebook.get_nth_page(nn)

    # Wrap around if needed
    if nn == 0: mm = cc - 1
    else:       mm = nn - 1
    notebook.set_current_page(mm)
    nn2 = notebook.get_current_page()
    vcurr2 = notebook.get_nth_page(nn2)
    self.mywin.set_focus(vcurr2.vbox.area)
    #self.mywin.show_all()</code></pre>
</details>
</dd>
<dt id="pedwin.EdMainWindow.rcl"><code class="name flex">
<span>def <span class="ident">rcl</span></span>(<span>self, butt, arg1, arg2)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def rcl(self, butt, arg1, arg2):
    #print(&#34;rcl label&#34;, but.get_label(), butt.ord, butt.id)
    head = pedconfig.conf.sql.get(&#34;mac%d%d&#34; % (butt.ord, butt.id))
    value = pedconfig.conf.sql.get(&#34;val%d%d&#34; % (butt.ord, butt.id))
    if not value:
        self.update_statusbar(&#34;No data on button action &#39;%d.%d&#39;&#34; % (butt.ord, butt.id))
        return
    nn2 = notebook.get_current_page()
    vcurr2 = notebook.get_nth_page(nn2)
    if not vcurr2:
        self.update_statusbar(&#34;Cannot paste from button action &#39;%s&#39;&#34; % head)
        return

    # Patch in variables
    dt = datetime.datetime(1990, 1, 1);
    dt2 = dt.now()
    strx2 =  dt2.strftime(&#34;%a %d.%b.%Y&#34;)
    value = value.replace(&#34;%DATE%&#34;, strx2)

    strx3 =  dt2.strftime(&#34;%H:%M:%S&#34;)
    value = value.replace(&#34;%TIME%&#34;, strx3)
    value = value.replace(&#34;%FILE%&#34;, os.path.basename(vcurr2.area.fname))

    value = value.replace(&#34;%PROJECT%&#34;, self.sess)

    disp = Gdk.Display().get_default()
    clip = Gtk.Clipboard.get_default(disp)
    clip.set_text(value, len(value))
    pedconfig.conf.keyh.acth.ctrl_v(vcurr2.area)
    self.mywin.set_focus(vcurr2.vbox.area)
    self.update_statusbar(&#34;Pasted from button action &#39;%s&#39;&#34; % head)</code></pre>
</details>
</dd>
<dt id="pedwin.EdMainWindow.rcl2"><code class="name flex">
<span>def <span class="ident">rcl2</span></span>(<span>self, butt, arg1, arg2)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def rcl2(self, butt, arg1, arg2):
    #print(&#34;rcl2 label&#34;, &#34;&#39;&#34; + arg1.get_label() + &#34;&#39;&#34;, arg1.ord, arg1.id)
    menu = MenuButt((&#34;Action&#34;, &#34;Configure&#34;, &#34;Face&#34;), self.submenu_click)
    menu.area_rbutton(arg1, arg2)
    menu.ord = arg1.ord; menu.id = arg1.id</code></pre>
</details>
</dd>
<dt id="pedwin.EdMainWindow.save"><code class="name flex">
<span>def <span class="ident">save</span></span>(<span>self, flag=False)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def save(self, flag = False):
    vcurr = notebook.get_nth_page(notebook.get_current_page())
    if flag:
        vcurr.area.saveas()
        #self.mywin.set_title(&#34;pyedpro: &#34; + vcurr.area.fname)
    else:
        vcurr.area.save()</code></pre>
</details>
</dd>
<dt id="pedwin.EdMainWindow.saveall"><code class="name flex">
<span>def <span class="ident">saveall</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def saveall(self):
    #print &#34;saveall&#34;
    # Save all files
    nn = notebook.get_n_pages(); cnt = 0; cnt2 = 0
    while True:
        if cnt &gt;= nn: break
        ppp = notebook.get_nth_page(cnt)
        if ppp.area.changed:
            ppp.area.writeout()
            cnt2 += 1
        cnt += 1
    self.update_statusbar(&#34;%d of %d buffers saved.&#34; % (cnt2, nn))</code></pre>
</details>
</dd>
<dt id="pedwin.EdMainWindow.start_term"><code class="name flex">
<span>def <span class="ident">start_term</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def start_term(self):
    #print(&#34;Terminal Here&#34;)
    exename = &#34;&#34;
    try:
        if platform.system().find(&#34;Win&#34;) &gt;= 0:
            ret = subprocess.Popen([&#34;putty&#34;])
            #if not ret.returncode:
            #    raise OSError
            #print(&#34;No terminal on windows. (TODO)&#34;)
        else:
            ret = None
            # The order represents the priority of opening
            termstr = (&#34;xfce4-terminal&#34;, &#34;gnome-terminal&#34;, &#34;lxterminal&#34;, &#34;xterm&#34;,)
            for exename in termstr:
                # Stumble until terminal found
                try:
                    ret = subprocess.Popen([exename],)
                    if not ret.returncode:
                        break
                except:
                    pass

            if ret.returncode:
                raise OSError
    except:
        print(&#34;Cannot launch terminal&#34;, sys.exc_info())
        pedync.message(&#34;\n   Cannot launch terminal executable \n\n&#34;
                   &#34;              (Please install)&#34;)
    finally:
        self.update_statusbar(&#34;Started terminal &#39;%s&#39;&#34; % exename)</code></pre>
</details>
</dd>
<dt id="pedwin.EdMainWindow.start_tree"><code class="name flex">
<span>def <span class="ident">start_tree</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def start_tree(self):

    global treestore
    if not treestore:
        treestore = Gtk.TreeStore(str)</code></pre>
</details>
</dd>
<dt id="pedwin.EdMainWindow.start_tree2"><code class="name flex">
<span>def <span class="ident">start_tree2</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def start_tree2(self):

    global treestore2
    if not treestore2:
        treestore2 = Gtk.TreeStore(str)

    # Delete previous contents
    try:
        while True:
            root = treestore.get_iter_first()
            if not root:
                break
            try:
                treestore.remove(root)
            except:
                print(&#34;Exception on rm treestore&#34;)
    except:
        print(&#34;strt_tree&#34;, sys.exc_info())
        pass

    piter = treestore.append(None, [&#34;Extracting ..&#34;])
    treestore.append(piter, [&#34;None ..&#34;])</code></pre>
</details>
</dd>
<dt id="pedwin.EdMainWindow.status_hist"><code class="name flex">
<span>def <span class="ident">status_hist</span></span>(<span>self, arg1, arg2)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def status_hist(self, arg1, arg2):
    print(&#34;hist pressed&#34;)
    pass</code></pre>
</details>
</dd>
<dt id="pedwin.EdMainWindow.status_lang"><code class="name flex">
<span>def <span class="ident">status_lang</span></span>(<span>self, atg1, arf2)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def status_lang(self, atg1, arf2):
    print(&#34;Lang pressed&#34;)</code></pre>
</details>
</dd>
<dt id="pedwin.EdMainWindow.submenu_click"><code class="name flex">
<span>def <span class="ident">submenu_click</span></span>(<span>self, menu, arg1, arg2)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def submenu_click(self, menu, arg1, arg2):
    #print(&#34;submenu_click&#34;, menu.ord, menu.id, arg1, arg2)
    #pedconfig.conf.sql.put(&#34;xx&#34;, xx)
    if arg2 == 0:
        # Call the action -- note menu contains button coordinates
        self.rcl(menu, arg1, arg2)

    if arg2 == 1:
        #print(&#34;submenu_click config&#34;, menu.ord, menu.id, arg1, arg2)
        head = pedconfig.conf.sql.get(&#34;mac%d%d&#34; % (menu.ord, menu.id))
        if not head:
            abarr = &#34;AAB&#34;
            head = &#34;Func %s%d&#34; % (abarr[menu.ord], menu.id)
        clip = pedconfig.conf.sql.get(&#34;val%d%d&#34; % (menu.ord, menu.id))
        if not clip:
            clip = &#34;None&#34;

        filled = peddlg.config_dlg(&#34;Edit Macro Entry&#34;, head, clip)
        if filled[0]:
            pedconfig.conf.sql.put(&#34;mac%d%d&#34; % (menu.ord, menu.id), filled[0])
            pedconfig.conf.sql.put(&#34;val%d%d&#34; % (menu.ord, menu.id), filled[1])
            # Also fill in header
            for aa in self.buttarr:
                if aa.ord == menu.ord and aa.id == menu.id:
                    aa.set_label(filled[0])</code></pre>
</details>
</dd>
<dt id="pedwin.EdMainWindow.threadevent"><code class="name flex">
<span>def <span class="ident">threadevent</span></span>(<span>self, win, event)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def threadevent(self, win, event):
    pass
    #if pedconfig.conf.verbose:
    #    print(&#34;Thread Event&#34;, win, event)</code></pre>
</details>
</dd>
<dt id="pedwin.EdMainWindow.tree_sel"><code class="name flex">
<span>def <span class="ident">tree_sel</span></span>(<span>self, xtree, xiter, xpath)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def tree_sel(self, xtree, xiter, xpath):
    #print(&#34;tree_sel&#34;, xtree, xiter, xpath)
    # Focus on main doc
    sel = xtree.get_selection()
    xmodel, xiter = sel.get_selected()
    if xiter:
        xstr = xmodel.get_value(xiter, 0)
        vcurr = notebook.get_nth_page(notebook.get_current_page())
        vcurr.area.locate(xstr)
        # Focus on main doc
        vcurr = notebook.get_nth_page(notebook.get_current_page())
        self.mywin.set_focus(vcurr.vbox.area)</code></pre>
</details>
</dd>
<dt id="pedwin.EdMainWindow.tree_sel2"><code class="name flex">
<span>def <span class="ident">tree_sel2</span></span>(<span>self, xtree, xiter, xpath)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def tree_sel2(self, xtree, xiter, xpath):
    #print(&#34;tree_sel2&#34;, xtree, xiter, xpath)
    # Focus on main doc
    sel = xtree.get_selection()
    xmodel, xiter = sel.get_selected()
    if xiter:
        xstr = xmodel.get_value(xiter, 0)
        vcurr = notebook.get_nth_page(notebook.get_current_page())
        vcurr.area.locate(xstr)
        # Focus on main doc
        vcurr = notebook.get_nth_page(notebook.get_current_page())
        self.mywin.set_focus(vcurr.vbox.area)</code></pre>
</details>
</dd>
<dt id="pedwin.EdMainWindow.tree_sel_row"><code class="name flex">
<span>def <span class="ident">tree_sel_row</span></span>(<span>self, xtree)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def tree_sel_row(self, xtree):
    #print(&#34;tree_sel_row&#34;, xtree)
    pass
    #sel = xtree.get_selection()
    #xmodel, xiter = sel.get_selected()
    #if xiter:
    #    xstr = xmodel.get_value(xiter, 0)
    #    vcurr = notebook.get_nth_page(notebook.get_current_page())
    #    vcurr.area.locate(xstr)</code></pre>
</details>
</dd>
<dt id="pedwin.EdMainWindow.tree_sel_row2"><code class="name flex">
<span>def <span class="ident">tree_sel_row2</span></span>(<span>self, xtree)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def tree_sel_row2(self, xtree):
    pass
    #sel = xtree.get_selection()
    #xmodel, xiter = sel.get_selected()
    #print(&#34;tree_sel_row2&#34;, xtree, xmodel, xiter)
    #if xiter:
    #    xstr = xmodel.get_value(xiter, 0)
    #    vcurr = notebook.get_nth_page(notebook.get_current_page())
    #    vcurr.area.locate(xstr)</code></pre>
</details>
</dd>
<dt id="pedwin.EdMainWindow.tts"><code class="name flex">
<span>def <span class="ident">tts</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def tts(self):
    nn2 = notebook.get_current_page()
    vcurr2 = notebook.get_nth_page(nn2)
    if vcurr2:
         pedconfig.conf.keyh.acth.ctrl_alt_r(vcurr2.area)</code></pre>
</details>
</dd>
<dt id="pedwin.EdMainWindow.ttt"><code class="name flex">
<span>def <span class="ident">ttt</span></span>(<span>self, butt)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def ttt(self, butt):
    self.show_tbar = not self.show_tbar
    if self.show_tbar:
        self.tbar.show()
    else:
        self.tbar.hide()</code></pre>
</details>
</dd>
<dt id="pedwin.EdMainWindow.unmap"><code class="name flex">
<span>def <span class="ident">unmap</span></span>(<span>self, arg1, arg2)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def unmap(self, arg1, arg2):
    #print( &#34;unmap&#34;, arg1, arg2)
    pass</code></pre>
</details>
</dd>
<dt id="pedwin.EdMainWindow.update_resize_grip"><code class="name flex">
<span>def <span class="ident">update_resize_grip</span></span>(<span>self, widget, event)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def update_resize_grip(self, widget, event):
    #print &#34;update state&#34;, event, event.changed_mask
    #self.mywin.set_focus(notebook)

    mask = Gdk.WindowState.MAXIMIZED
    # | Gdk.FULLSCREEN

    &#39;&#39;&#39;if (event.changed_mask &amp; mask):
        self.statusbar.set_has_resize_grip(not (event.new_window_state &amp; mask))
    &#39;&#39;&#39;</code></pre>
</details>
</dd>
<dt id="pedwin.EdMainWindow.update_statusbar"><code class="name flex">
<span>def <span class="ident">update_statusbar</span></span>(<span>self, strx, nolog=False)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def update_statusbar(self, strx, nolog = False):
    # Clear any previous message, underflow is allowed
    #self.statusbar.pop(0)
    if not strx:
        self.update_statusbar(&#34;Idle&#34;, True)
        return

    #self.statusbar.push(0, strx)
    self.statuscount = STATUSCOUNT
    self.slab.set_text(strx)
    if not nolog:
        pedlog.log(strx)</code></pre>
</details>
</dd>
<dt id="pedwin.EdMainWindow.update_statusbar2"><code class="name flex">
<span>def <span class="ident">update_statusbar2</span></span>(<span>self, xx=0, yy=0, ins=0, tlen=0, clip=0, caps=0, scr=0, colsel=0)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def update_statusbar2(self, xx = 0, yy = 0, ins=0, tlen=0, clip=0, caps=0, scr=0, colsel=0):
    # Always update line / col
    if ins: str2 = &#34;INS&#34;
    else: str2 =&#34;OVR&#34;

    # Always update CAPS
    if caps: str3 = &#34;CAP&#34;
    else: str3 =&#34;cap&#34;

    if scr: str4 = &#34;SCR&#34;
    else: str4 =&#34;scr&#34;

    if colsel: str5 = &#34;COL&#34;
    else: str5 =&#34;ROW&#34;

    strx2 = &#34;  Ln {0:d} Col {1:d} Tot {3:d}  {2:s} {5:s} {6:s} Clip: {4:d} {7:s}  &#34;.\
                            format(int(yy+1), int(xx+1), str2, tlen, clip, str3, str4, str5)

    #self.statusbar2.pop(0)
    #self.statusbar2.push(0, strx2)
    self.slab2.set_text(strx2)</code></pre>
</details>
</dd>
<dt id="pedwin.EdMainWindow.update_treestore"><code class="name flex">
<span>def <span class="ident">update_treestore</span></span>(<span>self, text)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def update_treestore(self, text):

    global treestore, treeview
    if not treestore: return

    # Remember old position
    #Gtk.TreeViewColumn Gtk.TreeView Gtk.TreeStore
    old_sel = None
    try:
        path = treeview.get_path_at_pos(0, 0)
        #print(&#34;path&#34;, path)
        xiter = treestore.get_iter(path[0])
        #print(&#34;xiter&#34;, xiter)
        if xiter:
            old_sel = treestore.get_value(xiter, 0)

    except:
        #print(&#34;update_tree old pos&#34;, sys.exc_info())
        pass

    # Delete previous contents
    try:
        while True:
            root = treestore.get_iter_first()
            if not root:
                break
            try:
                treestore.remove(root)
            except:
                print(&#34;except: treestore remove&#34;)
    except:
        print(&#34;update_tree&#34;, sys.exc_info())
        pass

    if not text:
        return
    try:
        for line in text:
            piter = treestore.append(None, [cut_lead_space(line)])
        # Back to old line
        treeview.scroll_to_cell(path[0], None, False, 0, 0)
    except:
        #print(&#34;Exception in append treestore&#34;, sys.exc_info())
        pass</code></pre>
</details>
</dd>
<dt id="pedwin.EdMainWindow.update_treestore2"><code class="name flex">
<span>def <span class="ident">update_treestore2</span></span>(<span>self, text)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def update_treestore2(self, text):

    global treestore2

    if not treestore2: return
    # Delete previous contents
    try:
        while True:
            root = treestore2.get_iter_first()
            if not root:
                break
            try:
                treestore2.remove(root)
            except:
                print(&#34;except: treestore remove&#34;)
    except:
        print(&#34;update_tree2&#34;, sys.exc_info())

    if not text:
        return

    try:
        for line in text:
            piter = treestore2.append(None, [cut_lead_space(line)])
    except:
        pass
        #print(&#34;Exception in append treestore2&#34;, sys.exc_info())</code></pre>
</details>
</dd>
<dt id="pedwin.EdMainWindow.xupdate_treestore"><code class="name flex">
<span>def <span class="ident">xupdate_treestore</span></span>(<span>self, text)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def xupdate_treestore(self, text):
    pass</code></pre>
</details>
</dd>
</dl>
</dd>
<dt id="pedwin.edPane"><code class="flex name class">
<span>class <span class="ident">edPane</span></span>
<span>(</span><span>buff=[], focus=False)</span>
</code></dt>
<dd>
<div class="desc"><p>Create document</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class edPane(Gtk.VPaned):

    &#39;&#39;&#39;  Create document &#39;&#39;&#39;

    def __init__(self, buff = [], focus = False):

        pos = pedconfig.conf.sql.get_int(&#34;vpaned&#34;)
        if pos == 0: pos = 50

        Gtk.VPaned.__init__(self)
        self.set_border_width(3)
        self.set_position(pos)
        self.vbox = edwin(buff)
        self.add2(self.vbox)
        self.vbox2 = edwin(buff, True)
        self.add1(self.vbox2)

        self.set_size_request(100, 100)

        # Shortcuts to access the editor windows
        self.area  = self.vbox.area
        self.area2 = self.vbox2.area
        self.area2.second = True</code></pre>
</details>
<h3>Ancestors</h3>
<ul class="hlist">
<li>gi.repository.Gtk.VPaned</li>
<li>gi.overrides.Gtk.Paned</li>
<li>gi.repository.Gtk.Paned</li>
<li>gi.overrides.Gtk.Container</li>
<li>gi.repository.Gtk.Container</li>
<li>gi.overrides.Gtk.Widget</li>
<li>gi.repository.Gtk.Widget</li>
<li>gi.repository.GObject.InitiallyUnowned</li>
<li>gi.overrides.GObject.Object</li>
<li>gi.repository.GObject.Object</li>
<li>gi._gi.GObject</li>
<li>gi.repository.Atk.ImplementorIface</li>
<li>gi.repository.Gtk.Buildable</li>
<li>gi.repository.Gtk.Orientable</li>
<li>gobject.GInterface</li>
</ul>
</dd>
<dt id="pedwin.edwin"><code class="flex name class">
<span>class <span class="ident">edwin</span></span>
<span>(</span><span>buff, readonly=False, second=False)</span>
</code></dt>
<dd>
<div class="desc"><p>Create main document widget with scroll bars </p>
<p>Initializer for a GObject based classes with support for property
sets through the use of explicit keyword arguments.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class edwin(Gtk.VBox):

    &#39;&#39;&#39; Create main document widget with scroll bars &#39;&#39;&#39;

    def __init__(self, buff, readonly = False, second = False):

        global notebook, notebook3, mained

        Gtk.VBox.__init__(self)

        # Make it acessable:
        self.area  = peddoc.pedDoc(buff, mained, readonly)
        #print( &#34;created&#34;, self.area, mained)

        # Give access to notebook and main editor window
        self.area.notebook = notebook
        self.area.notebook3 = notebook3

        #self.area.mained = mained
        self.area.fname = &#34;&#34;

        frame = Gtk.Frame(); frame.add(self.area)
        hbox = Gtk.HBox()
        hbox.pack_start(frame, True, True, 0)
        hbox.pack_end(self.area.vscroll, False, False, 0)

        self.pack_start(hbox, True, True, 0)
        self.pack_end(self.area.hscroll, False, False, 0)</code></pre>
</details>
<h3>Ancestors</h3>
<ul class="hlist">
<li>gi.repository.Gtk.VBox</li>
<li>gi.overrides.Gtk.Box</li>
<li>gi.repository.Gtk.Box</li>
<li>gi.overrides.Gtk.Container</li>
<li>gi.repository.Gtk.Container</li>
<li>gi.overrides.Gtk.Widget</li>
<li>gi.repository.Gtk.Widget</li>
<li>gi.repository.GObject.InitiallyUnowned</li>
<li>gi.overrides.GObject.Object</li>
<li>gi.repository.GObject.Object</li>
<li>gi._gi.GObject</li>
<li>gi.repository.Atk.ImplementorIface</li>
<li>gi.repository.Gtk.Buildable</li>
<li>gi.repository.Gtk.Orientable</li>
<li>gobject.GInterface</li>
</ul>
</dd>
<dt id="pedwin.itemhistory"><code class="flex name class">
<span>class <span class="ident">itemhistory</span></span>
<span>(</span><span>fname)</span>
</code></dt>
<dd>
<div class="desc"><p>FIFO for freq strings</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class itemhistory():

    &#39;&#39;&#39; FIFO for freq strings &#39;&#39;&#39;

    def __init__(self, fname):

        self.fname = fname
        self.histarr = []

        try:
            fh = open(self.fname, &#34;rb&#34;)
            try:
                self.histarr = pickle.load(fh)
            except:
                #print(&#34;Cannot open history file.&#34;, sys.exc_info())
                pass
            fh.close()
        except:
            #print(&#34;Cannot load history data&#34;, sys.exc_info())
            pass

        self.histarr.sort(reverse=True)
        #self.dump()

    def add(self, fname):
        #global openhist
        got = False
        for aa in self.histarr:
            if aa[2] == fname:
                aa[1] += 1
                aa[0] = time.time()
                got = True

        if not got:
          self.histarr.append([time.time(), 1, fname]);

        self.histarr.sort(reverse=True)
        if len(self.histarr) &gt; 12:
            self.histarr = self.histarr[:-2]

    def gettops(self):
        pass

    def dump(self):
        for aa in self.histarr:
            print(aa)

    def save(self):
        try:
            fh = open(self.fname, &#34;wb&#34;)
            pickle.dump(self.histarr, fh)
            fh.close()
        except:
            #print(&#34;Cannot save history file&#34;, sys.exc_info())
            #pedutil.put_exception(&#34;history&#34;)
            pass

        #print(&#34;Saved&#34;, openhist)</code></pre>
</details>
<h3>Methods</h3>
<dl>
<dt id="pedwin.itemhistory.add"><code class="name flex">
<span>def <span class="ident">add</span></span>(<span>self, fname)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def add(self, fname):
    #global openhist
    got = False
    for aa in self.histarr:
        if aa[2] == fname:
            aa[1] += 1
            aa[0] = time.time()
            got = True

    if not got:
      self.histarr.append([time.time(), 1, fname]);

    self.histarr.sort(reverse=True)
    if len(self.histarr) &gt; 12:
        self.histarr = self.histarr[:-2]</code></pre>
</details>
</dd>
<dt id="pedwin.itemhistory.dump"><code class="name flex">
<span>def <span class="ident">dump</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def dump(self):
    for aa in self.histarr:
        print(aa)</code></pre>
</details>
</dd>
<dt id="pedwin.itemhistory.gettops"><code class="name flex">
<span>def <span class="ident">gettops</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def gettops(self):
    pass</code></pre>
</details>
</dd>
<dt id="pedwin.itemhistory.save"><code class="name flex">
<span>def <span class="ident">save</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def save(self):
    try:
        fh = open(self.fname, &#34;wb&#34;)
        pickle.dump(self.histarr, fh)
        fh.close()
    except:
        #print(&#34;Cannot save history file&#34;, sys.exc_info())
        #pedutil.put_exception(&#34;history&#34;)
        pass

    #print(&#34;Saved&#34;, openhist)</code></pre>
</details>
</dd>
</dl>
</dd>
</dl>
</section>
</article>
<nav id="sidebar">
<h1>Index</h1>
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3><a href="#header-functions">Functions</a></h3>
<ul class="">
<li><code><a title="pedwin.OnExit" href="#pedwin.OnExit">OnExit</a></code></li>
<li><code><a title="pedwin.add_page" href="#pedwin.add_page">add_page</a></code></li>
<li><code><a title="pedwin.handler_tick" href="#pedwin.handler_tick">handler_tick</a></code></li>
<li><code><a title="pedwin.initial_load" href="#pedwin.initial_load">initial_load</a></code></li>
</ul>
</li>
<li><h3><a href="#header-classes">Classes</a></h3>
<ul>
<li>
<h4><code><a title="pedwin.EdMainWindow" href="#pedwin.EdMainWindow">EdMainWindow</a></code></h4>
<ul class="">
<li><code><a title="pedwin.EdMainWindow.ThredCallback" href="#pedwin.EdMainWindow.ThredCallback">ThredCallback</a></code></li>
<li><code><a title="pedwin.EdMainWindow.ThredMine" href="#pedwin.EdMainWindow.ThredMine">ThredMine</a></code></li>
<li><code><a title="pedwin.EdMainWindow.activate_about" href="#pedwin.EdMainWindow.activate_about">activate_about</a></code></li>
<li><code><a title="pedwin.EdMainWindow.activate_action" href="#pedwin.EdMainWindow.activate_action">activate_action</a></code></li>
<li><code><a title="pedwin.EdMainWindow.activate_caltab" href="#pedwin.EdMainWindow.activate_caltab">activate_caltab</a></code></li>
<li><code><a title="pedwin.EdMainWindow.activate_dhelp" href="#pedwin.EdMainWindow.activate_dhelp">activate_dhelp</a></code></li>
<li><code><a title="pedwin.EdMainWindow.activate_exit" href="#pedwin.EdMainWindow.activate_exit">activate_exit</a></code></li>
<li><code><a title="pedwin.EdMainWindow.activate_khelp" href="#pedwin.EdMainWindow.activate_khelp">activate_khelp</a></code></li>
<li><code><a title="pedwin.EdMainWindow.activate_notetab" href="#pedwin.EdMainWindow.activate_notetab">activate_notetab</a></code></li>
<li><code><a title="pedwin.EdMainWindow.activate_qhelp" href="#pedwin.EdMainWindow.activate_qhelp">activate_qhelp</a></code></li>
<li><code><a title="pedwin.EdMainWindow.activate_quit" href="#pedwin.EdMainWindow.activate_quit">activate_quit</a></code></li>
<li><code><a title="pedwin.EdMainWindow.activate_radio_action" href="#pedwin.EdMainWindow.activate_radio_action">activate_radio_action</a></code></li>
<li><code><a title="pedwin.EdMainWindow.activate_webtab" href="#pedwin.EdMainWindow.activate_webtab">activate_webtab</a></code></li>
<li><code><a title="pedwin.EdMainWindow.add_mru" href="#pedwin.EdMainWindow.add_mru">add_mru</a></code></li>
<li><code><a title="pedwin.EdMainWindow.altopen" href="#pedwin.EdMainWindow.altopen">altopen</a></code></li>
<li><code><a title="pedwin.EdMainWindow.area_enter" href="#pedwin.EdMainWindow.area_enter">area_enter</a></code></li>
<li><code><a title="pedwin.EdMainWindow.area_event" href="#pedwin.EdMainWindow.area_event">area_event</a></code></li>
<li><code><a title="pedwin.EdMainWindow.area_focus" href="#pedwin.EdMainWindow.area_focus">area_focus</a></code></li>
<li><code><a title="pedwin.EdMainWindow.area_focus_in" href="#pedwin.EdMainWindow.area_focus_in">area_focus_in</a></code></li>
<li><code><a title="pedwin.EdMainWindow.area_focus_out" href="#pedwin.EdMainWindow.area_focus_out">area_focus_out</a></code></li>
<li><code><a title="pedwin.EdMainWindow.area_key" href="#pedwin.EdMainWindow.area_key">area_key</a></code></li>
<li><code><a title="pedwin.EdMainWindow.area_leave" href="#pedwin.EdMainWindow.area_leave">area_leave</a></code></li>
<li><code><a title="pedwin.EdMainWindow.area_size" href="#pedwin.EdMainWindow.area_size">area_size</a></code></li>
<li><code><a title="pedwin.EdMainWindow.area_winstate" href="#pedwin.EdMainWindow.area_winstate">area_winstate</a></code></li>
<li><code><a title="pedwin.EdMainWindow.bleft" href="#pedwin.EdMainWindow.bleft">bleft</a></code></li>
<li><code><a title="pedwin.EdMainWindow.bright" href="#pedwin.EdMainWindow.bright">bright</a></code></li>
<li><code><a title="pedwin.EdMainWindow.buttA" href="#pedwin.EdMainWindow.buttA">buttA</a></code></li>
<li><code><a title="pedwin.EdMainWindow.buttB" href="#pedwin.EdMainWindow.buttB">buttB</a></code></li>
<li><code><a title="pedwin.EdMainWindow.close_document" href="#pedwin.EdMainWindow.close_document">close_document</a></code></li>
<li><code><a title="pedwin.EdMainWindow.closeall" href="#pedwin.EdMainWindow.closeall">closeall</a></code></li>
<li><code><a title="pedwin.EdMainWindow.config_event" href="#pedwin.EdMainWindow.config_event">config_event</a></code></li>
<li><code><a title="pedwin.EdMainWindow.copy" href="#pedwin.EdMainWindow.copy">copy</a></code></li>
<li><code><a title="pedwin.EdMainWindow.create_tree" href="#pedwin.EdMainWindow.create_tree">create_tree</a></code></li>
<li><code><a title="pedwin.EdMainWindow.create_vartree" href="#pedwin.EdMainWindow.create_vartree">create_vartree</a></code></li>
<li><code><a title="pedwin.EdMainWindow.cut" href="#pedwin.EdMainWindow.cut">cut</a></code></li>
<li><code><a title="pedwin.EdMainWindow.doall" href="#pedwin.EdMainWindow.doall">doall</a></code></li>
<li><code><a title="pedwin.EdMainWindow.done_open_fc" href="#pedwin.EdMainWindow.done_open_fc">done_open_fc</a></code></li>
<li><code><a title="pedwin.EdMainWindow.firstwin" href="#pedwin.EdMainWindow.firstwin">firstwin</a></code></li>
<li><code><a title="pedwin.EdMainWindow.focus_out2" href="#pedwin.EdMainWindow.focus_out2">focus_out2</a></code></li>
<li><code><a title="pedwin.EdMainWindow.folder_ch" href="#pedwin.EdMainWindow.folder_ch">folder_ch</a></code></li>
<li><code><a title="pedwin.EdMainWindow.get_height" href="#pedwin.EdMainWindow.get_height">get_height</a></code></li>
<li><code><a title="pedwin.EdMainWindow.get_width" href="#pedwin.EdMainWindow.get_width">get_width</a></code></li>
<li><code><a title="pedwin.EdMainWindow.label_callb" href="#pedwin.EdMainWindow.label_callb">label_callb</a></code></li>
<li><code><a title="pedwin.EdMainWindow.lastwin" href="#pedwin.EdMainWindow.lastwin">lastwin</a></code></li>
<li><code><a title="pedwin.EdMainWindow.make_label" href="#pedwin.EdMainWindow.make_label">make_label</a></code></li>
<li><code><a title="pedwin.EdMainWindow.makefilter" href="#pedwin.EdMainWindow.makefilter">makefilter</a></code></li>
<li><code><a title="pedwin.EdMainWindow.menu_click" href="#pedwin.EdMainWindow.menu_click">menu_click</a></code></li>
<li><code><a title="pedwin.EdMainWindow.menu_open" href="#pedwin.EdMainWindow.menu_open">menu_open</a></code></li>
<li><code><a title="pedwin.EdMainWindow.mmm" href="#pedwin.EdMainWindow.mmm">mmm</a></code></li>
<li><code><a title="pedwin.EdMainWindow.newfile" href="#pedwin.EdMainWindow.newfile">newfile</a></code></li>
<li><code><a title="pedwin.EdMainWindow.nextwin" href="#pedwin.EdMainWindow.nextwin">nextwin</a></code></li>
<li><code><a title="pedwin.EdMainWindow.note_button" href="#pedwin.EdMainWindow.note_button">note_button</a></code></li>
<li><code><a title="pedwin.EdMainWindow.note_create_cb" href="#pedwin.EdMainWindow.note_create_cb">note_create_cb</a></code></li>
<li><code><a title="pedwin.EdMainWindow.note_enter_notify" href="#pedwin.EdMainWindow.note_enter_notify">note_enter_notify</a></code></li>
<li><code><a title="pedwin.EdMainWindow.note_focus_cb" href="#pedwin.EdMainWindow.note_focus_cb">note_focus_cb</a></code></li>
<li><code><a title="pedwin.EdMainWindow.note_focus_in" href="#pedwin.EdMainWindow.note_focus_in">note_focus_in</a></code></li>
<li><code><a title="pedwin.EdMainWindow.note_grab_focus_cb" href="#pedwin.EdMainWindow.note_grab_focus_cb">note_grab_focus_cb</a></code></li>
<li><code><a title="pedwin.EdMainWindow.note_page_cb" href="#pedwin.EdMainWindow.note_page_cb">note_page_cb</a></code></li>
<li><code><a title="pedwin.EdMainWindow.note_swpage_cb" href="#pedwin.EdMainWindow.note_swpage_cb">note_swpage_cb</a></code></li>
<li><code><a title="pedwin.EdMainWindow.note_swpage_cb2" href="#pedwin.EdMainWindow.note_swpage_cb2">note_swpage_cb2</a></code></li>
<li><code><a title="pedwin.EdMainWindow.on_drag_begin" href="#pedwin.EdMainWindow.on_drag_begin">on_drag_begin</a></code></li>
<li><code><a title="pedwin.EdMainWindow.on_drag_data_received" href="#pedwin.EdMainWindow.on_drag_data_received">on_drag_data_received</a></code></li>
<li><code><a title="pedwin.EdMainWindow.on_drag_drop" href="#pedwin.EdMainWindow.on_drag_drop">on_drag_drop</a></code></li>
<li><code><a title="pedwin.EdMainWindow.on_drag_motion" href="#pedwin.EdMainWindow.on_drag_motion">on_drag_motion</a></code></li>
<li><code><a title="pedwin.EdMainWindow.open" href="#pedwin.EdMainWindow.open">open</a></code></li>
<li><code><a title="pedwin.EdMainWindow.open_recent" href="#pedwin.EdMainWindow.open_recent">open_recent</a></code></li>
<li><code><a title="pedwin.EdMainWindow.open_recent_sess" href="#pedwin.EdMainWindow.open_recent_sess">open_recent_sess</a></code></li>
<li><code><a title="pedwin.EdMainWindow.openfile" href="#pedwin.EdMainWindow.openfile">openfile</a></code></li>
<li><code><a title="pedwin.EdMainWindow.openmenu" href="#pedwin.EdMainWindow.openmenu">openmenu</a></code></li>
<li><code><a title="pedwin.EdMainWindow.opensess" href="#pedwin.EdMainWindow.opensess">opensess</a></code></li>
<li><code><a title="pedwin.EdMainWindow.paste" href="#pedwin.EdMainWindow.paste">paste</a></code></li>
<li><code><a title="pedwin.EdMainWindow.prevwin" href="#pedwin.EdMainWindow.prevwin">prevwin</a></code></li>
<li><code><a title="pedwin.EdMainWindow.rcl" href="#pedwin.EdMainWindow.rcl">rcl</a></code></li>
<li><code><a title="pedwin.EdMainWindow.rcl2" href="#pedwin.EdMainWindow.rcl2">rcl2</a></code></li>
<li><code><a title="pedwin.EdMainWindow.save" href="#pedwin.EdMainWindow.save">save</a></code></li>
<li><code><a title="pedwin.EdMainWindow.saveall" href="#pedwin.EdMainWindow.saveall">saveall</a></code></li>
<li><code><a title="pedwin.EdMainWindow.start_term" href="#pedwin.EdMainWindow.start_term">start_term</a></code></li>
<li><code><a title="pedwin.EdMainWindow.start_tree" href="#pedwin.EdMainWindow.start_tree">start_tree</a></code></li>
<li><code><a title="pedwin.EdMainWindow.start_tree2" href="#pedwin.EdMainWindow.start_tree2">start_tree2</a></code></li>
<li><code><a title="pedwin.EdMainWindow.status_hist" href="#pedwin.EdMainWindow.status_hist">status_hist</a></code></li>
<li><code><a title="pedwin.EdMainWindow.status_lang" href="#pedwin.EdMainWindow.status_lang">status_lang</a></code></li>
<li><code><a title="pedwin.EdMainWindow.submenu_click" href="#pedwin.EdMainWindow.submenu_click">submenu_click</a></code></li>
<li><code><a title="pedwin.EdMainWindow.threadevent" href="#pedwin.EdMainWindow.threadevent">threadevent</a></code></li>
<li><code><a title="pedwin.EdMainWindow.tree_sel" href="#pedwin.EdMainWindow.tree_sel">tree_sel</a></code></li>
<li><code><a title="pedwin.EdMainWindow.tree_sel2" href="#pedwin.EdMainWindow.tree_sel2">tree_sel2</a></code></li>
<li><code><a title="pedwin.EdMainWindow.tree_sel_row" href="#pedwin.EdMainWindow.tree_sel_row">tree_sel_row</a></code></li>
<li><code><a title="pedwin.EdMainWindow.tree_sel_row2" href="#pedwin.EdMainWindow.tree_sel_row2">tree_sel_row2</a></code></li>
<li><code><a title="pedwin.EdMainWindow.tts" href="#pedwin.EdMainWindow.tts">tts</a></code></li>
<li><code><a title="pedwin.EdMainWindow.ttt" href="#pedwin.EdMainWindow.ttt">ttt</a></code></li>
<li><code><a title="pedwin.EdMainWindow.unmap" href="#pedwin.EdMainWindow.unmap">unmap</a></code></li>
<li><code><a title="pedwin.EdMainWindow.update_resize_grip" href="#pedwin.EdMainWindow.update_resize_grip">update_resize_grip</a></code></li>
<li><code><a title="pedwin.EdMainWindow.update_statusbar" href="#pedwin.EdMainWindow.update_statusbar">update_statusbar</a></code></li>
<li><code><a title="pedwin.EdMainWindow.update_statusbar2" href="#pedwin.EdMainWindow.update_statusbar2">update_statusbar2</a></code></li>
<li><code><a title="pedwin.EdMainWindow.update_treestore" href="#pedwin.EdMainWindow.update_treestore">update_treestore</a></code></li>
<li><code><a title="pedwin.EdMainWindow.update_treestore2" href="#pedwin.EdMainWindow.update_treestore2">update_treestore2</a></code></li>
<li><code><a title="pedwin.EdMainWindow.xupdate_treestore" href="#pedwin.EdMainWindow.xupdate_treestore">xupdate_treestore</a></code></li>
</ul>
</li>
<li>
<h4><code><a title="pedwin.edPane" href="#pedwin.edPane">edPane</a></code></h4>
</li>
<li>
<h4><code><a title="pedwin.edwin" href="#pedwin.edwin">edwin</a></code></h4>
</li>
<li>
<h4><code><a title="pedwin.itemhistory" href="#pedwin.itemhistory">itemhistory</a></code></h4>
<ul class="">
<li><code><a title="pedwin.itemhistory.add" href="#pedwin.itemhistory.add">add</a></code></li>
<li><code><a title="pedwin.itemhistory.dump" href="#pedwin.itemhistory.dump">dump</a></code></li>
<li><code><a title="pedwin.itemhistory.gettops" href="#pedwin.itemhistory.gettops">gettops</a></code></li>
<li><code><a title="pedwin.itemhistory.save" href="#pedwin.itemhistory.save">save</a></code></li>
</ul>
</li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc" title="pdoc: Python API documentation generator"><cite>pdoc</cite> 0.10.0</a>.</p>
</footer>
</body>
</html>