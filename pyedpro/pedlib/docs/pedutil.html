<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.10.0" />
<title>pedutil API documentation</title>
<meta name="description" content="" />
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/sanitize.min.css" integrity="sha256-PK9q560IAAa6WVRRh76LtCaI8pjTJ2z11v0miyNNjrs=" crossorigin>
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/typography.min.css" integrity="sha256-7l/o7C8jubJiy74VsKTidCy1yBkRtiUGbVkYBylBqUg=" crossorigin>
<link rel="stylesheet preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/github.min.css" crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em .5em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js" integrity="sha256-Uv3H6lx7dJmRfRvH8TH6kJD1TSK1aFcwgx+mdg3epi8=" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => hljs.initHighlighting())</script>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>pedutil</code></h1>
</header>
<section id="section-intro">
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">#!/usr/bin/env python

from __future__ import absolute_import
from __future__ import print_function

import os
import sys
import time
import string
import pickle
import random
import stat
import traceback
import subprocess
import warnings

#mained = None

if sys.version_info.major &lt; 3:
    pass
else:
    import inspect
    if inspect.isbuiltin(time.process_time):
        time.clock = time.process_time

import gi
gi.require_version(&#34;Gtk&#34;, &#34;3.0&#34;)
from gi.repository import Gtk
from gi.repository import Gdk
from gi.repository import GObject
from gi.repository import Pango
gi.require_version(&#39;PangoCairo&#39;, &#39;1.0&#39;)
from gi.repository import PangoCairo

from pedlib import pedconfig
from pedlib import pedync

(TARGET_ENTRY_TEXT, TARGET_ENTRY_PIXBUF) = range(2)
(COLUMN_TEXT, COLUMN_PIXBUF) = range(2)

# Cut leading space in half

def cut_lead_space(xstr, divi = 2):
    res = &#34;&#34;; cnt = 0; idx = 0; spcnt = 0
    xlen = len(xstr)
    while True:
        if cnt &gt;= xlen: break
        chh = xstr[idx]
        if chh == &#34; &#34;:
            spcnt += 1
            if spcnt &gt;= divi:
                spcnt = 0; res += &#34; &#34;
        else:
            res += xstr[idx:]
            break
        idx += 1
    return res

# ------------------------------------------------------------------------
# Let the higher level deal with errors.

def  readfile(strx, sep = None):

    text = []

    if strx == &#34;&#34;:
        return text

    # Now read and parse
    f = open(strx, &#34;rb&#34;);  buff2 = f.read();  f.close()
    if sys.version_info.major &lt; 3:
        buff = buff2
    else:
        try:
            buff = buff2.decode(&#39;UTF-8&#39;)
        except UnicodeDecodeError:
            buff = buff2.decode(&#39;cp437&#39;)

    buff2 = &#34;&#34;

    if not sep:
        # Deteremine separator, use a partial length search
        if buff.find(&#34;\r\n&#34;, 0, 300) &gt;= 0:
            sep = &#34;\r\n&#34;
        elif buff.find(&#34;\n\r&#34;, 0, 300) &gt;= 0:
            sep = &#34;\n\r&#34;
        elif buff.find(&#34;\r&#34;, 0, 300) &gt;= 0:
            sep = &#34;\r&#34;
        else:
            sep = &#34;\n&#34;

    text2 = str.split(buff, sep)

    #if &#34;Makefile&#34; in strx:
    #    print(strx, &#34;sep: &#39;&#34;+ sep + &#34;&#39;&#34;, ord(sep[0]), ord(sep[1]))

    # Clean out spuriously occurring \r and \n
    # Example: ST Microelectronics Makefiles

    text = []
    for aa in text2:
        #print(&#34;&#39;%s\n&#34; % aa)
        bb = aa.replace(&#34;\r&#34;, &#34;&#34;)
        cc = bb.replace(&#34;\n&#34;, &#34;&#34;)
        text.append(cc)
    #text2 = []

    return text

# ------------------------------------------------------------------------
# Return an array of lines found

def findinfile(nnn, ffff, nocase = False):

    rrr = []
    try:
        text = readfile(ffff)

        # See if text file
        cnt = 0
        try:
            line = text[0] + text[1]
            for ccc in line:
                chh = ord(ccc)
                if chh &lt; 32 or chh &gt; 127:
                    #print(&#34;bin&#34;, ccc, ord(ccc) )
                    cnt += 1
        except:
            #print(&#34;except in search&#34;,  sys.exc_info())
            pass

        if cnt &gt; 3:
            #print (&#34;Not a text file:&#34;, ffff)
            return rrr
    except:
        print(&#34;Cannot read file&#34;, ffff)
        text = &#34;&#34;

    unnn = nnn.lower()
    for aa in text:
        if nocase:
            if unnn in aa.lower():
                rrr.append(aa)
        else:
            if nnn in aa:
                rrr.append(aa)

    return rrr

# ------------------------------------------------------------------------
# Propagate exceptions to higher level

def  writefile(strx, buff, sep = &#34;\n&#34;, mode = &#34;w&#34;):
    #print (&#34;writefile&#34;, strx, sep)
    ret = True, &#34;&#34;
    if strx != &#34;&#34;:
        try:
            fp = open(strx, mode)
            cnt = 0; sepx = &#34;&#34;
            for aa in buff:
                if cnt:
                    sepx = sep
                fp.write(sepx + aa.rstrip())
                cnt += 1
            fp.close()
        except:
            ret = False, sys.exc_info()[1]
            try:
                fp.close()
            except:
                pass
            pass
    return ret

# Expand image name to image path:

def get_img_path(fname):

    img_dir = os.path.dirname(__file__)
    img_path = os.path.join(img_dir, &#34;images/&#34;, fname)
    #if pedconfig.conf.verbose:
    #    print( &#34;img_path&#34;, img_path)
    return img_path

# Expand file name to file path in the exec dir:
# We now deliver module data directory

def get_exec_path(fname):

    #exec_dir = os.path.dirname(pedconfig.conf.mydir)
    exec_dir = os.path.dirname(__file__)
    exec_path2 = os.path.join(exec_dir, &#34;data&#34;)
    exec_path = os.path.join(exec_path2, fname)

    if pedconfig.conf.verbose:
        print( exec_path)

    return exec_path

def get_pangview_path():

    fname = &#34;pangview.py&#34;
    exec_dir = os.path.dirname(__file__)
    pname = exec_dir + os.sep + &#34;..&#34; +  os.sep + fname
    if not os.path.isfile(pname):
        pname = fname

    if pedconfig.conf.verbose:
        print(&#34;Pangview path&#34;, pname)

    return pname

# ------------------------------------------------------------------------

def launch_pangview(docx):

    ret = 0
    pname = get_pangview_path()

    if pname == &#34;pangview.py&#34;:
        # we are running in pip
        arr =  [&#39;pangview&#39;,  docx]
    else:
        arr = [&#34;python&#34;, pname,  docx]

    if pedconfig.conf.verbose:
        print(&#34;Launching pangview:&#34;, arr) # pname, &#34;with&#34;, docx)
    try:
        ret = subprocess.Popen(arr)
    except:
        print(&#34;except on pang&#34;,  sys.exc_info())
        pedync.message(&#34;\n   Cannot launch the pangview.py utility.   \n\n&#34;
                       &#34;              (Please install)\n&#34;)
    return ret

# It&#39;s totally optional to do this, you could just manually insert icons
# and have them not be themeable, especially if you never expect people
# to theme your app.

def register_stock_icons():
    &#39;&#39;&#39; This function registers our custom toolbar icons, so they
        can be themed.
    &#39;&#39;&#39;
    items = [(&#39;demo-gtk-logo&#39;, &#39;_GTK!&#39;, 0, 0, &#39;&#39;)]
    # Register our stock items
    #Gtk.stock_add(items)

    # Add our custom icon factory to the list of defaults
    factory = Gtk.IconFactory()
    factory.add_default()

    img_dir = os.path.join(os.path.dirname(__file__), &#39;images&#39;)
    img_path = os.path.join(img_dir, &#39;gtk-logo-rgb.gif&#39;)

    #print( img_path)
    try:
        #pixbuf = Gdk.pixbuf_new_from_file(img_path)
        # Register icon to accompany stock item

        # The gtk-logo-rgb icon has a white background, make it transparent
        # the call is wrapped to (gboolean, guchar, guchar, guchar)
        #transparent = pixbuf.add_alpha(True, chr(255), chr(255),chr(255))
        #icon_set = Gtk.IconSet(transparent)
        #factory.add(&#39;demo-gtk-logo&#39;, icon_set)
        pass
    except GObject.GError as error:
        #print( &#39;failed to load GTK logo ... trying local&#39;)
        try:
            #img_path = os.path.join(img_dir, &#39;gtk-logo-rgb.gif&#39;)
            xbuf = Gdk.pixbuf_new_from_file(&#39;gtk-logo-rgb.gif&#39;)
            #Register icon to accompany stock item
            #The gtk-logo-rgb icon has a white background, make it transparent
            #the call is wrapped to (gboolean, guchar, guchar, guchar)
            transparent = xbuf.add_alpha(True, chr(255), chr(255),chr(255))
            icon_set = Gtk.IconSet(transparent)
            factory.add(&#39;demo-gtk-logo&#39;, icon_set)

        except GObject.GError as error:
            print(&#39;failed to load GTK logo for toolbar&#39;)


# ------------------------------------------------------------------------
# Utility functions for action handlers

def genstr(strx, num):
    ret = &#34;&#34;
    while num:
        ret += strx; num -= 1
    return ret

def cntleadchar(strx, chh):
    xlen = len(strx); pos = 0; ret = &#34;&#34;
    if xlen == 0: return ret
    while pos &lt; xlen:
        if strx[pos] != chh:
            break
        ret += chh
        pos = pos + 1
    return ret

# Find next char
def nextchar(strx, xchar, start):
    idx = start; end =  len(strx) - 1
    while True:
        if idx &gt; end: break
        chh = strx[idx]
        if chh == xchar: break
        idx += 1
    return idx

# Find next not char
def xnextchar( strx, xchar, start):
    idx = start; end =  len(strx) - 1
    while True:
        if idx &gt; end: break
        chh = strx[idx]
        if chh != xchar:
            break
        idx += 1
    return idx

# Find next not in str
def xnextchar2( strx, xchar, start):
    idx = start; end =  len(strx) - 1
    while True:
        if idx &gt; end: break
        chh = strx[idx]
        if xchar.find(chh) == -1:
            break
        idx += 1
    return idx

# Find prev char
def prevchar( strx, xchar, start):
    idx = start
    idx = min(len(strx) - 1, idx)
    while True:
        if idx &lt; 0: break
        chh = strx[idx]
        if chh == xchar: break
        idx -= 1
    return idx

# Find prev not char
def xprevchar( strx, xchar, start):
    idx = start
    idx = min(len(strx) - 1, idx)
    while True:
        if idx &lt; 0: break
        chh = strx[idx]
        if chh != xchar:
            break
        idx -= 1
    return idx

def shortenstr(xstr, xlen):
    ret = &#34;&#34;; zlen = len(xstr)
    if zlen &gt; xlen:
        if xlen &lt; 5: raise ValueError
        xlen -= 5
        ret = xstr[:xlen // 2] + &#34;...&#34; + xstr[zlen - xlen // 2:]
    else:
        ret = xstr

    return ret

def handle_keys(host, event):

    ret = 0

    # Do key down:
    if  event.type == Gdk.KEY_PRESS:
        if event.keyval == Gdk.KEY_Alt_L or \
                event.keyval == Gdk.KEY_Alt_R:
            #print( &#34;Alt down&#34;)
            host.alt = True
        elif event.keyval == Gdk.KEY_Control_L or \
                event.keyval == Gdk.KEY_Control_R:
            #print( &#34;Ctrl down&#34;)
            host.ctrl = True; ret = True
        if event.keyval == Gdk.KEY_Shift_L or \
              event.keyval == Gdk.KEY_Shift_R:
            #print( &#34;shift down&#34;)
            host.shift = True

    # Do key up
    elif  event.type == Gdk.KEY_RELEASE:
        if event.keyval == Gdk.KEY_Alt_L or \
              event.keyval == Gdk.KEY_Alt_R:
            #print( &#34;Alt up&#34;)
            host.alt = False
        if event.keyval == Gdk.KEY_Control_L or \
              event.keyval == Gdk.KEY_Control_R:
            #print( &#34;Ctrl up&#34;)
            host.ctrl = False
        if event.keyval == Gdk.KEY_Shift_L or \
              event.keyval == Gdk.KEY_Shift_R:
            #print( &#34;shift up&#34;)
            host.shift = False

    return ret

# -----------------------------------------------------------------------
# Sleep just a little, but allow the system to breed

def  usleep(msec):

    if sys.version_info[0] &lt; 3 or \
        (sys.version_info[0] == 3 and sys.version_info[1] &lt; 3):
        timefunc = time.clock
    else:
        timefunc = time.process_time

    got_clock = timefunc() + float(msec) / 1000
    #print( got_clock)
    while True:
        if timefunc() &gt; got_clock:
            break
        #print (&#34;Sleeping&#34;)
        Gtk.main_iteration_do(False)

# -----------------------------------------------------------------------
# Create a one way hash of a name. Not cryptographically secure,
# but it can make a good unique name in hex.

def hash_name(strx):

    lenx = len(strx);  hashx = int(0)
    for aa in strx:
        bb = ord(aa)
        hashx +=  int((bb &lt;&lt; 12) + bb)
        hashx &amp;= 0xffffffff
        hashx = int(hashx &lt;&lt; 8) + int(hashx &gt;&gt; 8)
        hashx &amp;= 0xffffffff

    return &#34;%x&#34; % hashx

# Expand tabs in string
def untab_str(strx, tabstop = 4):
    res = &#34;&#34;; idx = 0; cnt = 0
    xlen = len(strx)
    while True:
        if idx &gt;= xlen: break
        chh = strx[idx]
        if  chh == &#34;\t&#34;:
            # Generate string
            spaces = tabstop - (cnt % tabstop)
            ttt = &#34;&#34;
            for aa in range(spaces):
                ttt += &#34; &#34;
            res += ttt
            cnt += spaces
        else:
            cnt += 1
            res += chh
        idx += 1
    return res

# Calculate tabs up to till count
def calc_tabs(strx, till, tabstop = 4):
    idx = 0; cnt = 0
    xlen = min(len(strx), till)
    while True:
        if idx &gt;= xlen: break
        chh = strx[idx]
        if  chh == &#34;\t&#34;:
            cnt += tabstop - (cnt % tabstop)
        else:
            cnt += 1
        idx += 1
    return cnt

# Calculate tabs up to till count, include full length
def calc_tabs2(strx, till, tabstop = 4):
    idx = 0; cnt = 0; slen = len(strx)
    xlen = min(slen, till)
    while True:
        if idx &gt;= xlen: break
        chh = strx[idx]
        if  chh == &#34;\t&#34;:
            cnt += tabstop - (cnt % tabstop)
        else:
            cnt += 1
        idx += 1

    # Pad full lengh
    if till &gt; slen:
        cnt += till - slen
    return cnt

# -----------------------------------------------------------------------
# Untangle str pos from screen pos
# ----------oooooo--------
#                 ^
# ----------\t

def decalc_tabs(strx, pos, tabstop = 4):

    idx = cnt = 0; slen = len(strx)
    while True:
        if idx &gt;= slen: break
        chh = strx[idx]
        if  chh == &#34;\t&#34;:
            cnt += tabstop - (cnt % tabstop)
        else:
            cnt += 1
        if cnt &gt;= pos: break
        idx += 1

    return idx

# Remove up to num leading spaces
def rmlspace(strx, num):
    idx = 0;    xlen = len(strx)
    while True:
        if idx &gt;= xlen:  break
        if strx[idx] != &#34; &#34;: break
        if idx &gt;= num: break
        idx += 1
    return strx[idx:]

# ------------------------------------------------------------------------
# Select word - Return tuple of begin and end index

def  selword(strx, xidx):

    #print( &#34;selword:&#34;, strx, xidx)

    xlen = len(strx)
    if xlen == 0: return 0, 0
    if xidx &gt;= xlen: return xlen, xlen

    if strx[xidx] == &#34; &#34;:
        return xidx, xidx

    cnte = xidx; cntb = xidx

    # Find space to end
    while True:
        if cnte &gt;= xlen: break
        if strx[cnte] == &#34; &#34; or strx[cnte] == &#34;\t&#34;:
            break
        cnte += 1
    # Find space to begin
    while True:
        if cntb &lt; 0:
            cntb += 1
            break
        if strx[cntb] == &#34; &#34; or strx[cntb] == &#34;\t&#34;:
            cntb += 1               # Already on space, back off
            break
        cntb -= 1

    return cntb, cnte

# ------------------------------------------------------------------------
# Select an ascii word - Return tuple of begin and end index

def  selasci(strx, xidx, additional = None):

    #print( &#34;selasci:&#34;, &#34;&#39;&#34; + strx + &#34;&#39;&#34;, xidx)

    xlen = len(strx)
    if xlen == 0: return 0, 0
    if xidx &gt;= xlen: return xlen, xlen
    if strx[xidx] == &#34; &#34;:
        return xidx, xidx

    cnte = xidx; cntb = xidx

    # Find space to end
    while True:
        if cnte &gt;= xlen:    break
        if not strx[cnte].isalnum():
            break
        cnte += 1
    # Find space to begin
    while True:
        if cntb &lt; 0:
            cntb += 1
            break
        if not strx[cntb].isalnum():
            cntb += 1
            break
        cntb -= 1

    #print( cntb, cnte)
    #print(  &#34;&#39;&#34; + strx[cntb:cnte] + &#34;&#39;&#34;)

    return cntb, cnte

# ------------------------------------------------------------------------
# Select an ascii word - Return tuple of begin and end index
# You may specify additional characters to see as part of the word

def  selasci2(strx, xidx, addi = &#34;&#34;):

    #print( &#34;selasci2:&#34;, &#34;&#39;&#34; + strx + &#34;&#39;&#34;, xidx)

    xlen = len(strx)
    if xlen == 0: return 0, 0
    if xidx &gt;= xlen: return xlen, xlen
    if strx[xidx] == &#34; &#34;:
        if xidx:
            xidx -= 1
        if strx[xidx-1] == &#34; &#34;:
            return xidx, xidx

    cnte = xidx; cntb = xidx

    # Find space to end
    while True:
        if cnte &gt;= xlen:  break
        if not strx[cnte].isalnum() and addi.find(strx[cnte]) &lt; 0:
            break
        cnte += 1
    # Find space to begin
    while True:
        #print( cntb,)
        if cntb &lt; 0:
            cntb += 1
            break

        if not strx[cntb].isalnum() and addi.find(strx[cntb]) &lt; 0:
            cntb += 1
            break
        cntb -= 1

    #print( cntb, cnte)
    #print(  &#34;&#39;&#34; + strx[cntb:cnte] + &#34;&#39;&#34;)

    return cntb, cnte

# ------------------------------------------------------------------------
# Convert tabs into apprporiate spaces:

&#39;&#39;&#39;def untab(strx):

    xlen = len(strx); cnt = 0; ret = &#34;&#34;

    while True:
        if cnt &gt;= xlen: break
        chh = strx[cnt]
        if chh == &#34;\t&#34;:
            ret += &#34;    &#34;
        else:
            ret += chh
        cnt += 1

    return ret&#39;&#39;&#39;

# Search one line, return array

def src_line(line, cnt, srctxt, regex, boolcase, boolregex):

    idx = 0; idx2 = 0
    mlen = len(srctxt)
    accum = []

    while True:
        if boolcase:
            idx = line.lower().find(srctxt.lower(), idx)
            idx2 = idx
        elif boolregex:
            line2 = line[idx:]
            #print( &#34;line2&#34;, line2)
            if line2 == &#34;&#34;:
                idx = -1
                break
            res = regex.search(line2)
            #print( res, res.start(), res.end())
            if res:
                idx = res.start() + idx
                # Null match, ignore it (&#39;*&#39; with zero length match)
                if res.end() == res.start():
                    #print( &#34;null match&#34;, idx, res.start(), res.end())
                    # Proceed no matter what
                    if res.end() != 0:
                        idx = res.end() + 1
                    else:
                        idx += 1
                    continue

                idx2 = res.end() + idx
                mlen = res.end() - res.start()
                #print( &#34;match&#34;, line2[res.start():res.end()])
            else:
                idx = -1
                break
        else:
            idx = line.find(srctxt, idx)
            idx2 = idx

        if  idx &gt;= 0:
            line2 =  str(idx) + &#34;:&#34;  + str(cnt) +\
                     &#34;:&#34; + str(mlen) + &#34; &#34; + line
            accum.append(line2)
            idx = idx2 + 1
        else:
            break

    return accum

# Save session file

def done_sess_fc(win, resp, fc):

    #print  (&#34;done_sess_fc&#34;, resp)
    # Back to original dir
    if resp == Gtk.ButtonsType.OK:
        try:
            fname = win.get_filename()
            if not fname:
                print(&#34;Must have filename&#34;)
            else:
                #print(&#34;Saving session file under:&#34;, fname)
                fh = open(fname, &#34;wb&#34;)
                pickle.dump(fc.sesslist, fh)
                fh.close()
                pedconfig.conf.pedwin.os.add(fname)

        except:
            print(&#34;Cannot save session file&#34;, sys.exc_info())
    else:
        pass
        #print(&#34;Cancelled&#34;)

    os.chdir(os.path.dirname(fc.old))
    win.destroy()

# ------------------------------------------------------------------------
# Save session to file in the config dir

def save_sess(sesslist):

    fc = Gtk.FileChooserDialog(title=&#34;Save Session&#34;, transient_for=None, \
                            action=Gtk.FileChooserAction.SAVE)
    but =   &#34;Cancel&#34;, Gtk.ButtonsType.CANCEL, &#34;Save Session&#34;, Gtk.ButtonsType.OK
    fc.add_buttons(*but)

    filter2 = Gtk.FileFilter()
    filter2.add_pattern (&#34;*.sess&#34;);  filter2.add_pattern (&#34;*&#34;)

    fc.sesslist = sesslist
    fc.old = os.getcwd()
    fc.set_filter(filter2)
    fc.set_current_folder(pedconfig.conf.sess_dir)
    fc.set_current_name(os.path.basename(&#34;Untitled.sess&#34;))
    fc.set_default_response(Gtk.ButtonsType.OK)
    fc.connect(&#34;response&#34;, done_sess_fc, fc)
    fc.run()

# ------------------------------------------------------------------------
# Load session file

def done_sess2_fc(win, resp, fc):

    #print  (&#34;done_sess2_fc&#34;, resp)
    ddd = fc.old
    sesslist = []

    # Gather list of files
    if resp == Gtk.ButtonsType.OK:
        try:
            fname = win.get_filename()
            if not fname:
                print(&#34;Must have filename.&#34;)
            else:
                pedconfig.conf.pedwin.opensess(fname)
        except:
            print(&#34;Cannot load session file&#34;, sys.exc_info())
            pedync.message(&#34;Cannot load session file&#34;)
    else:
        pass
        #print(&#34;Cancelled&#34;)

    win.destroy()


# Load session from file in the config dir

def     load_sess():

    but =   &#34;Cancel&#34;, Gtk.ButtonsType.CANCEL, &#34;Load Session&#34;, Gtk.ButtonsType.OK
    fc = Gtk.FileChooserDialog(title=&#34;Load Session&#34;, transient_for=None, \
                        action=Gtk.FileChooserAction.OPEN)

    fc.add_button(&#34;Cancel&#34;, Gtk.ButtonsType.CANCEL)
    fc.add_button(&#34;Load Session&#34;, Gtk.ButtonsType.OK)

    filter = Gtk.FileFilter()
    filter.add_pattern (&#34;*.sess&#34;)
    filter.add_pattern (&#34;*&#34;)

    fc.old = os.getcwd()
    fc.set_filter(filter)
    fc.set_current_folder(pedconfig.conf.sess_dir)
    #fc.set_current_name(os.path.basename(&#34;Untitled.sess&#34;))
    fc.set_default_response(Gtk.ButtonsType.OK)
    fc.connect(&#34;response&#34;, done_sess2_fc, fc)
    fc.run()

# ------------------------------------------------------------------------
# Open file dialog

def    _done_fcd(win, resp, fc):

    #print  (&#34;_done_fcd&#34;, fc, resp)
    fc.resp = resp
    # Gather list of files
    if resp == Gtk.ButtonsType.OK:
        fc.fname = fc.get_filename()
        #print(&#34;OK&#34;)
    else:
        fc.fname = &#34;&#34;
        #print(&#34;Cancelled&#34;)

    # Back to original dir
    os.chdir(os.path.dirname(fc.old))
    fc.done = True

# ------------------------------------------------------------------------

def  getfilename(title = &#34;Open File&#34;, save = False, oktext = &#34;OK&#34;, filter = [], parent = None ):

    if save:
        fc = Gtk.FileChooserDialog(title, None, Gtk.FileChooserAction.SAVE)
    else:
        fc = Gtk.FileChooserDialog(title, None, Gtk.FileChooserAction.OPEN)

    but =   &#34;Cancel&#34;, Gtk.ButtonsType.CANCEL, title, Gtk.ButtonsType.OK

    if not parent:
        fc.set_transient_for(fc.get_toplevel())
    else:
        fc.set_transient_for(parent.get_toplevel())

    fc.add_button(&#34;Cancel&#34;, Gtk.ButtonsType.CANCEL)
    fc.add_button(oktext, Gtk.ButtonsType.OK)

    filter2 = Gtk.FileFilter()
    for aa in filter:
        filter2.add_pattern (aa)
    filter2.add_pattern (&#34;*&#34;)

    fc.old = os.getcwd()
    fc.set_filter(filter2)
    fc.set_current_folder(fc.old)
    #fc.set_current_name(os.path.basename(&#34;Untitled.sess&#34;))
    fc.set_default_response(Gtk.ButtonsType.OK)
    fc.connect(&#34;response&#34;, _done_fcd, fc)
    fc.done = False
    fc.run()
    while 1:
        if fc.done:  break
        usleep(200)
    fname =  fc.fname
    fc.destroy()
    #print(&#34;resp&#34;, fc.resp, &#34;fname&#34;, fc.fname)
    return  fname

# ------------------------------------------------------------------------
# Get am pm version of a number

def ampmstr(bb):

    dd = &#34;AM&#34;
    if bb == 12:
       dd = &#34;PM&#34;
    elif bb &gt; 12:
        bb -= 12
        dd = &#34;PM&#34;

    return &#34;%02d %s&#34; % (bb, dd)


# Add the new line twice for more balaced string

allcr =    &#34; &#34; + &#34;\r&#34; + &#34;\n&#34; + \
            &#34;\r&#34; + &#34;\n&#34;

                   #string.punctuation +

allstr =    &#34; &#34; + \
            string.ascii_lowercase +  string.ascii_uppercase +  \
                string.digits

allasc =      string.ascii_lowercase +  string.ascii_uppercase +  \
                string.digits + &#34;_&#34;

alllett =      string.ascii_lowercase +  string.ascii_uppercase

# ------------------------------------------------------------------------
# Get random str

def randstr(lenx):

    strx = &#34;&#34;
    for aa in range(lenx):
        ridx = random.randint(0, len(allstr)-1)
        rr = allstr[ridx]
        strx += str(rr)

    return strx

def randasc(lenx):

    strx = &#34;&#34;
    for aa in range(lenx):
        ridx = random.randint(0, len(allasc)-1)
        rr = allasc[ridx]
        strx += str(rr)

    return strx

def randlett(lenx):

    strx = &#34;&#34;
    for aa in range(lenx):
        ridx = random.randint(0, len(alllett)-1)
        rr = alllett[ridx]
        strx += str(rr)

    return strx

# ------------------------------------------------------------------------
# Convert octal string to integer

def oct2int(strx):
    retx = 0
    for aa in strx:
        num = ord(aa) - ord(&#34;0&#34;)
        if num &gt; 7 or num &lt; 0:
            break
        retx &lt;&lt;= 3; retx += num
    #print &#34;oct:&#34;, strx, &#34;int:&#34;, retx
    return retx

# ------------------------------------------------------------------------
# Convert unicode sequence to unicode char

def uni(xtab):

    #print str.format(&#34;{0:b}&#34;,  xtab[0])

    try:
        unichr
    except NameError:
        unichr = chr

    cc = 0
    try:
        if xtab[0] &amp; 0xe0 == 0xc0:  # two numbers
            cc = (xtab[0] &amp; 0x1f) &lt;&lt; 6
            cc += (xtab[1] &amp; 0x3f)
        elif xtab[0] &amp; 0xf0 == 0xe0: # three numbers
            cc = (xtab[0] &amp; 0x0f) &lt;&lt; 12
            cc += (xtab[1] &amp; 0x3f) &lt;&lt; 6
            cc += (xtab[2] &amp; 0x3f)
        elif xtab[0] &amp; 0xf8 == 0xf0: # four numbers
            cc = (xtab[0] &amp; 0x0e)  &lt;&lt; 18
            cc += (xtab[1] &amp; 0x3f) &lt;&lt; 12
            cc += (xtab[2] &amp; 0x3f) &lt;&lt; 6
            cc += (xtab[3] &amp; 0x3f)
        elif xtab[0] &amp; 0xfc == 0xf8: # five numbers
            cc = (xtab[0] &amp; 0x03)  &lt;&lt; 24
            cc += (xtab[1] &amp; 0x3f) &lt;&lt; 18
            cc += (xtab[2] &amp; 0x3f) &lt;&lt; 12
            cc += (xtab[3] &amp; 0x3f) &lt;&lt; 6
            cc += (xtab[4] &amp; 0x3f)
        elif xtab[0] &amp; 0xfe == 0xf8: # six numbers
            cc = (xtab[0] &amp; 0x01)  &lt;&lt; 30
            cc += (xtab[1] &amp; 0x3f) &lt;&lt; 24
            cc += (xtab[2] &amp; 0x3f) &lt;&lt; 18
            cc += (xtab[3] &amp; 0x3f) &lt;&lt; 12
            cc += (xtab[4] &amp; 0x3f) &lt;&lt; 6
            cc += (xtab[5] &amp; 0x3f)

        ccc = unichr(cc)
    except:
        pass

    return ccc

def is_ascii(strx):

    pos = 0; lenx = len(strx)
    while True:
        if pos &gt;= lenx:
            break

        chh = strx[pos]
        #print (ord(chh))
        if ord(chh) &gt; 127:
            #print (ord(chh))
            if pos == 0: pos += 1
            return pos
        pos+= 1

    return 0

def kill_non_ascii(strx):

    str2 = &#34;&#34;
    pos = 0; lenx = len(strx)
    while True:
        if pos &gt;= lenx:
            break

        chh = strx[pos]
        #print (ord(chh))
        if ord(chh) &lt;= 127:
            str2 += chh
        else:
            str2 += &#34;*&#34;
        pos+= 1

    return str2

# ------------------------------------------------------------------------
# Unescape unicode into displayable sequence

xtab = []; xtablen = 0

def unescape(strx):

    #print &#34; x[&#34; + strx + &#34;]x &#34;

    global xtab, xtablen
    retx = u&#34;&#34;; pos = 0; lenx = len(strx)

    while True:
        if pos &gt;= lenx:
            break

        chh = strx[pos]

        if chh == &#39;\\&#39;:
            #print &#34;backslash&#34;, strx[pos:]
            pos2 = pos + 1; strx2 = &#34;&#34;
            while True:
                if pos2 &gt;= lenx:
                    # See if we accumulated anything
                    if strx2 != &#34;&#34;:
                        xtab.append(oct2int(strx2))
                    if len(xtab) &gt; 0:
                        #print &#34;final:&#34;, xtab
                        if xtablen == len(xtab):
                            retx += uni(xtab)
                            xtab = []; xtablen = 0
                    pos = pos2 - 1
                    break
                chh2 = strx[pos2]
                if chh2  &gt;= &#34;0&#34; and chh2 &lt;= &#34;7&#34;:
                    strx2 += chh2
                else:
                    #print &#34;strx2: &#39;&#34;  + strx2 + &#34;&#39;&#34;
                    if strx2 != &#34;&#34;:
                        octx = oct2int(strx2)
                        if xtablen == 0:
                            if octx &amp; 0xe0 == 0xc0:
                                #print &#34;two &#34;,str.format(&#34;{0:b}&#34;, octx)
                                xtablen = 2
                                xtab.append(octx)
                            elif octx &amp; 0xf0 == 0xe0: # three numbers
                                #print &#34;three &#34;,str.format(&#34;{0:b}&#34;, octx)
                                xtablen = 3
                                xtab.append(octx)
                            elif octx &amp; 0xf8 == 0xf0: # four numbers
                                print(&#34;four &#34;,str.format(&#34;{0:b}&#34;, octx))
                                xtablen = 4
                                xtab.append(octx)
                            elif octx &amp; 0xfc == 0xf8: # five numbers
                                print(&#34;five &#34;,str.format(&#34;{0:b}&#34;, octx))
                                xtablen = 5
                                xtab.append(octx)
                            elif octx &amp; 0xfe == 0xfc: # six numbers
                                print(&#34;six &#34;,str.format(&#34;{0:b}&#34;, octx))
                                xtablen = 6
                                xtab.append(octx)
                            else:
                                #print &#34;other &#34;,str.format(&#34;{0:b}&#34;, octx)
                                #retx += unichr(octx)
                                retx += chr(octx)
                        else:
                            xtab.append(octx)
                            #print &#34;data &#34;,str.format(&#34;{0:b}&#34;, octx)
                            if xtablen == len(xtab):
                                retx += uni(xtab)
                                xtab = []; xtablen = 0

                    pos = pos2 - 1
                    break
                pos2 += 1
        else:

            if xtablen == len(xtab) and xtablen != 0:
                retx += uni(xtab)
            xtab=[]; xtablen = 0

            try:
                retx += chh
            except:
                pass
        pos += 1

    #print &#34;y[&#34; + retx + &#34;]y&#34;
    return retx

# ------------------------------------------------------------------------
# Give the user the usual options for true / false - 1 / 0 - y / n

def isTrue(strx):
    if strx == &#34;1&#34;: return True
    if strx == &#34;0&#34;: return False
    uuu = strx.upper()
    if uuu == &#34;TRUE&#34;: return True
    if uuu == &#34;FALSE&#34;: return False
    if uuu == &#34;Y&#34;: return True
    if uuu == &#34;N&#34;: return False
    return False

# ------------------------------------------------------------------------
# Return True if file exists

def isfile(fname):

    try:
        ss = os.stat(fname)
    except:
        return False

    if stat.S_ISREG(ss[stat.ST_MODE]):
        return True
    return False

# Append to log
def logentry(kind, startt, fname):
    logfname = &#34;account.txt&#34;
    logfile = pedconfig.conf.log_dir + os.sep + logfname
    try:
        fp = open(logfile, &#34;a+&#34;)
    except:
        try:
            fp = open(logfile, &#34;w+&#34;)
            fp.seek(0, os.SEEK_END)
        except:
            print(&#34;Cannot open/create log file&#34;, logfile)
            return

    log_clock = time.time()

    print(&#34;Action:&#34;, &#34;%s %s&#34; % (kind, os.path.realpath(fname)), file=fp)
    print(&#34;On:&#34;, time.ctime(log_clock), file=fp)
    print(&#34;Delta:&#34;, &#34;%.0f&#34; % (log_clock - startt), file=fp)
    print(&#34;Date:&#34;, &#34;%.0f %s %s\n&#34; % \
                        (log_clock, os.path.basename(fname), kind.split()[0]), file=fp)
    fp.close()

# Append to timesheet
def timesheet(kind, startt, endd):

    logfname = &#34;timesheet.txt&#34;
    logfile = pedconfig.conf.log_dir + os.sep + logfname
    try:
        fp = open(logfile, &#34;a+&#34;)
    except:
        try:
            fp = open(logfile, &#34;w+&#34;)
            fp.seek(0, os.SEEK_END)
        except:
            print(&#34;Cannot open/create log file&#34;, logfile)
            return

    log_clock = time.time()

    print(&#34;Action:&#34;, &#34;%s&#34; % (kind), file=fp)
    print(&#34;On:&#34;, time.ctime(log_clock), file=fp)
    if endd:
        td = endd - startt
        print(&#34;Time diff:&#34;, &#34;%.0f %d:%d&#34; % (td, td / 3600, (td % 3600) / 60), file=fp)

    print(file=fp)
    fp.close()

def put_debug(xstr):

    print( xstr)

    &#39;&#39;&#39;try:
        if os.isatty(sys.stdout.fileno()):
            print( xstr)
        else:
            syslog.syslog(xstr)
    except:
        print( &#34;Failed on debug output.&#34;)
        print( sys.exc_info())
    &#39;&#39;&#39;

def put_exception(xstr):

    cumm = &#34;Exception: &#34; + xstr + &#34; &#34;
    a,b,c = sys.exc_info()
    if a != None:
        cumm += str(a) + &#34; &#34; + str(b) + &#34;\n&#34;
        try:
            #cumm += str(traceback.format_tb(c, 10))
            ttt = traceback.extract_tb(c)
            for aa in ttt:
                sss = aa[0].split(os.sep)
                cumm += &#34;File: &#34; + os.sep.join(sss[-3:]) + \
                        &#34; Line: &#34; + str(aa[1]) + &#34;\n&#34; +  \
                    &#34;   Context: &#34; + aa[2] + &#34; -&gt; &#34; + aa[3] + &#34;\n&#34;
        except:
            print( &#34;Could not print trace stack. &#34;, sys.exc_info())

    #put_debug(cumm)
    print(cumm)
    #syslog.syslog(&#34;%s %s %s&#34; % (xstr, a, b))

def put_exception2(xstr):

    cumm = xstr + &#34; &#34;
    a,b,c = sys.exc_info()
    if a != None:
        cumm += str(a) + &#34; &#34; + str(b) + &#34;\n&#34;
        try:
            #cumm += str(traceback.format_tb(c, 10))
            ttt = traceback.extract_tb(c)
            for aa in ttt:
                cumm += &#34;File: &#34; + os.path.basename(aa[0]) + \
                        &#34; Line: &#34; + str(aa[1]) + &#34;\n&#34; +  \
                    &#34;   Context: &#34; + aa[2] + &#34; -&gt; &#34; + aa[3] + &#34;\n&#34;
        except:
            print( &#34;Could not print trace stack. &#34;, sys.exc_info())

    put_debug(cumm)
    #syslog.syslog(&#34;%s %s %s&#34; % (xstr, a, b))


def prompt_for_text(self2, message, fill):

    dialog = Gtk.Dialog(message,
                   None,
                   Gtk.DialogFlags.MODAL | \
                   Gtk.DialogFlags.DESTROY_WITH_PARENT,
                   (Gtk.STOCK_CANCEL, Gtk.ResponseType.REJECT,
                   Gtk.STOCK_OK, Gtk.ResponseType.ACCEPT))
    dialog.set_default_response(Gtk.ResponseType.ACCEPT)
    dialog.set_transient_for(self2.mained.mywin)

    # Spacers
    label1 = Gtk.Label(&#34;   &#34;);  label2 = Gtk.Label(&#34;   &#34;)
    label3 = Gtk.Label(&#34;   &#34;);  label4 = Gtk.Label(&#34;   &#34;)
    label5 = Gtk.Label(&#34;   &#34;);  label6 = Gtk.Label(&#34;   &#34;)
    label7 = Gtk.Label(&#34;   &#34;);  label8 = Gtk.Label(&#34;   &#34;)

    entry = Gtk.Entry();

    entry.set_activates_default(True)

    if  self2.lastcmd == &#34;&#34;:
        self2.lastcmd = pedconfig.conf.sql.get_str(&#34;lastcmd&#34;)
        if  self2.lastcmd == None:
            self2.lastcmd = &#34;&#34;

    entry.set_text(fill)
    entry.set_width_chars(24)
    dialog.vbox.pack_start(label4, 0, 0, 0)

    hbox2 = Gtk.HBox()
    hbox2.pack_start(label6, 0, 0, 0)
    hbox2.pack_start(entry, 0, 0, 0)
    hbox2.pack_start(label7, 0, 0, 0)
    dialog.vbox.pack_start(hbox2, 0, 0, 0)
    dialog.vbox.pack_start(label5, 0, 0, 0)

    hbox = Gtk.HBox()
    dialog.vbox.pack_start(hbox, 0, 0, 0)
    dialog.vbox.pack_start(label8, 0, 0, 0)

    dialog.show_all()
    response = dialog.run()
    gotxt = entry.get_text()
    dialog.destroy()

    if response != Gtk.ResponseType.ACCEPT:
        gotxt = &#34;&#34;

    return gotxt

# ------------------------------------------------------------------------
# Traditional (blocking) open file

class OpenFname():

    def __init__(self, mywin, filters = None):
        self.fc_done = False
        self.fc_code = 0
        self.fname = &#34;&#34;

        warnings.simplefilter(&#34;ignore&#34;)
        but =   &#34;Cancel&#34;, Gtk.ButtonsType.CANCEL,\
         &#34;Open File&#34;, Gtk.ButtonsType.OK
        self.fc = Gtk.FileChooserDialog(&#34;Open file&#34;, mywin, \
             Gtk.FileChooserAction.OPEN  \
            #Gtk.FILE_CHOOSER_ACTION_SELECT_FOLDER
            , but)
        warnings.simplefilter(&#34;default&#34;)

        if filters:
            for aa in filters:
                self.fc.add_filter(aa)

        self.fc.set_default_response(Gtk.ButtonsType.OK)
        self.fc.set_current_folder(os.getcwd())

        self.fc.connect(&#34;response&#34;, self._done_openfname)
        #self.fc.connect(&#34;current-folder-changed&#34;, self.folder_ch )
        #self.fc.set_current_name(self.fname)

    def run(self):
        try:
            self.fc.run()
        except:
            self.fc_done = True

        while True:
            if self.fc_done:
                break
            #time.sleep(.3)
            usleep(400)
        return self

    def _done_openfname(self, win, resp):
        #print &#34;done_openfname&#34;, win, resp
        if resp == Gtk.ButtonsType.OK:
            fname = self.fc.get_filename()
            if not fname:
                #print &#34;Must have filename&#34;
                #self.update_statusbar(&#34;No filename specified&#34;)
                pass
            elif os.path.isdir(fname):
                #self.update_statusbar(&#34;Changed to %s&#34; % fname)
                os.chdir(fname)
                self.fc.set_current_folder(fname)
                return
            else:
                #self.openfile(fname)
                self.fname = fname
                self.fc_code = True
        win.destroy()
        self.fc_done = True


# Arbitrary string to number

def atoi(strx):
    rtr=0
    for cc in strx:
        occ = ord(cc)
        if occ &lt; ord(&#39;0&#39;) or occ &gt; ord(&#39;9&#39;):
            break
        rtr = rtr*10 + (occ - ord(&#39;0&#39;))

    return rtr


class HeadDialog(Gtk.Dialog):

    def __init__(self, initstr, parent = None):
        Gtk.Dialog.__init__(
            self, title=&#34;Name for Note&#34;, transient_for=parent, modal=True,
        )
        self.add_buttons(
            Gtk.STOCK_OK,
            Gtk.ResponseType.OK,
            Gtk.STOCK_CANCEL,
            Gtk.ResponseType.CANCEL,
        )
        self.set_default_response(Gtk.ResponseType.OK)

        box = self.get_content_area()
        label = Gtk.Label(label=&#34;        &#34;)
        box.add(label)

        self.entry = Gtk.Entry()
        self.entry.set_text(initstr)
        self.entry.set_activates_default(True)

        self.hbox = Gtk.HBox()
        self.hbox.pack_start(Gtk.Label(label=&#34;   Note Header:  &#34;), 0, 0, 0)
        self.hbox.pack_start(self.entry, 1, 1, 0)
        self.hbox.pack_start(Gtk.Label(label=&#34;                 &#34;), 0, 0, 0)

        box.add(self.hbox)
        self.show_all()

class SearchDialog(Gtk.Dialog):

    def __init__(self, parent = None):
        Gtk.Dialog.__init__(
            self, title=&#34; Search &#34;, transient_for=parent, modal=True,
        )
        self.add_buttons(
            Gtk.STOCK_FIND,
            Gtk.ResponseType.OK,
            Gtk.STOCK_CANCEL,
            Gtk.ResponseType.CANCEL,
        )
        self.set_default_response(Gtk.ResponseType.OK)
        box = self.get_content_area()

        #label = Gtk.Label(label=&#34;  Enter text you want to search for:  &#34;)
        label = Gtk.Label(label=&#34;   &#34;)
        box.add(label)

        self.hbox = Gtk.HBox()
        self.hbox.pack_start(Gtk.Label(label=&#34;   Search for:  &#34;), 0, 0, 0)
        self.entry = Gtk.Entry()
        self.entry.set_activates_default(True)
        self.hbox.pack_start(self.entry, 1, 1, 0)
        self.hbox.pack_start(Gtk.Label(label=&#34;            &#34;), 0, 0, 0)

        box.add(self.hbox)

        #box.add(self.entry)
        self.show_all()

# EOF</code></pre>
</details>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-functions">Functions</h2>
<dl>
<dt id="pedutil.ampmstr"><code class="name flex">
<span>def <span class="ident">ampmstr</span></span>(<span>bb)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def ampmstr(bb):

    dd = &#34;AM&#34;
    if bb == 12:
       dd = &#34;PM&#34;
    elif bb &gt; 12:
        bb -= 12
        dd = &#34;PM&#34;

    return &#34;%02d %s&#34; % (bb, dd)</code></pre>
</details>
</dd>
<dt id="pedutil.atoi"><code class="name flex">
<span>def <span class="ident">atoi</span></span>(<span>strx)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def atoi(strx):
    rtr=0
    for cc in strx:
        occ = ord(cc)
        if occ &lt; ord(&#39;0&#39;) or occ &gt; ord(&#39;9&#39;):
            break
        rtr = rtr*10 + (occ - ord(&#39;0&#39;))

    return rtr</code></pre>
</details>
</dd>
<dt id="pedutil.calc_tabs"><code class="name flex">
<span>def <span class="ident">calc_tabs</span></span>(<span>strx, till, tabstop=4)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def calc_tabs(strx, till, tabstop = 4):
    idx = 0; cnt = 0
    xlen = min(len(strx), till)
    while True:
        if idx &gt;= xlen: break
        chh = strx[idx]
        if  chh == &#34;\t&#34;:
            cnt += tabstop - (cnt % tabstop)
        else:
            cnt += 1
        idx += 1
    return cnt</code></pre>
</details>
</dd>
<dt id="pedutil.calc_tabs2"><code class="name flex">
<span>def <span class="ident">calc_tabs2</span></span>(<span>strx, till, tabstop=4)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def calc_tabs2(strx, till, tabstop = 4):
    idx = 0; cnt = 0; slen = len(strx)
    xlen = min(slen, till)
    while True:
        if idx &gt;= xlen: break
        chh = strx[idx]
        if  chh == &#34;\t&#34;:
            cnt += tabstop - (cnt % tabstop)
        else:
            cnt += 1
        idx += 1

    # Pad full lengh
    if till &gt; slen:
        cnt += till - slen
    return cnt</code></pre>
</details>
</dd>
<dt id="pedutil.cntleadchar"><code class="name flex">
<span>def <span class="ident">cntleadchar</span></span>(<span>strx, chh)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def cntleadchar(strx, chh):
    xlen = len(strx); pos = 0; ret = &#34;&#34;
    if xlen == 0: return ret
    while pos &lt; xlen:
        if strx[pos] != chh:
            break
        ret += chh
        pos = pos + 1
    return ret</code></pre>
</details>
</dd>
<dt id="pedutil.cut_lead_space"><code class="name flex">
<span>def <span class="ident">cut_lead_space</span></span>(<span>xstr, divi=2)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def cut_lead_space(xstr, divi = 2):
    res = &#34;&#34;; cnt = 0; idx = 0; spcnt = 0
    xlen = len(xstr)
    while True:
        if cnt &gt;= xlen: break
        chh = xstr[idx]
        if chh == &#34; &#34;:
            spcnt += 1
            if spcnt &gt;= divi:
                spcnt = 0; res += &#34; &#34;
        else:
            res += xstr[idx:]
            break
        idx += 1
    return res</code></pre>
</details>
</dd>
<dt id="pedutil.decalc_tabs"><code class="name flex">
<span>def <span class="ident">decalc_tabs</span></span>(<span>strx, pos, tabstop=4)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def decalc_tabs(strx, pos, tabstop = 4):

    idx = cnt = 0; slen = len(strx)
    while True:
        if idx &gt;= slen: break
        chh = strx[idx]
        if  chh == &#34;\t&#34;:
            cnt += tabstop - (cnt % tabstop)
        else:
            cnt += 1
        if cnt &gt;= pos: break
        idx += 1

    return idx</code></pre>
</details>
</dd>
<dt id="pedutil.done_sess2_fc"><code class="name flex">
<span>def <span class="ident">done_sess2_fc</span></span>(<span>win, resp, fc)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def done_sess2_fc(win, resp, fc):

    #print  (&#34;done_sess2_fc&#34;, resp)
    ddd = fc.old
    sesslist = []

    # Gather list of files
    if resp == Gtk.ButtonsType.OK:
        try:
            fname = win.get_filename()
            if not fname:
                print(&#34;Must have filename.&#34;)
            else:
                pedconfig.conf.pedwin.opensess(fname)
        except:
            print(&#34;Cannot load session file&#34;, sys.exc_info())
            pedync.message(&#34;Cannot load session file&#34;)
    else:
        pass
        #print(&#34;Cancelled&#34;)

    win.destroy()</code></pre>
</details>
</dd>
<dt id="pedutil.done_sess_fc"><code class="name flex">
<span>def <span class="ident">done_sess_fc</span></span>(<span>win, resp, fc)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def done_sess_fc(win, resp, fc):

    #print  (&#34;done_sess_fc&#34;, resp)
    # Back to original dir
    if resp == Gtk.ButtonsType.OK:
        try:
            fname = win.get_filename()
            if not fname:
                print(&#34;Must have filename&#34;)
            else:
                #print(&#34;Saving session file under:&#34;, fname)
                fh = open(fname, &#34;wb&#34;)
                pickle.dump(fc.sesslist, fh)
                fh.close()
                pedconfig.conf.pedwin.os.add(fname)

        except:
            print(&#34;Cannot save session file&#34;, sys.exc_info())
    else:
        pass
        #print(&#34;Cancelled&#34;)

    os.chdir(os.path.dirname(fc.old))
    win.destroy()</code></pre>
</details>
</dd>
<dt id="pedutil.findinfile"><code class="name flex">
<span>def <span class="ident">findinfile</span></span>(<span>nnn, ffff, nocase=False)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def findinfile(nnn, ffff, nocase = False):

    rrr = []
    try:
        text = readfile(ffff)

        # See if text file
        cnt = 0
        try:
            line = text[0] + text[1]
            for ccc in line:
                chh = ord(ccc)
                if chh &lt; 32 or chh &gt; 127:
                    #print(&#34;bin&#34;, ccc, ord(ccc) )
                    cnt += 1
        except:
            #print(&#34;except in search&#34;,  sys.exc_info())
            pass

        if cnt &gt; 3:
            #print (&#34;Not a text file:&#34;, ffff)
            return rrr
    except:
        print(&#34;Cannot read file&#34;, ffff)
        text = &#34;&#34;

    unnn = nnn.lower()
    for aa in text:
        if nocase:
            if unnn in aa.lower():
                rrr.append(aa)
        else:
            if nnn in aa:
                rrr.append(aa)

    return rrr</code></pre>
</details>
</dd>
<dt id="pedutil.genstr"><code class="name flex">
<span>def <span class="ident">genstr</span></span>(<span>strx, num)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def genstr(strx, num):
    ret = &#34;&#34;
    while num:
        ret += strx; num -= 1
    return ret</code></pre>
</details>
</dd>
<dt id="pedutil.get_exec_path"><code class="name flex">
<span>def <span class="ident">get_exec_path</span></span>(<span>fname)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def get_exec_path(fname):

    #exec_dir = os.path.dirname(pedconfig.conf.mydir)
    exec_dir = os.path.dirname(__file__)
    exec_path2 = os.path.join(exec_dir, &#34;data&#34;)
    exec_path = os.path.join(exec_path2, fname)

    if pedconfig.conf.verbose:
        print( exec_path)

    return exec_path</code></pre>
</details>
</dd>
<dt id="pedutil.get_img_path"><code class="name flex">
<span>def <span class="ident">get_img_path</span></span>(<span>fname)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def get_img_path(fname):

    img_dir = os.path.dirname(__file__)
    img_path = os.path.join(img_dir, &#34;images/&#34;, fname)
    #if pedconfig.conf.verbose:
    #    print( &#34;img_path&#34;, img_path)
    return img_path</code></pre>
</details>
</dd>
<dt id="pedutil.get_pangview_path"><code class="name flex">
<span>def <span class="ident">get_pangview_path</span></span>(<span>)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def get_pangview_path():

    fname = &#34;pangview.py&#34;
    exec_dir = os.path.dirname(__file__)
    pname = exec_dir + os.sep + &#34;..&#34; +  os.sep + fname
    if not os.path.isfile(pname):
        pname = fname

    if pedconfig.conf.verbose:
        print(&#34;Pangview path&#34;, pname)

    return pname</code></pre>
</details>
</dd>
<dt id="pedutil.getfilename"><code class="name flex">
<span>def <span class="ident">getfilename</span></span>(<span>title='Open File', save=False, oktext='OK', filter=[], parent=None)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def  getfilename(title = &#34;Open File&#34;, save = False, oktext = &#34;OK&#34;, filter = [], parent = None ):

    if save:
        fc = Gtk.FileChooserDialog(title, None, Gtk.FileChooserAction.SAVE)
    else:
        fc = Gtk.FileChooserDialog(title, None, Gtk.FileChooserAction.OPEN)

    but =   &#34;Cancel&#34;, Gtk.ButtonsType.CANCEL, title, Gtk.ButtonsType.OK

    if not parent:
        fc.set_transient_for(fc.get_toplevel())
    else:
        fc.set_transient_for(parent.get_toplevel())

    fc.add_button(&#34;Cancel&#34;, Gtk.ButtonsType.CANCEL)
    fc.add_button(oktext, Gtk.ButtonsType.OK)

    filter2 = Gtk.FileFilter()
    for aa in filter:
        filter2.add_pattern (aa)
    filter2.add_pattern (&#34;*&#34;)

    fc.old = os.getcwd()
    fc.set_filter(filter2)
    fc.set_current_folder(fc.old)
    #fc.set_current_name(os.path.basename(&#34;Untitled.sess&#34;))
    fc.set_default_response(Gtk.ButtonsType.OK)
    fc.connect(&#34;response&#34;, _done_fcd, fc)
    fc.done = False
    fc.run()
    while 1:
        if fc.done:  break
        usleep(200)
    fname =  fc.fname
    fc.destroy()
    #print(&#34;resp&#34;, fc.resp, &#34;fname&#34;, fc.fname)
    return  fname</code></pre>
</details>
</dd>
<dt id="pedutil.handle_keys"><code class="name flex">
<span>def <span class="ident">handle_keys</span></span>(<span>host, event)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def handle_keys(host, event):

    ret = 0

    # Do key down:
    if  event.type == Gdk.KEY_PRESS:
        if event.keyval == Gdk.KEY_Alt_L or \
                event.keyval == Gdk.KEY_Alt_R:
            #print( &#34;Alt down&#34;)
            host.alt = True
        elif event.keyval == Gdk.KEY_Control_L or \
                event.keyval == Gdk.KEY_Control_R:
            #print( &#34;Ctrl down&#34;)
            host.ctrl = True; ret = True
        if event.keyval == Gdk.KEY_Shift_L or \
              event.keyval == Gdk.KEY_Shift_R:
            #print( &#34;shift down&#34;)
            host.shift = True

    # Do key up
    elif  event.type == Gdk.KEY_RELEASE:
        if event.keyval == Gdk.KEY_Alt_L or \
              event.keyval == Gdk.KEY_Alt_R:
            #print( &#34;Alt up&#34;)
            host.alt = False
        if event.keyval == Gdk.KEY_Control_L or \
              event.keyval == Gdk.KEY_Control_R:
            #print( &#34;Ctrl up&#34;)
            host.ctrl = False
        if event.keyval == Gdk.KEY_Shift_L or \
              event.keyval == Gdk.KEY_Shift_R:
            #print( &#34;shift up&#34;)
            host.shift = False

    return ret</code></pre>
</details>
</dd>
<dt id="pedutil.hash_name"><code class="name flex">
<span>def <span class="ident">hash_name</span></span>(<span>strx)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def hash_name(strx):

    lenx = len(strx);  hashx = int(0)
    for aa in strx:
        bb = ord(aa)
        hashx +=  int((bb &lt;&lt; 12) + bb)
        hashx &amp;= 0xffffffff
        hashx = int(hashx &lt;&lt; 8) + int(hashx &gt;&gt; 8)
        hashx &amp;= 0xffffffff

    return &#34;%x&#34; % hashx</code></pre>
</details>
</dd>
<dt id="pedutil.isTrue"><code class="name flex">
<span>def <span class="ident">isTrue</span></span>(<span>strx)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def isTrue(strx):
    if strx == &#34;1&#34;: return True
    if strx == &#34;0&#34;: return False
    uuu = strx.upper()
    if uuu == &#34;TRUE&#34;: return True
    if uuu == &#34;FALSE&#34;: return False
    if uuu == &#34;Y&#34;: return True
    if uuu == &#34;N&#34;: return False
    return False</code></pre>
</details>
</dd>
<dt id="pedutil.is_ascii"><code class="name flex">
<span>def <span class="ident">is_ascii</span></span>(<span>strx)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def is_ascii(strx):

    pos = 0; lenx = len(strx)
    while True:
        if pos &gt;= lenx:
            break

        chh = strx[pos]
        #print (ord(chh))
        if ord(chh) &gt; 127:
            #print (ord(chh))
            if pos == 0: pos += 1
            return pos
        pos+= 1

    return 0</code></pre>
</details>
</dd>
<dt id="pedutil.isfile"><code class="name flex">
<span>def <span class="ident">isfile</span></span>(<span>fname)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def isfile(fname):

    try:
        ss = os.stat(fname)
    except:
        return False

    if stat.S_ISREG(ss[stat.ST_MODE]):
        return True
    return False</code></pre>
</details>
</dd>
<dt id="pedutil.kill_non_ascii"><code class="name flex">
<span>def <span class="ident">kill_non_ascii</span></span>(<span>strx)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def kill_non_ascii(strx):

    str2 = &#34;&#34;
    pos = 0; lenx = len(strx)
    while True:
        if pos &gt;= lenx:
            break

        chh = strx[pos]
        #print (ord(chh))
        if ord(chh) &lt;= 127:
            str2 += chh
        else:
            str2 += &#34;*&#34;
        pos+= 1

    return str2</code></pre>
</details>
</dd>
<dt id="pedutil.launch_pangview"><code class="name flex">
<span>def <span class="ident">launch_pangview</span></span>(<span>docx)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def launch_pangview(docx):

    ret = 0
    pname = get_pangview_path()

    if pname == &#34;pangview.py&#34;:
        # we are running in pip
        arr =  [&#39;pangview&#39;,  docx]
    else:
        arr = [&#34;python&#34;, pname,  docx]

    if pedconfig.conf.verbose:
        print(&#34;Launching pangview:&#34;, arr) # pname, &#34;with&#34;, docx)
    try:
        ret = subprocess.Popen(arr)
    except:
        print(&#34;except on pang&#34;,  sys.exc_info())
        pedync.message(&#34;\n   Cannot launch the pangview.py utility.   \n\n&#34;
                       &#34;              (Please install)\n&#34;)
    return ret</code></pre>
</details>
</dd>
<dt id="pedutil.load_sess"><code class="name flex">
<span>def <span class="ident">load_sess</span></span>(<span>)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def     load_sess():

    but =   &#34;Cancel&#34;, Gtk.ButtonsType.CANCEL, &#34;Load Session&#34;, Gtk.ButtonsType.OK
    fc = Gtk.FileChooserDialog(title=&#34;Load Session&#34;, transient_for=None, \
                        action=Gtk.FileChooserAction.OPEN)

    fc.add_button(&#34;Cancel&#34;, Gtk.ButtonsType.CANCEL)
    fc.add_button(&#34;Load Session&#34;, Gtk.ButtonsType.OK)

    filter = Gtk.FileFilter()
    filter.add_pattern (&#34;*.sess&#34;)
    filter.add_pattern (&#34;*&#34;)

    fc.old = os.getcwd()
    fc.set_filter(filter)
    fc.set_current_folder(pedconfig.conf.sess_dir)
    #fc.set_current_name(os.path.basename(&#34;Untitled.sess&#34;))
    fc.set_default_response(Gtk.ButtonsType.OK)
    fc.connect(&#34;response&#34;, done_sess2_fc, fc)
    fc.run()</code></pre>
</details>
</dd>
<dt id="pedutil.logentry"><code class="name flex">
<span>def <span class="ident">logentry</span></span>(<span>kind, startt, fname)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def logentry(kind, startt, fname):
    logfname = &#34;account.txt&#34;
    logfile = pedconfig.conf.log_dir + os.sep + logfname
    try:
        fp = open(logfile, &#34;a+&#34;)
    except:
        try:
            fp = open(logfile, &#34;w+&#34;)
            fp.seek(0, os.SEEK_END)
        except:
            print(&#34;Cannot open/create log file&#34;, logfile)
            return

    log_clock = time.time()

    print(&#34;Action:&#34;, &#34;%s %s&#34; % (kind, os.path.realpath(fname)), file=fp)
    print(&#34;On:&#34;, time.ctime(log_clock), file=fp)
    print(&#34;Delta:&#34;, &#34;%.0f&#34; % (log_clock - startt), file=fp)
    print(&#34;Date:&#34;, &#34;%.0f %s %s\n&#34; % \
                        (log_clock, os.path.basename(fname), kind.split()[0]), file=fp)
    fp.close()</code></pre>
</details>
</dd>
<dt id="pedutil.nextchar"><code class="name flex">
<span>def <span class="ident">nextchar</span></span>(<span>strx, xchar, start)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def nextchar(strx, xchar, start):
    idx = start; end =  len(strx) - 1
    while True:
        if idx &gt; end: break
        chh = strx[idx]
        if chh == xchar: break
        idx += 1
    return idx</code></pre>
</details>
</dd>
<dt id="pedutil.oct2int"><code class="name flex">
<span>def <span class="ident">oct2int</span></span>(<span>strx)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def oct2int(strx):
    retx = 0
    for aa in strx:
        num = ord(aa) - ord(&#34;0&#34;)
        if num &gt; 7 or num &lt; 0:
            break
        retx &lt;&lt;= 3; retx += num
    #print &#34;oct:&#34;, strx, &#34;int:&#34;, retx
    return retx</code></pre>
</details>
</dd>
<dt id="pedutil.prevchar"><code class="name flex">
<span>def <span class="ident">prevchar</span></span>(<span>strx, xchar, start)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def prevchar( strx, xchar, start):
    idx = start
    idx = min(len(strx) - 1, idx)
    while True:
        if idx &lt; 0: break
        chh = strx[idx]
        if chh == xchar: break
        idx -= 1
    return idx</code></pre>
</details>
</dd>
<dt id="pedutil.prompt_for_text"><code class="name flex">
<span>def <span class="ident">prompt_for_text</span></span>(<span>self2, message, fill)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def prompt_for_text(self2, message, fill):

    dialog = Gtk.Dialog(message,
                   None,
                   Gtk.DialogFlags.MODAL | \
                   Gtk.DialogFlags.DESTROY_WITH_PARENT,
                   (Gtk.STOCK_CANCEL, Gtk.ResponseType.REJECT,
                   Gtk.STOCK_OK, Gtk.ResponseType.ACCEPT))
    dialog.set_default_response(Gtk.ResponseType.ACCEPT)
    dialog.set_transient_for(self2.mained.mywin)

    # Spacers
    label1 = Gtk.Label(&#34;   &#34;);  label2 = Gtk.Label(&#34;   &#34;)
    label3 = Gtk.Label(&#34;   &#34;);  label4 = Gtk.Label(&#34;   &#34;)
    label5 = Gtk.Label(&#34;   &#34;);  label6 = Gtk.Label(&#34;   &#34;)
    label7 = Gtk.Label(&#34;   &#34;);  label8 = Gtk.Label(&#34;   &#34;)

    entry = Gtk.Entry();

    entry.set_activates_default(True)

    if  self2.lastcmd == &#34;&#34;:
        self2.lastcmd = pedconfig.conf.sql.get_str(&#34;lastcmd&#34;)
        if  self2.lastcmd == None:
            self2.lastcmd = &#34;&#34;

    entry.set_text(fill)
    entry.set_width_chars(24)
    dialog.vbox.pack_start(label4, 0, 0, 0)

    hbox2 = Gtk.HBox()
    hbox2.pack_start(label6, 0, 0, 0)
    hbox2.pack_start(entry, 0, 0, 0)
    hbox2.pack_start(label7, 0, 0, 0)
    dialog.vbox.pack_start(hbox2, 0, 0, 0)
    dialog.vbox.pack_start(label5, 0, 0, 0)

    hbox = Gtk.HBox()
    dialog.vbox.pack_start(hbox, 0, 0, 0)
    dialog.vbox.pack_start(label8, 0, 0, 0)

    dialog.show_all()
    response = dialog.run()
    gotxt = entry.get_text()
    dialog.destroy()

    if response != Gtk.ResponseType.ACCEPT:
        gotxt = &#34;&#34;

    return gotxt</code></pre>
</details>
</dd>
<dt id="pedutil.put_debug"><code class="name flex">
<span>def <span class="ident">put_debug</span></span>(<span>xstr)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def put_debug(xstr):

    print( xstr)

    &#39;&#39;&#39;try:
        if os.isatty(sys.stdout.fileno()):
            print( xstr)
        else:
            syslog.syslog(xstr)
    except:
        print( &#34;Failed on debug output.&#34;)
        print( sys.exc_info())
    &#39;&#39;&#39;</code></pre>
</details>
</dd>
<dt id="pedutil.put_exception"><code class="name flex">
<span>def <span class="ident">put_exception</span></span>(<span>xstr)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def put_exception(xstr):

    cumm = &#34;Exception: &#34; + xstr + &#34; &#34;
    a,b,c = sys.exc_info()
    if a != None:
        cumm += str(a) + &#34; &#34; + str(b) + &#34;\n&#34;
        try:
            #cumm += str(traceback.format_tb(c, 10))
            ttt = traceback.extract_tb(c)
            for aa in ttt:
                sss = aa[0].split(os.sep)
                cumm += &#34;File: &#34; + os.sep.join(sss[-3:]) + \
                        &#34; Line: &#34; + str(aa[1]) + &#34;\n&#34; +  \
                    &#34;   Context: &#34; + aa[2] + &#34; -&gt; &#34; + aa[3] + &#34;\n&#34;
        except:
            print( &#34;Could not print trace stack. &#34;, sys.exc_info())

    #put_debug(cumm)
    print(cumm)
    #syslog.syslog(&#34;%s %s %s&#34; % (xstr, a, b))</code></pre>
</details>
</dd>
<dt id="pedutil.put_exception2"><code class="name flex">
<span>def <span class="ident">put_exception2</span></span>(<span>xstr)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def put_exception2(xstr):

    cumm = xstr + &#34; &#34;
    a,b,c = sys.exc_info()
    if a != None:
        cumm += str(a) + &#34; &#34; + str(b) + &#34;\n&#34;
        try:
            #cumm += str(traceback.format_tb(c, 10))
            ttt = traceback.extract_tb(c)
            for aa in ttt:
                cumm += &#34;File: &#34; + os.path.basename(aa[0]) + \
                        &#34; Line: &#34; + str(aa[1]) + &#34;\n&#34; +  \
                    &#34;   Context: &#34; + aa[2] + &#34; -&gt; &#34; + aa[3] + &#34;\n&#34;
        except:
            print( &#34;Could not print trace stack. &#34;, sys.exc_info())

    put_debug(cumm)
    #syslog.syslog(&#34;%s %s %s&#34; % (xstr, a, b))</code></pre>
</details>
</dd>
<dt id="pedutil.randasc"><code class="name flex">
<span>def <span class="ident">randasc</span></span>(<span>lenx)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def randasc(lenx):

    strx = &#34;&#34;
    for aa in range(lenx):
        ridx = random.randint(0, len(allasc)-1)
        rr = allasc[ridx]
        strx += str(rr)

    return strx</code></pre>
</details>
</dd>
<dt id="pedutil.randlett"><code class="name flex">
<span>def <span class="ident">randlett</span></span>(<span>lenx)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def randlett(lenx):

    strx = &#34;&#34;
    for aa in range(lenx):
        ridx = random.randint(0, len(alllett)-1)
        rr = alllett[ridx]
        strx += str(rr)

    return strx</code></pre>
</details>
</dd>
<dt id="pedutil.randstr"><code class="name flex">
<span>def <span class="ident">randstr</span></span>(<span>lenx)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def randstr(lenx):

    strx = &#34;&#34;
    for aa in range(lenx):
        ridx = random.randint(0, len(allstr)-1)
        rr = allstr[ridx]
        strx += str(rr)

    return strx</code></pre>
</details>
</dd>
<dt id="pedutil.readfile"><code class="name flex">
<span>def <span class="ident">readfile</span></span>(<span>strx, sep=None)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def  readfile(strx, sep = None):

    text = []

    if strx == &#34;&#34;:
        return text

    # Now read and parse
    f = open(strx, &#34;rb&#34;);  buff2 = f.read();  f.close()
    if sys.version_info.major &lt; 3:
        buff = buff2
    else:
        try:
            buff = buff2.decode(&#39;UTF-8&#39;)
        except UnicodeDecodeError:
            buff = buff2.decode(&#39;cp437&#39;)

    buff2 = &#34;&#34;

    if not sep:
        # Deteremine separator, use a partial length search
        if buff.find(&#34;\r\n&#34;, 0, 300) &gt;= 0:
            sep = &#34;\r\n&#34;
        elif buff.find(&#34;\n\r&#34;, 0, 300) &gt;= 0:
            sep = &#34;\n\r&#34;
        elif buff.find(&#34;\r&#34;, 0, 300) &gt;= 0:
            sep = &#34;\r&#34;
        else:
            sep = &#34;\n&#34;

    text2 = str.split(buff, sep)

    #if &#34;Makefile&#34; in strx:
    #    print(strx, &#34;sep: &#39;&#34;+ sep + &#34;&#39;&#34;, ord(sep[0]), ord(sep[1]))

    # Clean out spuriously occurring \r and \n
    # Example: ST Microelectronics Makefiles

    text = []
    for aa in text2:
        #print(&#34;&#39;%s\n&#34; % aa)
        bb = aa.replace(&#34;\r&#34;, &#34;&#34;)
        cc = bb.replace(&#34;\n&#34;, &#34;&#34;)
        text.append(cc)
    #text2 = []

    return text</code></pre>
</details>
</dd>
<dt id="pedutil.register_stock_icons"><code class="name flex">
<span>def <span class="ident">register_stock_icons</span></span>(<span>)</span>
</code></dt>
<dd>
<div class="desc"><p>This function registers our custom toolbar icons, so they
can be themed.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def register_stock_icons():
    &#39;&#39;&#39; This function registers our custom toolbar icons, so they
        can be themed.
    &#39;&#39;&#39;
    items = [(&#39;demo-gtk-logo&#39;, &#39;_GTK!&#39;, 0, 0, &#39;&#39;)]
    # Register our stock items
    #Gtk.stock_add(items)

    # Add our custom icon factory to the list of defaults
    factory = Gtk.IconFactory()
    factory.add_default()

    img_dir = os.path.join(os.path.dirname(__file__), &#39;images&#39;)
    img_path = os.path.join(img_dir, &#39;gtk-logo-rgb.gif&#39;)

    #print( img_path)
    try:
        #pixbuf = Gdk.pixbuf_new_from_file(img_path)
        # Register icon to accompany stock item

        # The gtk-logo-rgb icon has a white background, make it transparent
        # the call is wrapped to (gboolean, guchar, guchar, guchar)
        #transparent = pixbuf.add_alpha(True, chr(255), chr(255),chr(255))
        #icon_set = Gtk.IconSet(transparent)
        #factory.add(&#39;demo-gtk-logo&#39;, icon_set)
        pass
    except GObject.GError as error:
        #print( &#39;failed to load GTK logo ... trying local&#39;)
        try:
            #img_path = os.path.join(img_dir, &#39;gtk-logo-rgb.gif&#39;)
            xbuf = Gdk.pixbuf_new_from_file(&#39;gtk-logo-rgb.gif&#39;)
            #Register icon to accompany stock item
            #The gtk-logo-rgb icon has a white background, make it transparent
            #the call is wrapped to (gboolean, guchar, guchar, guchar)
            transparent = xbuf.add_alpha(True, chr(255), chr(255),chr(255))
            icon_set = Gtk.IconSet(transparent)
            factory.add(&#39;demo-gtk-logo&#39;, icon_set)

        except GObject.GError as error:
            print(&#39;failed to load GTK logo for toolbar&#39;)</code></pre>
</details>
</dd>
<dt id="pedutil.rmlspace"><code class="name flex">
<span>def <span class="ident">rmlspace</span></span>(<span>strx, num)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def rmlspace(strx, num):
    idx = 0;    xlen = len(strx)
    while True:
        if idx &gt;= xlen:  break
        if strx[idx] != &#34; &#34;: break
        if idx &gt;= num: break
        idx += 1
    return strx[idx:]</code></pre>
</details>
</dd>
<dt id="pedutil.save_sess"><code class="name flex">
<span>def <span class="ident">save_sess</span></span>(<span>sesslist)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def save_sess(sesslist):

    fc = Gtk.FileChooserDialog(title=&#34;Save Session&#34;, transient_for=None, \
                            action=Gtk.FileChooserAction.SAVE)
    but =   &#34;Cancel&#34;, Gtk.ButtonsType.CANCEL, &#34;Save Session&#34;, Gtk.ButtonsType.OK
    fc.add_buttons(*but)

    filter2 = Gtk.FileFilter()
    filter2.add_pattern (&#34;*.sess&#34;);  filter2.add_pattern (&#34;*&#34;)

    fc.sesslist = sesslist
    fc.old = os.getcwd()
    fc.set_filter(filter2)
    fc.set_current_folder(pedconfig.conf.sess_dir)
    fc.set_current_name(os.path.basename(&#34;Untitled.sess&#34;))
    fc.set_default_response(Gtk.ButtonsType.OK)
    fc.connect(&#34;response&#34;, done_sess_fc, fc)
    fc.run()</code></pre>
</details>
</dd>
<dt id="pedutil.selasci"><code class="name flex">
<span>def <span class="ident">selasci</span></span>(<span>strx, xidx, additional=None)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def  selasci(strx, xidx, additional = None):

    #print( &#34;selasci:&#34;, &#34;&#39;&#34; + strx + &#34;&#39;&#34;, xidx)

    xlen = len(strx)
    if xlen == 0: return 0, 0
    if xidx &gt;= xlen: return xlen, xlen
    if strx[xidx] == &#34; &#34;:
        return xidx, xidx

    cnte = xidx; cntb = xidx

    # Find space to end
    while True:
        if cnte &gt;= xlen:    break
        if not strx[cnte].isalnum():
            break
        cnte += 1
    # Find space to begin
    while True:
        if cntb &lt; 0:
            cntb += 1
            break
        if not strx[cntb].isalnum():
            cntb += 1
            break
        cntb -= 1

    #print( cntb, cnte)
    #print(  &#34;&#39;&#34; + strx[cntb:cnte] + &#34;&#39;&#34;)

    return cntb, cnte</code></pre>
</details>
</dd>
<dt id="pedutil.selasci2"><code class="name flex">
<span>def <span class="ident">selasci2</span></span>(<span>strx, xidx, addi='')</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def  selasci2(strx, xidx, addi = &#34;&#34;):

    #print( &#34;selasci2:&#34;, &#34;&#39;&#34; + strx + &#34;&#39;&#34;, xidx)

    xlen = len(strx)
    if xlen == 0: return 0, 0
    if xidx &gt;= xlen: return xlen, xlen
    if strx[xidx] == &#34; &#34;:
        if xidx:
            xidx -= 1
        if strx[xidx-1] == &#34; &#34;:
            return xidx, xidx

    cnte = xidx; cntb = xidx

    # Find space to end
    while True:
        if cnte &gt;= xlen:  break
        if not strx[cnte].isalnum() and addi.find(strx[cnte]) &lt; 0:
            break
        cnte += 1
    # Find space to begin
    while True:
        #print( cntb,)
        if cntb &lt; 0:
            cntb += 1
            break

        if not strx[cntb].isalnum() and addi.find(strx[cntb]) &lt; 0:
            cntb += 1
            break
        cntb -= 1

    #print( cntb, cnte)
    #print(  &#34;&#39;&#34; + strx[cntb:cnte] + &#34;&#39;&#34;)

    return cntb, cnte</code></pre>
</details>
</dd>
<dt id="pedutil.selword"><code class="name flex">
<span>def <span class="ident">selword</span></span>(<span>strx, xidx)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def  selword(strx, xidx):

    #print( &#34;selword:&#34;, strx, xidx)

    xlen = len(strx)
    if xlen == 0: return 0, 0
    if xidx &gt;= xlen: return xlen, xlen

    if strx[xidx] == &#34; &#34;:
        return xidx, xidx

    cnte = xidx; cntb = xidx

    # Find space to end
    while True:
        if cnte &gt;= xlen: break
        if strx[cnte] == &#34; &#34; or strx[cnte] == &#34;\t&#34;:
            break
        cnte += 1
    # Find space to begin
    while True:
        if cntb &lt; 0:
            cntb += 1
            break
        if strx[cntb] == &#34; &#34; or strx[cntb] == &#34;\t&#34;:
            cntb += 1               # Already on space, back off
            break
        cntb -= 1

    return cntb, cnte</code></pre>
</details>
</dd>
<dt id="pedutil.shortenstr"><code class="name flex">
<span>def <span class="ident">shortenstr</span></span>(<span>xstr, xlen)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def shortenstr(xstr, xlen):
    ret = &#34;&#34;; zlen = len(xstr)
    if zlen &gt; xlen:
        if xlen &lt; 5: raise ValueError
        xlen -= 5
        ret = xstr[:xlen // 2] + &#34;...&#34; + xstr[zlen - xlen // 2:]
    else:
        ret = xstr

    return ret</code></pre>
</details>
</dd>
<dt id="pedutil.src_line"><code class="name flex">
<span>def <span class="ident">src_line</span></span>(<span>line, cnt, srctxt, regex, boolcase, boolregex)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def src_line(line, cnt, srctxt, regex, boolcase, boolregex):

    idx = 0; idx2 = 0
    mlen = len(srctxt)
    accum = []

    while True:
        if boolcase:
            idx = line.lower().find(srctxt.lower(), idx)
            idx2 = idx
        elif boolregex:
            line2 = line[idx:]
            #print( &#34;line2&#34;, line2)
            if line2 == &#34;&#34;:
                idx = -1
                break
            res = regex.search(line2)
            #print( res, res.start(), res.end())
            if res:
                idx = res.start() + idx
                # Null match, ignore it (&#39;*&#39; with zero length match)
                if res.end() == res.start():
                    #print( &#34;null match&#34;, idx, res.start(), res.end())
                    # Proceed no matter what
                    if res.end() != 0:
                        idx = res.end() + 1
                    else:
                        idx += 1
                    continue

                idx2 = res.end() + idx
                mlen = res.end() - res.start()
                #print( &#34;match&#34;, line2[res.start():res.end()])
            else:
                idx = -1
                break
        else:
            idx = line.find(srctxt, idx)
            idx2 = idx

        if  idx &gt;= 0:
            line2 =  str(idx) + &#34;:&#34;  + str(cnt) +\
                     &#34;:&#34; + str(mlen) + &#34; &#34; + line
            accum.append(line2)
            idx = idx2 + 1
        else:
            break

    return accum</code></pre>
</details>
</dd>
<dt id="pedutil.timesheet"><code class="name flex">
<span>def <span class="ident">timesheet</span></span>(<span>kind, startt, endd)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def timesheet(kind, startt, endd):

    logfname = &#34;timesheet.txt&#34;
    logfile = pedconfig.conf.log_dir + os.sep + logfname
    try:
        fp = open(logfile, &#34;a+&#34;)
    except:
        try:
            fp = open(logfile, &#34;w+&#34;)
            fp.seek(0, os.SEEK_END)
        except:
            print(&#34;Cannot open/create log file&#34;, logfile)
            return

    log_clock = time.time()

    print(&#34;Action:&#34;, &#34;%s&#34; % (kind), file=fp)
    print(&#34;On:&#34;, time.ctime(log_clock), file=fp)
    if endd:
        td = endd - startt
        print(&#34;Time diff:&#34;, &#34;%.0f %d:%d&#34; % (td, td / 3600, (td % 3600) / 60), file=fp)

    print(file=fp)
    fp.close()</code></pre>
</details>
</dd>
<dt id="pedutil.unescape"><code class="name flex">
<span>def <span class="ident">unescape</span></span>(<span>strx)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def unescape(strx):

    #print &#34; x[&#34; + strx + &#34;]x &#34;

    global xtab, xtablen
    retx = u&#34;&#34;; pos = 0; lenx = len(strx)

    while True:
        if pos &gt;= lenx:
            break

        chh = strx[pos]

        if chh == &#39;\\&#39;:
            #print &#34;backslash&#34;, strx[pos:]
            pos2 = pos + 1; strx2 = &#34;&#34;
            while True:
                if pos2 &gt;= lenx:
                    # See if we accumulated anything
                    if strx2 != &#34;&#34;:
                        xtab.append(oct2int(strx2))
                    if len(xtab) &gt; 0:
                        #print &#34;final:&#34;, xtab
                        if xtablen == len(xtab):
                            retx += uni(xtab)
                            xtab = []; xtablen = 0
                    pos = pos2 - 1
                    break
                chh2 = strx[pos2]
                if chh2  &gt;= &#34;0&#34; and chh2 &lt;= &#34;7&#34;:
                    strx2 += chh2
                else:
                    #print &#34;strx2: &#39;&#34;  + strx2 + &#34;&#39;&#34;
                    if strx2 != &#34;&#34;:
                        octx = oct2int(strx2)
                        if xtablen == 0:
                            if octx &amp; 0xe0 == 0xc0:
                                #print &#34;two &#34;,str.format(&#34;{0:b}&#34;, octx)
                                xtablen = 2
                                xtab.append(octx)
                            elif octx &amp; 0xf0 == 0xe0: # three numbers
                                #print &#34;three &#34;,str.format(&#34;{0:b}&#34;, octx)
                                xtablen = 3
                                xtab.append(octx)
                            elif octx &amp; 0xf8 == 0xf0: # four numbers
                                print(&#34;four &#34;,str.format(&#34;{0:b}&#34;, octx))
                                xtablen = 4
                                xtab.append(octx)
                            elif octx &amp; 0xfc == 0xf8: # five numbers
                                print(&#34;five &#34;,str.format(&#34;{0:b}&#34;, octx))
                                xtablen = 5
                                xtab.append(octx)
                            elif octx &amp; 0xfe == 0xfc: # six numbers
                                print(&#34;six &#34;,str.format(&#34;{0:b}&#34;, octx))
                                xtablen = 6
                                xtab.append(octx)
                            else:
                                #print &#34;other &#34;,str.format(&#34;{0:b}&#34;, octx)
                                #retx += unichr(octx)
                                retx += chr(octx)
                        else:
                            xtab.append(octx)
                            #print &#34;data &#34;,str.format(&#34;{0:b}&#34;, octx)
                            if xtablen == len(xtab):
                                retx += uni(xtab)
                                xtab = []; xtablen = 0

                    pos = pos2 - 1
                    break
                pos2 += 1
        else:

            if xtablen == len(xtab) and xtablen != 0:
                retx += uni(xtab)
            xtab=[]; xtablen = 0

            try:
                retx += chh
            except:
                pass
        pos += 1

    #print &#34;y[&#34; + retx + &#34;]y&#34;
    return retx</code></pre>
</details>
</dd>
<dt id="pedutil.uni"><code class="name flex">
<span>def <span class="ident">uni</span></span>(<span>xtab)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def uni(xtab):

    #print str.format(&#34;{0:b}&#34;,  xtab[0])

    try:
        unichr
    except NameError:
        unichr = chr

    cc = 0
    try:
        if xtab[0] &amp; 0xe0 == 0xc0:  # two numbers
            cc = (xtab[0] &amp; 0x1f) &lt;&lt; 6
            cc += (xtab[1] &amp; 0x3f)
        elif xtab[0] &amp; 0xf0 == 0xe0: # three numbers
            cc = (xtab[0] &amp; 0x0f) &lt;&lt; 12
            cc += (xtab[1] &amp; 0x3f) &lt;&lt; 6
            cc += (xtab[2] &amp; 0x3f)
        elif xtab[0] &amp; 0xf8 == 0xf0: # four numbers
            cc = (xtab[0] &amp; 0x0e)  &lt;&lt; 18
            cc += (xtab[1] &amp; 0x3f) &lt;&lt; 12
            cc += (xtab[2] &amp; 0x3f) &lt;&lt; 6
            cc += (xtab[3] &amp; 0x3f)
        elif xtab[0] &amp; 0xfc == 0xf8: # five numbers
            cc = (xtab[0] &amp; 0x03)  &lt;&lt; 24
            cc += (xtab[1] &amp; 0x3f) &lt;&lt; 18
            cc += (xtab[2] &amp; 0x3f) &lt;&lt; 12
            cc += (xtab[3] &amp; 0x3f) &lt;&lt; 6
            cc += (xtab[4] &amp; 0x3f)
        elif xtab[0] &amp; 0xfe == 0xf8: # six numbers
            cc = (xtab[0] &amp; 0x01)  &lt;&lt; 30
            cc += (xtab[1] &amp; 0x3f) &lt;&lt; 24
            cc += (xtab[2] &amp; 0x3f) &lt;&lt; 18
            cc += (xtab[3] &amp; 0x3f) &lt;&lt; 12
            cc += (xtab[4] &amp; 0x3f) &lt;&lt; 6
            cc += (xtab[5] &amp; 0x3f)

        ccc = unichr(cc)
    except:
        pass

    return ccc</code></pre>
</details>
</dd>
<dt id="pedutil.untab_str"><code class="name flex">
<span>def <span class="ident">untab_str</span></span>(<span>strx, tabstop=4)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def untab_str(strx, tabstop = 4):
    res = &#34;&#34;; idx = 0; cnt = 0
    xlen = len(strx)
    while True:
        if idx &gt;= xlen: break
        chh = strx[idx]
        if  chh == &#34;\t&#34;:
            # Generate string
            spaces = tabstop - (cnt % tabstop)
            ttt = &#34;&#34;
            for aa in range(spaces):
                ttt += &#34; &#34;
            res += ttt
            cnt += spaces
        else:
            cnt += 1
            res += chh
        idx += 1
    return res</code></pre>
</details>
</dd>
<dt id="pedutil.usleep"><code class="name flex">
<span>def <span class="ident">usleep</span></span>(<span>msec)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def  usleep(msec):

    if sys.version_info[0] &lt; 3 or \
        (sys.version_info[0] == 3 and sys.version_info[1] &lt; 3):
        timefunc = time.clock
    else:
        timefunc = time.process_time

    got_clock = timefunc() + float(msec) / 1000
    #print( got_clock)
    while True:
        if timefunc() &gt; got_clock:
            break
        #print (&#34;Sleeping&#34;)
        Gtk.main_iteration_do(False)</code></pre>
</details>
</dd>
<dt id="pedutil.writefile"><code class="name flex">
<span>def <span class="ident">writefile</span></span>(<span>strx, buff, sep='\n', mode='w')</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def  writefile(strx, buff, sep = &#34;\n&#34;, mode = &#34;w&#34;):
    #print (&#34;writefile&#34;, strx, sep)
    ret = True, &#34;&#34;
    if strx != &#34;&#34;:
        try:
            fp = open(strx, mode)
            cnt = 0; sepx = &#34;&#34;
            for aa in buff:
                if cnt:
                    sepx = sep
                fp.write(sepx + aa.rstrip())
                cnt += 1
            fp.close()
        except:
            ret = False, sys.exc_info()[1]
            try:
                fp.close()
            except:
                pass
            pass
    return ret</code></pre>
</details>
</dd>
<dt id="pedutil.xnextchar"><code class="name flex">
<span>def <span class="ident">xnextchar</span></span>(<span>strx, xchar, start)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def xnextchar( strx, xchar, start):
    idx = start; end =  len(strx) - 1
    while True:
        if idx &gt; end: break
        chh = strx[idx]
        if chh != xchar:
            break
        idx += 1
    return idx</code></pre>
</details>
</dd>
<dt id="pedutil.xnextchar2"><code class="name flex">
<span>def <span class="ident">xnextchar2</span></span>(<span>strx, xchar, start)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def xnextchar2( strx, xchar, start):
    idx = start; end =  len(strx) - 1
    while True:
        if idx &gt; end: break
        chh = strx[idx]
        if xchar.find(chh) == -1:
            break
        idx += 1
    return idx</code></pre>
</details>
</dd>
<dt id="pedutil.xprevchar"><code class="name flex">
<span>def <span class="ident">xprevchar</span></span>(<span>strx, xchar, start)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def xprevchar( strx, xchar, start):
    idx = start
    idx = min(len(strx) - 1, idx)
    while True:
        if idx &lt; 0: break
        chh = strx[idx]
        if chh != xchar:
            break
        idx -= 1
    return idx</code></pre>
</details>
</dd>
</dl>
</section>
<section>
<h2 class="section-title" id="header-classes">Classes</h2>
<dl>
<dt id="pedutil.HeadDialog"><code class="flex name class">
<span>class <span class="ident">HeadDialog</span></span>
<span>(</span><span>initstr, parent=None)</span>
</code></dt>
<dd>
<div class="desc"><p>:Constructors:</p>
<p>::</p>
<pre><code>Dialog(**properties)
new() -&gt; Gtk.Widget
</code></pre></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class HeadDialog(Gtk.Dialog):

    def __init__(self, initstr, parent = None):
        Gtk.Dialog.__init__(
            self, title=&#34;Name for Note&#34;, transient_for=parent, modal=True,
        )
        self.add_buttons(
            Gtk.STOCK_OK,
            Gtk.ResponseType.OK,
            Gtk.STOCK_CANCEL,
            Gtk.ResponseType.CANCEL,
        )
        self.set_default_response(Gtk.ResponseType.OK)

        box = self.get_content_area()
        label = Gtk.Label(label=&#34;        &#34;)
        box.add(label)

        self.entry = Gtk.Entry()
        self.entry.set_text(initstr)
        self.entry.set_activates_default(True)

        self.hbox = Gtk.HBox()
        self.hbox.pack_start(Gtk.Label(label=&#34;   Note Header:  &#34;), 0, 0, 0)
        self.hbox.pack_start(self.entry, 1, 1, 0)
        self.hbox.pack_start(Gtk.Label(label=&#34;                 &#34;), 0, 0, 0)

        box.add(self.hbox)
        self.show_all()</code></pre>
</details>
<h3>Ancestors</h3>
<ul class="hlist">
<li>gi.overrides.Gtk.Dialog</li>
<li>gi.repository.Gtk.Dialog</li>
<li>gi.overrides.Gtk.Window</li>
<li>gi.repository.Gtk.Window</li>
<li>gi.repository.Gtk.Bin</li>
<li>gi.overrides.Gtk.Container</li>
<li>gi.repository.Gtk.Container</li>
<li>gi.overrides.Gtk.Widget</li>
<li>gi.repository.Gtk.Widget</li>
<li>gi.repository.GObject.InitiallyUnowned</li>
<li>gi.overrides.GObject.Object</li>
<li>gi.repository.GObject.Object</li>
<li>gi._gi.GObject</li>
<li>gi.repository.Atk.ImplementorIface</li>
<li>gi.repository.Gtk.Buildable</li>
<li>gobject.GInterface</li>
</ul>
</dd>
<dt id="pedutil.OpenFname"><code class="flex name class">
<span>class <span class="ident">OpenFname</span></span>
<span>(</span><span>mywin, filters=None)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class OpenFname():

    def __init__(self, mywin, filters = None):
        self.fc_done = False
        self.fc_code = 0
        self.fname = &#34;&#34;

        warnings.simplefilter(&#34;ignore&#34;)
        but =   &#34;Cancel&#34;, Gtk.ButtonsType.CANCEL,\
         &#34;Open File&#34;, Gtk.ButtonsType.OK
        self.fc = Gtk.FileChooserDialog(&#34;Open file&#34;, mywin, \
             Gtk.FileChooserAction.OPEN  \
            #Gtk.FILE_CHOOSER_ACTION_SELECT_FOLDER
            , but)
        warnings.simplefilter(&#34;default&#34;)

        if filters:
            for aa in filters:
                self.fc.add_filter(aa)

        self.fc.set_default_response(Gtk.ButtonsType.OK)
        self.fc.set_current_folder(os.getcwd())

        self.fc.connect(&#34;response&#34;, self._done_openfname)
        #self.fc.connect(&#34;current-folder-changed&#34;, self.folder_ch )
        #self.fc.set_current_name(self.fname)

    def run(self):
        try:
            self.fc.run()
        except:
            self.fc_done = True

        while True:
            if self.fc_done:
                break
            #time.sleep(.3)
            usleep(400)
        return self

    def _done_openfname(self, win, resp):
        #print &#34;done_openfname&#34;, win, resp
        if resp == Gtk.ButtonsType.OK:
            fname = self.fc.get_filename()
            if not fname:
                #print &#34;Must have filename&#34;
                #self.update_statusbar(&#34;No filename specified&#34;)
                pass
            elif os.path.isdir(fname):
                #self.update_statusbar(&#34;Changed to %s&#34; % fname)
                os.chdir(fname)
                self.fc.set_current_folder(fname)
                return
            else:
                #self.openfile(fname)
                self.fname = fname
                self.fc_code = True
        win.destroy()
        self.fc_done = True</code></pre>
</details>
<h3>Methods</h3>
<dl>
<dt id="pedutil.OpenFname.run"><code class="name flex">
<span>def <span class="ident">run</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def run(self):
    try:
        self.fc.run()
    except:
        self.fc_done = True

    while True:
        if self.fc_done:
            break
        #time.sleep(.3)
        usleep(400)
    return self</code></pre>
</details>
</dd>
</dl>
</dd>
<dt id="pedutil.SearchDialog"><code class="flex name class">
<span>class <span class="ident">SearchDialog</span></span>
<span>(</span><span>parent=None)</span>
</code></dt>
<dd>
<div class="desc"><p>:Constructors:</p>
<p>::</p>
<pre><code>Dialog(**properties)
new() -&gt; Gtk.Widget
</code></pre></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class SearchDialog(Gtk.Dialog):

    def __init__(self, parent = None):
        Gtk.Dialog.__init__(
            self, title=&#34; Search &#34;, transient_for=parent, modal=True,
        )
        self.add_buttons(
            Gtk.STOCK_FIND,
            Gtk.ResponseType.OK,
            Gtk.STOCK_CANCEL,
            Gtk.ResponseType.CANCEL,
        )
        self.set_default_response(Gtk.ResponseType.OK)
        box = self.get_content_area()

        #label = Gtk.Label(label=&#34;  Enter text you want to search for:  &#34;)
        label = Gtk.Label(label=&#34;   &#34;)
        box.add(label)

        self.hbox = Gtk.HBox()
        self.hbox.pack_start(Gtk.Label(label=&#34;   Search for:  &#34;), 0, 0, 0)
        self.entry = Gtk.Entry()
        self.entry.set_activates_default(True)
        self.hbox.pack_start(self.entry, 1, 1, 0)
        self.hbox.pack_start(Gtk.Label(label=&#34;            &#34;), 0, 0, 0)

        box.add(self.hbox)

        #box.add(self.entry)
        self.show_all()</code></pre>
</details>
<h3>Ancestors</h3>
<ul class="hlist">
<li>gi.overrides.Gtk.Dialog</li>
<li>gi.repository.Gtk.Dialog</li>
<li>gi.overrides.Gtk.Window</li>
<li>gi.repository.Gtk.Window</li>
<li>gi.repository.Gtk.Bin</li>
<li>gi.overrides.Gtk.Container</li>
<li>gi.repository.Gtk.Container</li>
<li>gi.overrides.Gtk.Widget</li>
<li>gi.repository.Gtk.Widget</li>
<li>gi.repository.GObject.InitiallyUnowned</li>
<li>gi.overrides.GObject.Object</li>
<li>gi.repository.GObject.Object</li>
<li>gi._gi.GObject</li>
<li>gi.repository.Atk.ImplementorIface</li>
<li>gi.repository.Gtk.Buildable</li>
<li>gobject.GInterface</li>
</ul>
</dd>
</dl>
</section>
</article>
<nav id="sidebar">
<h1>Index</h1>
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3><a href="#header-functions">Functions</a></h3>
<ul class="">
<li><code><a title="pedutil.ampmstr" href="#pedutil.ampmstr">ampmstr</a></code></li>
<li><code><a title="pedutil.atoi" href="#pedutil.atoi">atoi</a></code></li>
<li><code><a title="pedutil.calc_tabs" href="#pedutil.calc_tabs">calc_tabs</a></code></li>
<li><code><a title="pedutil.calc_tabs2" href="#pedutil.calc_tabs2">calc_tabs2</a></code></li>
<li><code><a title="pedutil.cntleadchar" href="#pedutil.cntleadchar">cntleadchar</a></code></li>
<li><code><a title="pedutil.cut_lead_space" href="#pedutil.cut_lead_space">cut_lead_space</a></code></li>
<li><code><a title="pedutil.decalc_tabs" href="#pedutil.decalc_tabs">decalc_tabs</a></code></li>
<li><code><a title="pedutil.done_sess2_fc" href="#pedutil.done_sess2_fc">done_sess2_fc</a></code></li>
<li><code><a title="pedutil.done_sess_fc" href="#pedutil.done_sess_fc">done_sess_fc</a></code></li>
<li><code><a title="pedutil.findinfile" href="#pedutil.findinfile">findinfile</a></code></li>
<li><code><a title="pedutil.genstr" href="#pedutil.genstr">genstr</a></code></li>
<li><code><a title="pedutil.get_exec_path" href="#pedutil.get_exec_path">get_exec_path</a></code></li>
<li><code><a title="pedutil.get_img_path" href="#pedutil.get_img_path">get_img_path</a></code></li>
<li><code><a title="pedutil.get_pangview_path" href="#pedutil.get_pangview_path">get_pangview_path</a></code></li>
<li><code><a title="pedutil.getfilename" href="#pedutil.getfilename">getfilename</a></code></li>
<li><code><a title="pedutil.handle_keys" href="#pedutil.handle_keys">handle_keys</a></code></li>
<li><code><a title="pedutil.hash_name" href="#pedutil.hash_name">hash_name</a></code></li>
<li><code><a title="pedutil.isTrue" href="#pedutil.isTrue">isTrue</a></code></li>
<li><code><a title="pedutil.is_ascii" href="#pedutil.is_ascii">is_ascii</a></code></li>
<li><code><a title="pedutil.isfile" href="#pedutil.isfile">isfile</a></code></li>
<li><code><a title="pedutil.kill_non_ascii" href="#pedutil.kill_non_ascii">kill_non_ascii</a></code></li>
<li><code><a title="pedutil.launch_pangview" href="#pedutil.launch_pangview">launch_pangview</a></code></li>
<li><code><a title="pedutil.load_sess" href="#pedutil.load_sess">load_sess</a></code></li>
<li><code><a title="pedutil.logentry" href="#pedutil.logentry">logentry</a></code></li>
<li><code><a title="pedutil.nextchar" href="#pedutil.nextchar">nextchar</a></code></li>
<li><code><a title="pedutil.oct2int" href="#pedutil.oct2int">oct2int</a></code></li>
<li><code><a title="pedutil.prevchar" href="#pedutil.prevchar">prevchar</a></code></li>
<li><code><a title="pedutil.prompt_for_text" href="#pedutil.prompt_for_text">prompt_for_text</a></code></li>
<li><code><a title="pedutil.put_debug" href="#pedutil.put_debug">put_debug</a></code></li>
<li><code><a title="pedutil.put_exception" href="#pedutil.put_exception">put_exception</a></code></li>
<li><code><a title="pedutil.put_exception2" href="#pedutil.put_exception2">put_exception2</a></code></li>
<li><code><a title="pedutil.randasc" href="#pedutil.randasc">randasc</a></code></li>
<li><code><a title="pedutil.randlett" href="#pedutil.randlett">randlett</a></code></li>
<li><code><a title="pedutil.randstr" href="#pedutil.randstr">randstr</a></code></li>
<li><code><a title="pedutil.readfile" href="#pedutil.readfile">readfile</a></code></li>
<li><code><a title="pedutil.register_stock_icons" href="#pedutil.register_stock_icons">register_stock_icons</a></code></li>
<li><code><a title="pedutil.rmlspace" href="#pedutil.rmlspace">rmlspace</a></code></li>
<li><code><a title="pedutil.save_sess" href="#pedutil.save_sess">save_sess</a></code></li>
<li><code><a title="pedutil.selasci" href="#pedutil.selasci">selasci</a></code></li>
<li><code><a title="pedutil.selasci2" href="#pedutil.selasci2">selasci2</a></code></li>
<li><code><a title="pedutil.selword" href="#pedutil.selword">selword</a></code></li>
<li><code><a title="pedutil.shortenstr" href="#pedutil.shortenstr">shortenstr</a></code></li>
<li><code><a title="pedutil.src_line" href="#pedutil.src_line">src_line</a></code></li>
<li><code><a title="pedutil.timesheet" href="#pedutil.timesheet">timesheet</a></code></li>
<li><code><a title="pedutil.unescape" href="#pedutil.unescape">unescape</a></code></li>
<li><code><a title="pedutil.uni" href="#pedutil.uni">uni</a></code></li>
<li><code><a title="pedutil.untab_str" href="#pedutil.untab_str">untab_str</a></code></li>
<li><code><a title="pedutil.usleep" href="#pedutil.usleep">usleep</a></code></li>
<li><code><a title="pedutil.writefile" href="#pedutil.writefile">writefile</a></code></li>
<li><code><a title="pedutil.xnextchar" href="#pedutil.xnextchar">xnextchar</a></code></li>
<li><code><a title="pedutil.xnextchar2" href="#pedutil.xnextchar2">xnextchar2</a></code></li>
<li><code><a title="pedutil.xprevchar" href="#pedutil.xprevchar">xprevchar</a></code></li>
</ul>
</li>
<li><h3><a href="#header-classes">Classes</a></h3>
<ul>
<li>
<h4><code><a title="pedutil.HeadDialog" href="#pedutil.HeadDialog">HeadDialog</a></code></h4>
</li>
<li>
<h4><code><a title="pedutil.OpenFname" href="#pedutil.OpenFname">OpenFname</a></code></h4>
<ul class="">
<li><code><a title="pedutil.OpenFname.run" href="#pedutil.OpenFname.run">run</a></code></li>
</ul>
</li>
<li>
<h4><code><a title="pedutil.SearchDialog" href="#pedutil.SearchDialog">SearchDialog</a></code></h4>
</li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc" title="pdoc: Python API documentation generator"><cite>pdoc</cite> 0.10.0</a>.</p>
</footer>
</body>
</html>